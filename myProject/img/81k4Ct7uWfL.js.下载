(function(p,k,q){p.execute(function(){"object"!==typeof JSON&&(JSON={});(function(){function h(a){return 10>a?"0"+a:a}function r(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=e[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a,b){var e,h,k,x,p=c,q,t=b[a];t&&"object"===typeof t&&"function"===typeof t.toJSON&&(t=t.toJSON(a));"function"===typeof g&&(t=g.call(b,a,t));switch(typeof t){case "string":return r(t);case "number":return isFinite(t)?
String(t):"null";case "boolean":case "null":return String(t);case "object":if(!t)return"null";c+=d;q=[];if("[object Array]"===Object.prototype.toString.apply(t)){x=t.length;for(e=0;e<x;e+=1)q[e]=f(e,t)||"null";k=0===q.length?"[]":c?"[\n"+c+q.join(",\n"+c)+"\n"+p+"]":"["+q.join(",")+"]";c=p;return k}if(g&&"object"===typeof g)for(x=g.length,e=0;e<x;e+=1)"string"===typeof g[e]&&(h=g[e],(k=f(h,t))&&q.push(r(h)+(c?": ":":")+k));else for(h in t)Object.prototype.hasOwnProperty.call(t,h)&&(k=f(h,t))&&q.push(r(h)+
(c?": ":":")+k);k=0===q.length?"{}":c?"{\n"+c+q.join(",\n"+c)+"\n"+p+"}":"{"+q.join(",")+"}";c=p;return k}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var a,b,c,
d,e,g;"function"!==typeof JSON.stringify&&(b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,e){var h;d=c="";if("number"===typeof e)for(h=0;h<e;h+=1)d+=" ";else"string"===typeof e&&(d=e);if((g=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return f("",{"":a})});
"function"!==typeof JSON.parse&&(a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(b,c){function d(a,b){var e,g,l=a[b];if(l&&"object"===typeof l)for(e in l)Object.prototype.hasOwnProperty.call(l,e)&&(g=d(l,e),g!==q?l[e]=g:delete l[e]);return c.call(a,b,l)}var e;b=String(b);a.lastIndex=0;a.test(b)&&(b=b.replace(a,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,
"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+b+")"),"function"===typeof c?d({"":e},""):e;throw new SyntaxError("JSON.parse");})})();(function(){var h=this,k=h._,f={},a=Array.prototype,b=Object.prototype,c=a.push,d=a.slice,e=a.concat,g=b.toString,l=b.hasOwnProperty,n=a.forEach,w=a.map,K=a.reduce,B=a.reduceRight,x=a.filter,p=a.every,q=a.some,t=a.indexOf,A=a.lastIndexOf,b=Array.isArray,E=Object.keys,D=Function.prototype.bind,
m=function(a){if(a instanceof m)return a;if(!(this instanceof m))return new m(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=m),exports._=m):h._=m;m.VERSION="1.5.2";var u=m.each=m.forEach=function(a,b,c){if(null!=a)if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,e=a.length;d<e&&b.call(c,a[d],d,a)!==f;d++);else for(var g=m.keys(a),d=0,e=g.length;d<e&&b.call(c,a[g[d]],g[d],a)!==f;d++);};m.map=m.collect=
function(a,b,c){var d=[];if(null==a)return d;if(w&&a.map===w)return a.map(b,c);u(a,function(a,e,g){d.push(b.call(c,a,e,g))});return d};m.reduce=m.foldl=m.inject=function(a,b,c,d){var e=2<arguments.length;null==a&&(a=[]);if(K&&a.reduce===K)return d&&(b=m.bind(b,d)),e?a.reduce(b,c):a.reduce(b);u(a,function(a,g,l){e?c=b.call(d,c,a,g,l):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c};m.reduceRight=m.foldr=function(a,b,c,d){var e=2<arguments.length;null==
a&&(a=[]);if(B&&a.reduceRight===B)return d&&(b=m.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var g=a.length;if(g!==+g)var l=m.keys(a),g=l.length;u(a,function(n,f,w){f=l?l[--g]:--g;e?c=b.call(d,c,a[f],f,w):(c=a[f],e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c};m.find=m.detect=function(a,b,c){var d;F(a,function(a,e,g){if(b.call(c,a,e,g))return d=a,!0});return d};m.filter=m.select=function(a,b,c){var d=[];if(null==a)return d;if(x&&a.filter===x)return a.filter(b,
c);u(a,function(a,e,g){b.call(c,a,e,g)&&d.push(a)});return d};m.reject=function(a,b,c){return m.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)};m.every=m.all=function(a,b,c){b||(b=m.identity);var d=!0;if(null==a)return d;if(p&&a.every===p)return a.every(b,c);u(a,function(a,e,g){if(!(d=d&&b.call(c,a,e,g)))return f});return!!d};var F=m.some=m.any=function(a,b,c){b||(b=m.identity);var d=!1;if(null==a)return d;if(q&&a.some===q)return a.some(b,c);u(a,function(a,e,g){if(d||(d=b.call(c,a,e,g)))return f});
return!!d};m.contains=m.include=function(a,b){return null==a?!1:t&&a.indexOf===t?-1!=a.indexOf(b):F(a,function(a){return a===b})};m.invoke=function(a,b){var c=d.call(arguments,2),e=m.isFunction(b);return m.map(a,function(a){return(e?b:a[b]).apply(a,c)})};m.pluck=function(a,b){return m.map(a,function(a){return a[b]})};m.where=function(a,b,c){return m.isEmpty(b)?c?void 0:[]:m[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})};m.findWhere=function(a,b){return m.where(a,
b,!0)};m.max=function(a,b,c){if(!b&&m.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&m.isEmpty(a))return-Infinity;var d={computed:-Infinity,value:-Infinity};u(a,function(a,e,g){e=b?b.call(c,a,e,g):a;e>d.computed&&(d={value:a,computed:e})});return d.value};m.min=function(a,b,c){if(!b&&m.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&m.isEmpty(a))return Infinity;var d={computed:Infinity,value:Infinity};u(a,function(a,e,g){e=b?b.call(c,a,
e,g):a;e<d.computed&&(d={value:a,computed:e})});return d.value};m.shuffle=function(a){var b,c=0,d=[];u(a,function(a){b=m.random(c++);d[c-1]=d[b];d[b]=a});return d};m.sample=function(a,b,c){return 2>arguments.length||c?a[m.random(a.length-1)]:m.shuffle(a).slice(0,Math.max(0,b))};var G=function(a){return m.isFunction(a)?a:function(b){return b[a]}};m.sortBy=function(a,b,c){var d=G(b);return m.pluck(m.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,
d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var H=function(a){return function(b,c,d){var e={},g=null==c?m.identity:G(c);u(b,function(c,l){var n=g.call(d,c,l,b);a(e,n,c)});return e}};m.groupBy=H(function(a,b,c){(m.has(a,b)?a[b]:a[b]=[]).push(c)});m.indexBy=H(function(a,b,c){a[b]=c});m.countBy=H(function(a,b){m.has(a,b)?a[b]++:a[b]=1});m.sortedIndex=function(a,b,c,d){c=null==c?m.identity:G(c);b=c.call(d,b);for(var e=0,g=a.length;e<
g;){var l=e+g>>>1;c.call(d,a[l])<b?e=l+1:g=l}return e};m.toArray=function(a){return a?m.isArray(a)?d.call(a):a.length===+a.length?m.map(a,m.identity):m.values(a):[]};m.size=function(a){return null==a?0:a.length===+a.length?a.length:m.keys(a).length};m.first=m.head=m.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:d.call(a,0,b)};m.initial=function(a,b,c){return d.call(a,0,a.length-(null==b||c?1:b))};m.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:d.call(a,Math.max(a.length-
b,0))};m.rest=m.tail=m.drop=function(a,b,c){return d.call(a,null==b||c?1:b)};m.compact=function(a){return m.filter(a,m.identity)};var L=function(a,b,d){if(b&&m.every(a,m.isArray))return e.apply(d,a);u(a,function(a){m.isArray(a)||m.isArguments(a)?b?c.apply(d,a):L(a,b,d):d.push(a)});return d};m.flatten=function(a,b){return L(a,b,[])};m.without=function(a){return m.difference(a,d.call(arguments,1))};m.uniq=m.unique=function(a,b,c,d){m.isFunction(b)&&(d=c,c=b,b=!1);c=c?m.map(a,c,d):a;var e=[],g=[];u(c,
function(c,d){(b?d&&g[g.length-1]===c:m.contains(g,c))||(g.push(c),e.push(a[d]))});return e};m.union=function(){return m.uniq(m.flatten(arguments,!0))};m.intersection=function(a){var b=d.call(arguments,1);return m.filter(m.uniq(a),function(a){return m.every(b,function(b){return 0<=m.indexOf(b,a)})})};m.difference=function(b){var c=e.apply(a,d.call(arguments,1));return m.filter(b,function(a){return!m.contains(c,a)})};m.zip=function(){for(var a=m.max(m.pluck(arguments,"length").concat(0)),b=Array(a),
c=0;c<a;c++)b[c]=m.pluck(arguments,""+c);return b};m.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c};m.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c)if("number"==typeof c)d=0>c?Math.max(0,e+c):c;else return d=m.sortedIndex(a,b),a[d]===b?d:-1;if(t&&a.indexOf===t)return a.indexOf(b,c);for(;d<e;d++)if(a[d]===b)return d;return-1};m.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(A&&a.lastIndexOf===
A)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=d?c:a.length;c--;)if(a[c]===b)return c;return-1};m.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,g=Array(d);e<d;)g[e++]=a,a+=c;return g};var I=function(){};m.bind=function(a,b){var c,e;if(D&&a.bind===D)return D.apply(a,d.call(arguments,1));if(!m.isFunction(a))throw new TypeError;c=d.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(b,c.concat(d.call(arguments)));
I.prototype=a.prototype;var g=new I;I.prototype=null;var l=a.apply(g,c.concat(d.call(arguments)));return Object(l)===l?l:g}};m.partial=function(a){var b=d.call(arguments,1);return function(){return a.apply(this,b.concat(d.call(arguments)))}};m.bindAll=function(a){var b=d.call(arguments,1);if(0===b.length)throw Error("bindAll must be passed function names");u(b,function(b){a[b]=m.bind(a[b],a)});return a};m.memoize=function(a,b){var c={};b||(b=m.identity);return function(){var d=b.apply(this,arguments);
return m.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}};m.delay=function(a,b){var c=d.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};m.defer=function(a){return m.delay.apply(m,[a,1].concat(d.call(arguments,1)))};m.throttle=function(a,b,c){var d,e,g,l=null,n=0;c||(c={});var f=function(){n=!1===c.leading?0:new Date;l=null;g=a.apply(d,e)};return function(){var w=new Date;n||!1!==c.leading||(n=w);var m=b-(w-n);d=this;e=arguments;0>=m?(clearTimeout(l),l=null,n=w,g=a.apply(d,e)):
l||!1===c.trailing||(l=setTimeout(f,m));return g}};m.debounce=function(a,b,c){var d,e,g,l,n;return function(){g=this;e=arguments;l=new Date;var f=function(){var w=new Date-l;w<b?d=setTimeout(f,b-w):(d=null,c||(n=a.apply(g,e)))},w=c&&!d;d||(d=setTimeout(f,b));w&&(n=a.apply(g,e));return n}};m.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;c=a.apply(this,arguments);a=null;return c}};m.wrap=function(a,b){return function(){var d=[a];c.apply(d,arguments);return b.apply(this,d)}};m.compose=
function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};m.after=function(a,b){return function(){if(1>--a)return b.apply(this,arguments)}};m.keys=E||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)m.has(a,c)&&b.push(c);return b};m.values=function(a){for(var b=m.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d};m.pairs=function(a){for(var b=m.keys(a),c=b.length,d=Array(c),e=0;e<
c;e++)d[e]=[b[e],a[b[e]]];return d};m.invert=function(a){for(var b={},c=m.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b};m.functions=m.methods=function(a){var b=[],c;for(c in a)m.isFunction(a[c])&&b.push(c);return b.sort()};m.extend=function(a){u(d.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]});return a};m.pick=function(b){var c={},g=e.apply(a,d.call(arguments,1));u(g,function(a){a in b&&(c[a]=b[a])});return c};m.omit=function(b){var c={},g=e.apply(a,d.call(arguments,1)),
l;for(l in b)m.contains(g,l)||(c[l]=b[l]);return c};m.defaults=function(a){u(d.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])});return a};m.clone=function(a){return m.isObject(a)?m.isArray(a)?a.slice():m.extend({},a):a};m.tap=function(a,b){b(a);return a};var J=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof m&&(a=a._wrapped);b instanceof m&&(b=b._wrapped);var e=g.call(a);if(e!=g.call(b))return!1;switch(e){case "[object String]":return a==
String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var l=c.length;l--;)if(c[l]==a)return d[l]==b;var l=a.constructor,n=b.constructor;if(l!==n&&!(m.isFunction(l)&&l instanceof l&&m.isFunction(n)&&n instanceof n))return!1;c.push(a);d.push(b);l=0;
n=!0;if("[object Array]"==e){if(l=a.length,n=l==b.length)for(;l--&&(n=J(a[l],b[l],c,d)););}else{for(var f in a)if(m.has(a,f)&&(l++,!(n=m.has(b,f)&&J(a[f],b[f],c,d))))break;if(n){for(f in b)if(m.has(b,f)&&!l--)break;n=!l}}c.pop();d.pop();return n};m.isEqual=function(a,b){return J(a,b,[],[])};m.isEmpty=function(a){if(null==a)return!0;if(m.isArray(a)||m.isString(a))return 0===a.length;for(var b in a)if(m.has(a,b))return!1;return!0};m.isElement=function(a){return!(!a||1!==a.nodeType)};m.isArray=b||function(a){return"[object Array]"==
g.call(a)};m.isObject=function(a){return a===Object(a)};u("Arguments Function String Number Date RegExp".split(" "),function(a){m["is"+a]=function(b){return g.call(b)=="[object "+a+"]"}});m.isArguments(arguments)||(m.isArguments=function(a){return!(!a||!m.has(a,"callee"))});"function"!==typeof/./&&(m.isFunction=function(a){return"function"===typeof a});m.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};m.isNaN=function(a){return m.isNumber(a)&&a!=+a};m.isBoolean=function(a){return!0===
a||!1===a||"[object Boolean]"==g.call(a)};m.isNull=function(a){return null===a};m.isUndefined=function(a){return void 0===a};m.has=function(a,b){return l.call(a,b)};m.noConflict=function(){h._=k;return this};m.identity=function(a){return a};m.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;e<a;e++)d[e]=b.call(c,e);return d};m.random=function(a,b){null==b&&(b=a,a=0);return a+Math.floor(Math.random()*(b-a+1))};var C={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};C.unescape=
m.invert(C.escape);var M={escape:new RegExp("["+m.keys(C.escape).join("")+"]","g"),unescape:new RegExp("("+m.keys(C.unescape).join("|")+")","g")};m.each(["escape","unescape"],function(a){m[a]=function(b){return null==b?"":(""+b).replace(M[a],function(b){return C[a][b]})}});m.result=function(a,b){if(null!=a){var c=a[b];return m.isFunction(c)?c.call(a):c}};m.mixin=function(a){u(m.functions(a),function(b){var d=m[b]=a[b];m.prototype[b]=function(){var a=[this._wrapped];c.apply(a,arguments);return N.call(this,
d.apply(m,a))}})};var z=0;m.uniqueId=function(a){var b=++z+"";return a?a+b:b};m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,Q={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t"},R=/\\|'|\r|\n|\t/g,P=["u2028","u2029"];m.template=function(a,b,c){var d;c=m.defaults({},c,m.templateSettings);var e=new RegExp([(c.escape||O).source,(c.interpolate||O).source,(c.evaluate||O).source].join("|")+"|$","g"),g=0,l="__p+='";a.replace(e,function(b,
c,d,e,n){l+=a.slice(g,n).replace(R,function(a){return"\\"+Q[a]}).replace(/\u2028/g,"\\"+P[0]).replace(/\u2029/g,"\\"+P[1]);c&&(l+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'");d&&(l+="'+\n((__t=("+d+"))==null?'':__t)+\n'");e&&(l+="';\n"+e+"\n__p+='");g=n+b.length;return b});l+="';\n";c.variable||(l="with(obj||{}){\n"+l+"}\n");l="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+l+"return __p;\n";try{d=new Function(c.variable||"obj","_",l)}catch(n){throw n.source=
l,n;}if(b)return d(b,m);b=function(a){return d.call(this,a,m)};b.source="function("+(c.variable||"obj")+"){\n"+l+"}";return b};m.chain=function(a){return m(a).chain()};var N=function(a){return this._chain?m(a).chain():a};m.mixin(m);u("pop push reverse shift sort splice unshift".split(" "),function(b){var c=a[b];m.prototype[b]=function(){var a=this._wrapped;c.apply(a,arguments);"shift"!=b&&"splice"!=b||0!==a.length||delete a[0];return N.call(this,a)}});u(["concat","join","slice"],function(b){var c=
a[b];m.prototype[b]=function(){return N.call(this,c.apply(this._wrapped,arguments))}});m.extend(m.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this);p.when("A").register("gb-event-emitter",function(h){return h.createClass({init:function(){this._events=this._events||{}},on:function(h,f){this._events[h]=this._events[h]||[];this._events[h].push(f)},off:function(h,f){!1!==h in this._events&&this._events[h].splice(this._events[h].indexOf(f),1)},
trigger:function(h){if(!1!==h in this._events)for(var f=0;f<this._events[h].length;f++)this._events[h][f].apply(this,Array.prototype.slice.call(arguments,1))}})});p.when("GoldboxMobile3PAssets").register("gb-enums",function(h){var k=h._;h={StatusFilters:{AVAILABLE:"available",UPCOMING:"upcoming",MISSED:"missed",ACTIVE:"active"},Realms:{CA:"CA",CN:"CN",DE:"DE",ES:"ES",FR:"FR",IT:"IT",IN:"IN",JP:"JP",US:"US",UK:"UK",MX:"MX",BR:"BR"},CategoryFilters:{ALL:"all"},DealTypes:{DOTD:"DEAL_OF_THE_DAY",LD:"LIGHTNING_DEAL",
BD:"BEST_DEAL",LOCAL:"LOCAL_DEAL",COUPON:"COUPON_DEAL",EVENT:"EVENT_DEAL"},DealStates:{LOADING:"LOADING",COMINGSOON:"COMINGSOON",AVAILABLE:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"SOLDOUT",UPCOMING:"UPCOMING",WAITLIST:"WAITLIST",WAITLISTFULL:"WAITLISTFULL"},FilterStates:{ACTIVE:"ACTIVE",MISSED:"MISSED",UPCOMING:"UPCOMING"},FilterConstants:{CUSTOM_FILTER:"customFilter"},DealStateToTemplateMap:{LOADING:"LOADING",AVAILABLE:"AVAILABLE",WAITLIST:"AVAILABLE",WAITLISTFULL:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"SOLDOUT",
UPCOMING:"UPCOMING",COMINGSOON:"COMINGSOON"},WatchedDealStateMap:{AVAILABLE:"AVAILABLE",WAITLIST:"AVAILABLE",WAITLISTFULL:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"EXPIRED",UPCOMING:"UPCOMING",COMINGSOON:"UPCOMING",LOADING:"AVAILABLE"},WatchDealActions:{ADD:"ADD",REMOVE:"REMOVE"},WatchDealPopoverActions:{SHOW_WATCH_POPUP:"SHOW",HIDE_WATCH_POPUP:"HIDE",UPDATE_WATCH_POPUP:"UPDATE"},SembuActions:{GET_COOKIE:"getValue",SET_COOKIE:"setValue"},WatchDealViewKeys:{GOLDBOX_DOMAIN:"goldbox",DISMISS_WATCHPOPUP_KEY:"dismissed_watch_popup"},
WatchDealConstants:{ANIMATE_DURATION:200},StateTemplates:{LOADING:"loading",AVAILABLE:"available",WAITLIST:"available",WAITLISTFULL:"available",COMINGSOON:"comingSoon",UPCOMING:"upcoming",SOLDOUT:"soldout",EXPIRED:"expired"},PurchaseStates:{ADD_TO_CART:"AddToCart",LEARN_MORE:"LearnMore",SEE_DEAL:"SeeDeal",JOIN_WAITLIST:"JoinWaitlist",WAITLIST_FULL:"WaitlistFull",CHOOSE_OPTIONS:"ChooseOptions",PENDINGATC:"PendingAddToCart",CLAIMED:"Claimed",INWAITLIST:"InWaitlist",INCART:"InCart"},DataTypes:{STRING:"string",
BOOL:"bool"},CustomerStates:{NONE:"NONE",INCART:"INCART",CLAIMED:"CLAIMED",INWAITLIST:"INWAITLIST",PENDINGATC:"PENDINGATC",EXPIRED:"EXPIRED"},AppStoreLink:{iOS:"itms-apps://itunes.apple.com/us/app/pages/id297606951?mt=8&uo=4",android:"market://details?id=com.amazon.mShop.android.shopping"},ButtonActions:{ATC:"gbdeal-addtocart",JW:"gbdeal-joinwaitlist",SO:"gbdeal-seeoptions",WTD:"gbdeal-watchdeal"},priceKind:{LIST_PRICE:"LP",OUR_PRICE:"OP",PRINT_LIST_PRICE:"PLP",DIGITAL_LIST_PRICE:"DLP"},merchantName:{US:"Amazon.com",
IT:"Amazon.it",ES:"Amazon.es",DE:"Amazon.de"},WidgetViewIDs:{A_POPOVER:"#a-popover-",CANCEL:"widgetRefineCancel",CART_ERROR:"cartError",CATEGORY_REFINE_CONTENT:"categoryRefineContent",CONTENT:"widgetContent",CONTENTROW:"widgetContentRow--LowEndDevice",FILTER_BUTTON:"filterButton",FILTER_CONTENT:"filterContent",FILTERS:"widgetFilters",HERO_HEADER:"heroHeader",LAUNCH_CELL:"launchCell",LOADING:"widgetLoading",SCROLL_CONTENT_LOADER:"scrollContentLoader",MINI_DP_MODAL:"mini_dp_modal_",NEXT_SHOVL_BUTTON:"nextShovlButton",
PAGINATION_ROW:"paginationRow",PRIME:"prime_",PREV_SHOVL_BUTTON:"previousShovlButton",REFINE:"widgetRefine",REFINE_POPOVER_NAME:"refine",SCROLL:"widgetScroll",SHOVL_PAGINATION:"shovlPagination",SHOVL_STATE_HEADER:"shovlStateHeader",SHOVL_FILTER:"shovlFilter",SORT_BUTTON:"sortButton"},WidgetViewSelectors:{NAV:"#a-page > nav",HEADER:"#heroHeader",DIVIDER:".dealDivider",REFINESTATE:".dealDivider + div",PAGINATION_ROW:".paginationRow",FILTER_BOX:".filterBox",TRIANGLE:".triangle",FILTERLINK:".filterLink",
PADCENTER:".padCenter"},dealViewIDs:{TITLE:"dealTitle",DESC_ABBR:"dealDescShort",DESC_REST:"dealDescRest",DUMMY_ELEMENT:"dummyElement",DEALCLOCK:"_dealClock",INCARTCLOCK:"_incartClock",PENDINGATCCLOCK:"_pendingATCClock",OPT_HEADER:"dealOptionsHeader",IMAGE:"dealImage",OPT_CONTENT:"dealOptionsContent",OPT_FOOTER:"dealOptionsFooter",SHARE:"dealShare",SHIP_SOLD:"shipSoldInfo"},dealViewClasses:{DESC_EXPANDER:"dealDescExpander",FOOTER:"footerElm--LowEndDevice"},ShovlConstants:{DISABLED:"disabled",SHOVL_NEXT:"shovelNext",
SHOVL_PREVIOUS:"shovelPrevious",SHOVL_STATE_TAB:"widgetCurrentTab"},WatchDealViewIDs:{WATCH_POPOVER:"watchDealPopover",WATCHING_IMAGE:"watchingImageDiv_",WATCH_BUTTON:"watchButton_",WATCH_BUTTON_TEXT:"watchButtonText_",MINI_DP_WATCH_BUTTON_MAPPING:{"GB-SUPPLE":"miniDPSuppleWatchButton"}},MobileClients:{AW:"aw",APP:"app",PC:"pc"},RedirectionLinks:{app:{ALL_DEALS:"/gp/mobile/deals/all-deals",BEST_DEAL:"/gp/mobile/deals/best-deals",DEAL_OF_THE_DAY:"/gp/mobile/deals/dotds",GATEWAY_PAGE:"/gp/mobile/deals",
LIGHTNING_DEAL:"/gp/mobile/deals/lightning-deals"},aw:{ALL_DEALS:"/gp/aw/gb/alldeals",BEST_DEAL:"/gp/aw/gb/bd",DEAL_OF_THE_DAY:"/gp/aw/gb/dotds",GATEWAY_PAGE:"/gp/aw/gb",LIGHTNING_DEAL:"/gp/aw/gb/ld"},pc:{ALL_DEALS:"/gp/goldbox/all-deals"}},ReviewsPageURL:{app:"/gp/mobile/reviews/",aw:"/gp/mobile/reviews/",pc:"/gp/product-reviews/"},AJAXLinks:{CDS:"/gp/mobile/deals/ajax/impressionTrackerV2.html",ADD_TO_CART:"/gp/deal/ajax/addToCart.html",WATCH_DEAL:"/gp/deal/ajax/watchDeal.html/ref=",GET_WATCHED:"/gp/deal/ajax/getWatchedDeals.html/ref=",
GDM:"/xa/dealcontent/v2/GetDealMetadata",GD:"/xa/dealcontent/v2/GetDeals",GDS:"/xa/dealcontent/v2/GetDealStatus",CD:"/gp/deal/ajax/claimDeal.html",UPDATE_EMBU:"/gp/mobile/deals/ajax/modifyEmbuData.html"},MiscLinks:{CART_URL:"/gp/cart/view.html",CART_URL_AW:"/gp/aw/c",LOCAL_URL:"/local",PURCHASE_URL:"/gp/goldbox/purchase"},WidgetNames:{M_HERO:"GB-M-HERO",M_SUPPLE:"GB-M-SUPPLE",MG_HERO:"GB-M-GRID-HERO",ML_HERO:"GB-M-LIST-HERO",PC_FACEOUT:"GB-PC-FACEOUT",PC_SUPPLE:"GB-SUPPLE",PC_SHOVELER:"GB-SHOVELER",
TAB_HERO:"GB-TAB-HERO",TAB_GRID_HERO:"GB-TAB-GRID-HERO",TAB_SUPPLE:"GB-TAB-SUPPLE"},WidgetConstants:{CURRENT_TAB:"widgetCurrentTab"},ChangeoverID:{AddedToCart:"gb_in_cart_co",Waitlisted:"gb_waitlisted_co",Subnav:"gb_subnav_change_hover"},ClientOrientation:{LANDSCAPE:"landscape",PORTRAIT:"portrait"},MashNavButtons:{LEFT:"navButtonLeft",RIGHT:"navButtonRight"},BottomSheetActions:{StopWatching:{label:"gb_m_stop_watching_deal",actionName:"gbdeal-watchdeal"},ShareDeal:{label:"gb_share_deal",actionName:"gbdeal-mashshare"}},
Direction:{UP:"up",DOWN:"down"},Constants:{MAX_TIMEOUT:2147483647,SECURE_IMAGES_URL_DEFAULT:"images-na.ssl-images-amazon.com",SECURE_IMAGES_URL_CN:"images-cn.ssl-images-amazon.com",MIN_DEAL_VIEW_WIDTH:200,MIN_TABLET_VIEW_WIDTH:200,MIN_PC_VIEW_WIDTH:250,SUPPLE_FILTER_COLUMN_WIDTH:235,MIN_NAV_WIDTH:1E3,MIN_TAB_WIDTH:735,PHONE_LANDSCAPE_COLUMN_COUNT:3,PHONE_PORTRAIT_COLUMN_COUNT:2,LOWER_END_IOS_MIN_HEIGHT:500,EGRESS_URL_UNSUPPORTED_REGEX:/\/dp\/|\/gp\/product\//,EXTRACT_ASIN_URL_REGEX:/(\/dp\/|\/gp\/product\/)([^\/]+)/,
REDIRECT_URL_REGEX:/redirectURL=([^&?]*)/,MAX_SUPPLE_DEALS_TO_DISPLAY:2,GET_DEALS_MAX_JITTER:2,HI_RES_SCALING_FACTOR:2,AJAX_ENDPOINT:"/xa/dealcontent/v2/",PAGINATED_METADATA_VERSION:"V2.2",NON_RETRYABLE_QUANTITY_RESTRICTION_VIOLATION_ERROR:"4002",MAX_DISPLAYABLE_VALUES_IN_UNEXPANDED_FILTER:12,ALL:"ALL",X_DIRECTION:"xDirection",Y_DIRECTION:"yDirection",MINUTE_IN_MILLIS:6E4},DeviceNames:{IPHONE:"iPhone",IPAD:"iPad",WIN_PHONE:"winPhone",ANDROID_PHONE:"androidPhone",ANDROID_TAB:"androidTab"},Weblabs:{TREATMENTS:{C:0,
T1:1,T2:2,T3:3,T4:4}},ItemTypes:{NONE:"NONE",SINGLE:"SINGLE_ITEM",MULTI:"MULTI_ITEM",VARIATION:"VARIATION_ITEM"},DealAccessTypes:{PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",PRIME_ONLY_BD:"PRIME_ONLY_BD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD",PRIME_ONLY_LD:"PRIME_ONLY_LD",APP_EARLY_ACCESS:"APP_EARLY_ACCESS",APP_ONLY_LD:"APP_ONLY_LD",GIVEAWAY_DEAL:"GIVEAWAY_DEAL"},PrimeSignUpURL:{PRIME_EARLY_ACCESS:"prime_signup_redirect",PRIME_ONLY_BD:"exclusive_bd_prime_signup_redirect",PRIME_ONLY_DOTD:"exclusive_dotd_prime_signup_redirect",
PRIME_ONLY_LD:"exclusive_access_prime_signup_redirect"},appDownloadURL:"http://www.amazon.in/b/ref=aeaodeals?node=6967393031",Platforms:{TAB:"tablet",PC:"pc",PHONE:"phone"},ClientIDPrefix:"goldbox_mobile",SortOrders:{BY_SCORE:"BY_SCORE",BY_RELEVANCE:"BY_RELEVANCE",BY_BEST_SELLING:"BY_BEST_SELLING",BY_PRICE_ASCENDING:"BY_PRICE_ASCENDING",BY_PRICE_DESCENDING:"BY_PRICE_DESCENDING",BY_DISCOUNT_ASCENDING:"BY_DISCOUNT_ASCENDING",BY_DISCOUNT_DESCENDING:"BY_DISCOUNT_DESCENDING",BY_START_TIME:"BY_START_TIME"},
SortOrdersToStringsMap:{BY_SCORE:"gb_sort_score",BY_RELEVANCE:"gb_sort_relevant",BY_BEST_SELLING:"gb_sort_bestselling",BY_PRICE_ASCENDING:"gb_sort_price_up",BY_PRICE_DESCENDING:"gb_sort_price_down",BY_DISCOUNT_ASCENDING:"gb_sort_discount_up",BY_DISCOUNT_DESCENDING:"gb_sort_discount_down",BY_START_TIME:"gb_sort_start_time"},RankingStrategies:{PERSONALIZED:"PERSONALIZED",CLAIMED_RATE:"CLAIMED_RATE",TRENDING:"TRENDING",NEW_TO_GL_EXCLUSIVE:"NEW_TO_GL_EXCLUSIVE",NEW_TO_GL_INCLUSIVE:"NEW_TO_GL_INCLUSIVE"},
PaginationDummyURLs:{PREV:"PREV",NEXT:"NEXT"},primeIconPositions:{RIGHT:"right",LEFT:"left"},ViewPortPresence:{ABSENT:"absent",FULL:"full",FULL_HORIZONTAL_CONTENT:"horizontal",FULL_VERTICAL_CONTENT:"vertical",PARTIAL_TOP:"top",PARTIAL_BOTTOM:"bottom",PARTIAL_LEFT:"left",PARTIAL_RIGHT:"right",PARTIAL_TOP_LEFT:"top_left",PARTIAL_TOP_RIGHT:"top_right",PARTIAL_BOTTOM_LEFT:"bottom_left",PARTIAL_BOTTOM_RIGHT:"bottom_right"},WidgetHeaderIDs:{WidgetHeader:"widgetHeaderContent_"},GiveawayUrlParams:{returnToUrl:"/gp/mobile/deals/ref=gagb",
client:"gbga",nav:"amz"},FilterAttrToStrings:{ACTIVE:"gb_active",APP_EARLY_ACCESS:"gb_app_early_access",APP_ONLY_LD:"gb_app_only_access",BEST_DEAL:"gb_best_deal",COUPON_DEAL:"gb_coupon_deal",DEAL_OF_THE_DAY:"gb_deal_of_the_day",DISCOUNT:"gb_discount_range",DISCOUNT_START:"gb_discount_range_start",DISCOUNT_END:"gb_discount_range_end",FREE_SHIPPING_ELIGIBLE_ONLY:"gb_free_shipping_eligible",GIFT_WRAPPABLE:"gb_gift_wrappable",GLOBAL_ELIGIBLE_ONLY:"gb_global_eligible",LIGHTNING_DEAL:"gb_lightning_deal",
MISSED:"gb_missed",NEW_RELEASES:"gb_new_release",PRICE:"gb_price_range",PRICE_START:"gb_price_range_start",PRICE_END:"gb_price_range_end",PRIME:"gb_prime_eligible",PRIME_EARLY_ACCESS:"gb_prime_early_access",PRIME_ONLY_LD:"gb_prime_only_ld",PRIME_ONLY_DOTD:"gb_prime_only_dotd",PRIME_SUMMARY:"gb_prime_summary",REVIEW_RATING:"gb_x_stars_and_up",UPCOMING:"gb_upcoming",CASH_ON_DELIVERY:"gb-is-cod-allowed",FULLFILLED_BY_AMAZON:"gb-fullfilled-by-amazon"},DealStatesToFilterStates:{AVAILABLE:"ACTIVE",EXPIRED:"MISSED",
UPCOMING:"UPCOMING",SOLDOUT:"MISSED",WAITLIST:"ACTIVE",WAITLISTFULL:"ACTIVE"},DCSQueryParams:{ACCESS_TYPE:"enforcedAccessTypes",BRANDS:"brands",CATEGORIES:"enforcedCategories",DEAL_STATE:"dealStates",DEAL_TYPE:"dealTypes",DISCOUNT_RANGE:"discountRanges",EXCLUDED_ACCESS_TYPE:"excludedAccessTypes",FREE_SHIPPING_ELIGIBLE_ONLY:"freeShippingEligibleOnly",GLOBAL_ELIGIBLE_ONLY:"globalEligibleOnly",INCLUDED_ACCESS_TYPE:"includedAccessTypes",MAX_PERCENT_OFF:"maxPercentOff",MAX_PRICE:"maxPrice",MIN_PERCENT_OFF:"minPercentOff",
MIN_PRICE:"minPrice",MIN_RATING:"minRating",PAGE:"page",PRICE_RANGE:"priceRanges",PRIME_ELIGIBLE_ONLY:"primeEligibleOnly",PRIME_ACCESS_TYPE:"primeAccessType",SORT_ORDER:"sortOrder"},BinNames:{BRANDS:"brands",CATEGORIES:"whitelist_categories",DISCOUNT:"discount_range",FREE_SHIPPING_ELIGIBLE_ONLY:"is_eligible_for_free_shipping",INCLUDED_DEAL_TARGETS:"included_deal_targets",GLOBAL_ELIGIBLE_ONLY:"is_global_eligible",PRIME_ELIGIBLE_ONLY:"is_prime",PRICE:"price_range"},IncludedDealTargetsSupported:{MARKETING_ID:"MARKETING_ID",
MARKETING_ID_ONLY_SUMMARY:"marketing_id"},BinCounts:{BRANDS:100,CATEGORIES:100,DISCOUNT:20,FREE_SHIPPING_ELIGIBLE_ONLY:2,INCLUDED_DEAL_TARGETS:1E3,GLOBAL_ELIGIBLE_ONLY:2,PRIME_ELIGIBLE_ONLY:2,PRICE:20},CustomerAppliedFilters:{PAGE:"p",CATEGORY:"c",STATUS:"s"},BrowserHistory:{STATE_KEY:"gb_hero_f_"},DefaultPollingIntervals:{LD:12E3},RoundedReviewStarsThresholds:{LOW:.3,HIGH:.7},CellSizeClasses:{SINGLE:"singleCell",DOUBLE:"doubleCell"},WidgetActions:{Faceout:{SHOVEL:"gbshovel-pagination-faceout",TILE_SELECTED:"gbselect-tile-faceout"},
Filter:{CLEAR_ALL:"gbfilter-clear-all"},Shoveler:{SHOVEL:"gbshovel-pagination-shoveler"}},AGSMerchantsID:{MX_DEVO:"A2WNUS5VO5EKRE",MX_PROD:"A3BWELMBWVCY9T"}};var f=h.DCSQueryParams;h.BinningParams={BRANDS:{key:"brands",dcsKey:f.BRANDS},CATEGORIES:{key:"whitelist_categories",dcsKey:f.CATEGORIES},DEAL_STATE:{key:"deal_state",dcsKey:f.DEAL_STATE},DEAL_TYPE:{key:"deal_type",dcsKey:f.DEAL_TYPE},DISCOUNT:{key:"discount_range",dcsKey:[f.MIN_PERCENT_OFF,f.MAX_PERCENT_OFF]},FREE_SHIPPING_ELIGIBLE_ONLY:{key:"is_eligible_for_free_shipping",
dcsKey:f.FREE_SHIPPING_ELIGIBLE_ONLY},PRICE:{key:"price_range",dcsKey:[f.MIN_PRICE,f.MAX_PRICE]},REVIEW_RATING:{key:"reviews",dcsKey:f.MIN_RATING},GLOBAL_ELIGIBLE_ONLY:{key:"is_global_eligible",dcsKey:f.GLOBAL_ELIGIBLE_ONLY},PAGE:{key:"page",dcsKey:f.PAGE},PRIME_ELIGIBLE_ONLY:{key:"is_prime",dcsKey:f.PRIME_ELIGIBLE_ONLY},PRIME_ACCESS_TYPE:{key:"prime_access_type",dcsKey:f.PRIME_ACCESS_TYPE},SORT_ORDER:{key:"sortOrder",dcsKey:f.SORT_ORDER},CASH_ON_DELIVERY:{key:"isCODAllowed",dcsKey:null},FULLFILLED_BY_AMAZON:{key:"isFulfilledByAmazon",
dcsKey:null},NEW_RELEASES:{key:"newReleases",dcsKey:null},GIFT_WRAPPABLE:{key:"giftWrappable",dcsKey:null},ACCESS_TYPE:{key:"access_type",dcsKey:f.ACCESS_TYPE},EXCLUDED_ACCESS_TYPE:{key:"excluded_access_type",dcsKey:f.EXCLUDED_ACCESS_TYPE},INCLUDED_ACCESS_TYPE:{key:"included_access_type",dcsKey:f.INCLUDED_ACCESS_TYPE}};f=h.BinningParams;h.excludeBinningParamsForEvents=[f.PRICE.key,f.DISCOUNT.key];f=h.SortOrders;h.SortOrderLists={Events:[f.BY_RELEVANCE,f.BY_BEST_SELLING,f.BY_PRICE_ASCENDING,f.BY_PRICE_DESCENDING],
Deals:[f.BY_SCORE,f.BY_BEST_SELLING,f.BY_PRICE_ASCENDING,f.BY_PRICE_DESCENDING,f.BY_DISCOUNT_ASCENDING,f.BY_DISCOUNT_DESCENDING]};(function(a){a.BinningKeyToDCSQueryParamMap={};k.each(a.BinningParams,function(b){a.BinningKeyToDCSQueryParamMap[b.key]=b.dcsKey});a.FilterAttrToBinName={};k.each(k.keys(a.BinningParams),function(b){var c=a.BinningParams[b].key;a.FilterAttrToBinName[c]=c===a.BinningParams.NEW_RELEASES.key||c===a.BinningParams.GIFT_WRAPPABLE.key?a.BinNames.INCLUDED_DEAL_TARGETS:a.BinNames[b]||
null});a.BinNamesToCount=k.object(k.values(a.BinNames),k.values(a.BinCounts));a.FilterStatesToDealStates={};k.each(k.keys(a.DealStatesToFilterStates),function(b){var c=a.DealStatesToFilterStates[b];a.FilterStatesToDealStates[c]=a.FilterStatesToDealStates[c]?a.FilterStatesToDealStates[c].concat([b]):[b]})})(h);return h});p.when("A","gb-enums").register("gb-base-utils",function(h,r){return{locale:null,checkAndSetSSLImageUrl:function(f){if("https:"===k.location.protocol&&f&&-1!==f.indexOf("http://")){var a=
r.Constants.SECURE_IMAGES_URL_DEFAULT;gb.resources&&gb.resources.customerData&&"CN"===gb.resources.customerData.realm&&(a=r.Constants.SECURE_IMAGES_URL_CN);var b=document.createElement("a");b.href=f;b.protocol="https:";b.hostname=a;f=b.href}return f}}});p.when("A","GoldboxMobile3PAssets","gb-base-utils").register("gb-resources",function(h,r,f){var a=r._;k.gb.baseUtils=k.gb.baseUtils||f;return{strings:{},images:{},features:{},customerData:{},categories:[],marketingIDs:[],deviceInfo:{},urls:{},whitelistedCategoryList:[],
whitelistedCategoryNames:{},whitelistedCategoryNamesParsed:{},whitelistedMarketingIDList:[],whitelistedMarketingIDNames:{},whitelistedMarketingIDNamesParsed:{},apiConfigs:{},skewedClkDiff:{},publishResourceAvailability:!0,registerResources:function(a){this.registerStrings(a.strings);this.registerFeatures(a.weblabs);this.registerCustomerData(a.customerData);this.registerCategories(a.categories);this.registerMarketingIDs(a.marketingIDs);this.registerDeviceInfo(a.deviceInfo);this.registerUrls(a.urls);
this.registerImages(a.images);this.registerServerTimeStamp(a.referenceServerTimeStamp);this.registerAPIConfigs(a.apiConfigs);this.publishResourceAvailability&&(p.declare("goldboxResources",this),this.publishResourceAvailability=!1)},registerStrings:function(a){this.updateResourceStore(this.strings,a)},getString:function(a,c){var d=this.strings[a]||"";if(c)for(var e in c)c.hasOwnProperty(e)&&(d=d.replace(new RegExp("\\${"+e+"}","g"),c[e]));return d},getCategoryName:function(a,c){return c?this.whitelistedCategoryNamesParsed[a]:
this.whitelistedCategoryNames[a]||null},registerImages:function(b){a.each(b,function(a,d){b[d]=gb.baseUtils.checkAndSetSSLImageUrl(a)});this.updateResourceStore(this.images,b)},getImage:function(a){return this.images[a]},registerServerTimeStamp:function(a){var c=new Date,c=new Date(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds());this.skewedClkDiff=Math.abs(c-new Date(a))},getServerClientClkDifference:function(){return this.skewedClkDiff},
registerFeatures:function(a){this.updateResourceStore(this.features,a)},getFeature:function(a){return this.features[a]},registerCustomerData:function(a){this.updateResourceStore(this.customerData,a)},getCustomerData:function(a){return this.customerData[a]},registerCategories:a.once(function(b){var c=this;this.updateResourceStore(this.categories,b);a.each(this.categories,function(b){c.whitelistedCategoryList.push(b.nodeId);c.whitelistedCategoryNames[b.nodeId]=b.category;c.whitelistedCategoryNamesParsed[b.nodeId]=
a.unescape(b.category)})}),registerMarketingIDs:a.once(function(b){var c=this;this.updateResourceStore(this.marketingIDs,b);a.each(this.marketingIDs,function(b){c.whitelistedMarketingIDList.push(b.marketingID);c.whitelistedMarketingIDNames[b.marketingID]=b.string;c.whitelistedMarketingIDNamesParsed[b.marketingID]=a.unescape(b.string)})}),getCategories:function(){return this.categories},registerDeviceInfo:function(a){this.updateResourceStore(this.deviceInfo,a);gb.clientName="pc";this.deviceInfo.isApp?
gb.clientName="app":this.deviceInfo.isPhone&&!this.deviceInfo.isAWDesktopViewEnforced&&(gb.clientName="aw")},getDeviceInfo:function(){return this.deviceInfo},registerUrls:function(a){this.updateResourceStore(this.urls,a)},getUrl:function(a){return this.urls[a]},updateResourceStore:function(a,c){if(c&&a)for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])},registerAPIConfigs:function(a){this.updateResourceStore(this.apiConfigs,a)},getAPIConfigs:function(){return this.apiConfigs}}});p.when("A","GoldboxMobile3PAssets").register("gb-utilities",
function(h,r){var f=r._;return{digitalCategories:{US:"16261631 2350149011 154606011 163856011 979455011 1233514011 2402172011".split(" ")},digitalGlProductGroup:"gl_digital_book_service gl_digital_ebook_purchase gl_digital_music_purchase gl_digital_video_download gl_downloadable_software gl_ebooks gl_digital_video_games gl_mobile_apps gl_digital_software".split(" "),defaultImageScaling:"AA",detailPageUrlPrefix:{pc:"/dp/",aw:"/gp/aw/d/",app:"/gp/aw/d/",tablet:"/gp/mobile/dp/"},requestObjSortBy:{includedBins:"name",
dealGroups:"keys",excludedExtendedFilters:"keys",extendedFilters:"keys",exclusiveTargetValues:"name",inclusiveTargetValues:"name",dealTargets:"dealID"},stateToDealViewTemplates:{PRIME_EARLY_ACCESS:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType primeEarlyAccess couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeEarlyAccess primeBadge shipSold dealType primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
APP_EARLY_ACCESS:{LOADING:[],AVAILABLE:"appEarlyAccess image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"appEarlyAccess image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},PRIME_ONLY_LD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
PRIME_ONLY_DOTD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},PRIME_ONLY_BD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
APP_ONLY_LD:{LOADING:[],AVAILABLE:"appOnlyAccess image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"appOnlyAccess image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},GIVEAWAY_DEAL:{LOADING:[],AVAILABLE:"image title description priceBlock ifdMessage button giveaway dealType merchant selector dealAction widgetErrorAlert".split(" "),
COMINGSOON:[],UPCOMING:[],SOLDOUT:[],EXPIRED:[]},NONE:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")}},price:{CA:{currency:"CAD",decimal:2,format:function(a){return("C$"+a).replace(",","")}},US:{currency:"USD",decimal:2,
format:function(a){return"$"+a}},UK:{currency:"GBP",decimal:2,format:function(a){return"&pound;"+a}},DE:{currency:"EUR",decimal:2,format:function(a){return(a+" &euro;").replace(".",",")}},FR:{currency:"EUR",decimal:2,format:function(a){return(a+" &euro;").replace(".",",")}},JP:{currency:"JPY",decimal:0,format:function(a){return"&yen; "+a}},CN:{currency:"CNY",decimal:2,format:function(a){return"&yen;"+a}},IN:{currency:"INR",decimals:2,format:function(a){return"&#8377;"+a}},IT:{currency:"EUR",decimal:2,
format:function(a){return(a+" &euro;").replace(".",",")}},ES:{currency:"EUR",decimal:2,format:function(a){return(a+" &euro;").replace(".",",")}},MX:{currency:"MXN",decimal:2,format:function(a){return"$"+a}},BR:{currency:"BRL",decimal:2,format:function(a){return("R$ "+a).replace(".",",")}}},ppuRealms:["UK","DE","FR","ES","IT"],refSkewedClkDuration:{ONEMIN:6E4,TWOMIN:12E4},recordSkewedClockdifferences:f.once(function(){var a=gb.resources.getServerClientClkDifference();a&&a<this.refSkewedClkDuration.ONEMIN?
(a="goldbox:clientClockSkew:lessthanOneMin",ue.count(a,(ue.count(a)||0)+1)):a&&a>=this.refSkewedClkDuration.ONEMIN&&a<this.refSkewedClkDuration.TWOMIN?(a="goldbox:clientClockSkew:greaterthanOneMin",ue.count(a,(ue.count(a)||0)+1)):a&&a>=this.refSkewedClkDuration.TWOMIN&&(a="goldbox:clientClockSkew:greaterthanTwoMin",ue.count(a,(ue.count(a)||0)+1))}),getAppStoreURL:function(){var a="";gb.resources.deviceInfo.isApp&&(gb.resources.deviceInfo.isIOS?a=gb.enums.AppStoreLink.iOS:gb.resources.deviceInfo.isAndroid&&
(a=gb.enums.AppStoreLink.android));return a},commifyNumber:function(a,b){a=parseFloat(a);a=b!==q||null!==b?a.toFixed(b):a.toString();for(var c=a.split("."),d=c[0],e=d.length-3;0<e;e-=3)d=d.substr(0,e)+","+d.substr(e,d.length-e);return 2===c.length?d+"."+c[1]:d},getFormattedPrice:function(a){var b=gb.resources.getCustomerData("realm"),b=this.price[b],c=document.createElement("span");h.$(c).html(b.format(this.commifyNumber(a,b.decimal)));return c.innerHTML},recordImageMetricMarker:function(a,b,c){if(ue&&
"function"===typeof ue.count){var d="ImgLoad";c&&(d+=":"+c);switch(a){case "load":ue.count(d+":success",(ue.count(d+":success")||0)+1);if(a=parseInt(b.getAttribute("data-render-start"),10))a=(new Date).getTime()-a,ue.count(d+":time",a);break;case "error":ue.count(d+":error",(ue.count(d+":error")||0)+1)}}},getPriceRange:function(a){var b=null;a.max.value>a.min.value&&(b=a.min.formattedValue+" - "+a.max.formattedValue);return b},getSubnavPageElementFromDomID:function(a){return h.$("#"+h.$("#"+a).parent().parent().prop("id"))},
getSubnavSlotID:function(a,b){return gb.subnavController.SubnavIDs.SubnavPage+a+"slot"+b},parseBool:function(a){return!0===a||1===a||"1"===a},getDealViewID:function(a,b){return a+"_dealView_"+b},getAdRowID:function(a,b){return a+"_adSlot_"+b},getPageID:function(a,b){return a+"_page_"+b},getFilterItemViewID:function(a,b){return"FilterItemView_"+a.join("-")+"_"+b},resizeImage:function(a,b,c){a=a||gb.resources.getImage("goldbox_upcoming");a.substring(a.lastIndexOf(".")+1).toLowerCase()in{jpg:!0,jpeg:!0,
png:!0,gif:!0,tif:!0}||(a=gb.resources.getImage("goldbox_upcoming"));if(b===q||null===b)return a;if(c===q||null===c)c=this.defaultImageScaling;return a.replace(/\.((_.*_)\.)?(\w+)$/,".$2_"+c+b+"_.$3")},getViewTemplatesForState:function(a){var b=gb.enums.DealStateToTemplateMap[a.dealState];return a.dealType===gb.enums.DealTypes.EVENT?b===gb.enums.DealStates.LOADING?this.stateToDealViewTemplates.NONE.LOADING:this.stateToDealViewTemplates.NONE.AVAILABLE:a.detail.isPrimeOnly&&!gb.utils.isPODealForNonPrimeUser(a)||
!a.detail.accessType?this.stateToDealViewTemplates.NONE[b]||[]:this.stateToDealViewTemplates[a.detail.accessType][b]||[]},getStateTemplateName:function(a,b){return b===gb.enums.DealTypes.EVENT?a===gb.enums.DealStates.LOADING?gb.enums.StateTemplates.LOADING:gb.enums.StateTemplates.AVAILABLE:gb.enums.StateTemplates[a]},calculatePercentOff:function(a,b){if(null===a||a===q||null===b||b===q||"number"!==typeof a||"number"!==typeof b||0===a)return null;var c=a-b;if(0>=c)return null;var d=0;"CN"===gb.resources.getCustomerData("realm")?
(d=1,c=10*(1-c/a)):c=c/a*100;return Math.round(c*Math.pow(10,d))/Math.pow(10,d)},getDisplayablePercentOff:function(a){return a&&"number"===typeof a?"CN"===gb.resources.getCustomerData("realm")?(100-a)/10:a:null},heroTimer:function(a,b,c,d){a={dealDate:a,viewElement:b,spanID:c,update:function(){var a=this,g=a.dealDate.getTime()-(new Date).getTime();0>g&&(g=0);var l=Math.floor(g/36E5%60),n=Math.floor(g/6E4%60),g=Math.floor(g/1E3%60);if(d)10>g&&(g="0"+g),10>n&&(n="0"+n),a.timeString=0!==l?l+":"+n+":"+
g:n+":"+g;else{10>l&&(l="0"+l);10>n&&!a.noHours&&(n="0"+n);10>g&&(g="0"+g);var f=gb.resources.getString("gbd_hour_separator")+" ",r=gb.resources.getString("gbd_minute_separator")+" ",B=gb.resources.getString("gbd_seconds_separator")+" ";a.timeString=l+f+n+r+g+B;gb.accessibility.trigger("AccessibilityAction","updateHeroTimer",{viewElement:b,spanID:c,timerInfo:{hours:l,minutes:n,seconds:g}})}h.$(b).find("#"+c).html(a.timeString);a.timeout&&k.clearTimeout(a.timeout);a.timeout=k.setTimeout(function(){a.update()},
500)}};a.update();return a},formatDate:function(a){var b=gb.resources.getString("gb_month_"+a.getMonth());a=a.getDate();10>a&&(a="0"+a);return gb.resources.getString("gb_date_format",{month:b,day:a,date_suffix:gb.resources.getString("gb_date")})},formatTime:function(a,b){var c="";if(24<a)return c;var c=gb.resources.getCustomerData("realm"),d=12<=a?gb.resources.getString("gb_pm"):gb.resources.getString("gb_am"),e=f.contains([gb.enums.Realms.US,gb.enums.Realms.UK,gb.enums.Realms.IN,gb.enums.Realms.MX],
c)?!1:!0;10>b&&(b="0"+b);e?(10>a&&(c===gb.enums.Realms.DE||c===gb.enums.Realms.FR)&&(a="0"+a),d=""):a=a%12||12;return c=gb.resources.getString("gb_time",{hours:a,minutes:b,period:d})},ellipsify:function(a){var b=a.el,c=a.jQuery,d=a.wordsIntact;a=a.removeDots;var e=b.clone().empty().css({display:"none",height:"auto"}).width(b.width());b.width(b.width());c(b).after(e);var g=c.trim(b.html());e.html(g);if(!(e.height()<=b.height())){e.empty();for(var l=0,n=0,f=g.length;l<g.length&&n<f;)l=Math.floor((n+
f)/2),a?e.html(g.substr(0,l)):e.html(g.substr(0,l)+"..."),e.height()<=b.height()?n=l+1:f=l-1;g=g.substr(0,n-1);d&&(d=g.lastIndexOf(" "),g=g.substr(0,d));a||(g+="...");b.html(g)}c(e).remove()},setUrlParam:function(a,b,c){var d=a.indexOf("#"),e=-1===d?"":a.substr(d);a=-1===d?a:a.substr(0,d);b=encodeURIComponent(b);var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),g=-1!==a.indexOf("?")?"&":"?";a=a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+g+b+"="+c;return a+e},clearUrlParam:function(a,b){var c=a.indexOf("#"),
d=-1===c?"":a.substr(c);a=-1===c?a:a.substr(0,c);b=encodeURIComponent(b);c=new RegExp("([?&])"+b+"=.*?(&|$)","gi");a.match(c)&&(a=a.replace(c,"$1"),a=a.replace(/[?&]$/,""));return a+d},enforceUTFEncodingInUrl:function(a){a=this.clearUrlParam(a,"ie");return this.setUrlParam(a,"ie","UTF8")},setUrlHash:function(a,b){var c=a.indexOf("#");a=-1===c?a:a.substr(0,c);return b?a+"#"+b:a},setSafeTimeout:function(a,b){if(0<b&&b<gb.enums.Constants.MAX_TIMEOUT)return k.setTimeout(a,b)},getDetailPageURL:function(a,
b){var c=this.detailPageUrlPrefix[b]+a;gb.resources.deviceInfo.isApp&&!gb.resources.deviceInfo.isIPhone&&(c=gb.utils.setUrlParam(c,"app-action","detail"),c=gb.utils.setUrlParam(c,"asin",a));return c},hasConflictingDpParams:function(a){var b=!1;a=a.split("?")[1]?"&"+a.split("?")[1]:null;var c=["smid","m","me"];if(a)for(var d=0;d<c.length;d++)if(0<=a.indexOf("&"+c[d]+"=")){b=!0;break}return b},getReviewsPageURL:function(a,b){return gb.enums.ReviewsPageURL[gb.clientName]+a},getShovelerWidth:function(a){var b=
gb.configManager.getDealViewConfig(a.widgetID),c=gb.configManager.getWidgetViewConfig(a.widgetID),d=parseInt(b.dealsLimit,10),e=parseInt(b.imageSize,10),b=parseInt(b.dealsMargin,10),g=parseInt(c.redirectDivWidth,10),l=parseInt(c.redirectDivLeftMargin,10),c=parseInt(c.redirectDivRightMargin,10),n=0,f=0,h=0;a.totalDealsToShowCount>d?(f=d-6,h=(e+b)*f+l+g+c,n=1):(f=a.totalDealsToShowCount,h=(e+b)*f);return{redirectDivWidth:g,showRedirectDiv:n,shovelerDealsToShow:f,shovelerWidth:h}},pushAddressInBrowserHistory:function(a,
b,c){return k.history&&"function"===typeof history.pushState&&"function"===typeof history.replaceState?(c=c||{},b?(f.isEmpty(k.history.state)&&k.history.replaceState({state:"initialLoad"},"",k.location.href),k.history.pushState(c,"",a)):k.history.state&&k.history.state.bottom_sheet_open?k.setTimeout(function(){k.history.replaceState(c,"",a)},1E3):k.history.replaceState(c,"",a),gb.metrics.recordRefViaAjax(this.extractRefFromUrl(a)),!0):!1},updateAddressBarUrl:function(a,b,c){this.pushAddressInBrowserHistory(a,
b,c)||(k.location.href=a)},getParamValueFromUrl:function(a,b){b=b.replace(/[\[]/,"[").replace(/[\]]/,"]");var c=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(a);return c?k.decodeURIComponent(c[1].replace(/\+/g," ")):""},getHashOfAppliedFilters:function(a){var b={};a=a.split(",");for(var c=0;c<a.length;c++){var d=a[c].split(":");b[d[0]]=d[1]}return b},_getFiltersAppliedUrl:function(a,b,c,d){return this.setUrlParam(k.location.href,gb.enums.BrowserHistory.STATE_KEY+a,gb.enums.CustomerAppliedFilters.PAGE+
":"+b+","+gb.enums.CustomerAppliedFilters.CATEGORY+":"+c+","+gb.enums.CustomerAppliedFilters.STATUS+":"+d)},updateFiltersInAddressBar:function(a,b,c,d){a=this._getFiltersAppliedUrl(a,b,c,d);this.updateAddressBarUrl(a)},getWidgetLandingPageUrl:function(a){return this.getParamValueFromUrl(k.location.href,gb.enums.BrowserHistory.STATE_KEY+a)?this._getFiltersAppliedUrl(a,1,gb.enums.CategoryFilters.ALL,gb.enums.StatusFilters.AVAILABLE):k.location.href},getCustomerActionTemplateInfo:function(a,b){var c=
a.dealState,d=a.detail.itemType,e=a.status.percentClaimed,g=a.customerState,l=a.dealType,n={},f=!0,h=!0,k=!0,r=!1,p=gb.resources.deviceInfo,q=gb.configManager.getDealViewConfig(b);n.showWatchDealButton=!1;gb.controller.schedulingParams[b]&&gb.controller.schedulingParams[b].fetchWatchedDeals&&l===gb.enums.DealTypes.LD&&(n.showWatchDealButton=!0);if(d===gb.enums.ItemTypes.SINGLE)if(l===gb.enums.DealTypes.LD)switch(r=this._shouldShowWaitlistFeatures(p),c===gb.enums.DealStates.AVAILABLE?(n.purchaseState=
gb.enums.PurchaseStates.ADD_TO_CART,n.buttonText=gb.resources.getString("gb_add_to_cart")):(n.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,n.buttonText=gb.resources.getString("gb_view_deal")),r&&(c===gb.enums.DealStates.WAITLIST?(n.purchaseState=gb.enums.PurchaseStates.JOIN_WAITLIST,n.buttonText=gb.resources.getString("gbd_join_waitlist")):c===gb.enums.DealStates.WAITLISTFULL&&(n.purchaseState=gb.enums.PurchaseStates.WAITLIST_FULL,f=null),g===gb.enums.CustomerStates.INWAITLIST&&(n.purchaseState=
gb.enums.PurchaseStates.INWAITLIST,n.buttonText=gb.resources.getString("gb_add_to_cart"),f=null,k=!this.isTablet(gb.clientName))),g){case gb.enums.CustomerStates.INCART:n.purchaseState=gb.enums.PurchaseStates.INCART;f=null;k=!this.isTablet(gb.clientName);h=null;break;case gb.enums.CustomerStates.CLAIMED:n.purchaseState=gb.enums.PurchaseStates.CLAIMED;f=null;k=!this.isTablet(gb.clientName);h=null;break;case gb.enums.CustomerStates.PENDINGATC:n.purchaseState=gb.enums.PurchaseStates.PENDINGATC,n.buttonText=
gb.resources.getString("gb_add_to_cart"),k=!this.isTablet(gb.clientName),h=null}else k=!this.isTablet(gb.clientName),n.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,n.buttonText=gb.resources.getString("gb_add_to_cart");else if(d===gb.enums.ItemTypes.VARIATION){if(k=!0,c=gb.resources.deviceInfo.isPhone,l=gb.utils.isTablet(gb.clientName),n.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,n.buttonText=gb.resources.getString("gb_see_options"),c||l&&gb.resources.deviceInfo.isApp)n.buttonText=gb.resources.getString("gb_view_deal")}else d===
gb.enums.ItemTypes.MULTI?(k=!this.isTablet(gb.clientName),n.buttonText=gb.resources.getString("gb_view_deal")):(n.buttonText=l===gb.enums.DealTypes.COUPON?gb.resources.getString("gb_clip_coupon"):gb.resources.getString("gb_view_deal"),k=!this.isTablet(gb.clientName)),n.purchaseState=gb.enums.PurchaseStates.SEE_DEAL;n.showButton=f;n.showTime=h;n.showPercentClaimed=k;n.showWaitlistFeatures=r;d===gb.enums.ItemTypes.SINGLE&&a.isDigital&&(n.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,n.buttonText=gb.resources.getString("gb_view_deal"));
if(this._isPurchaseStateOverrideRequiredForAppDeals(a,g)||this._isPurchaseStateOverrideRequiredForPrimeDeals(a))n.purchaseState=gb.enums.PurchaseStates.LEARN_MORE,n.buttonText=gb.resources.getString("gb_learn_more"),n.showButton=!0,n.showTime=!0,n.showPercentClaimed=a.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&a.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_BD?!0:!1;n.primeSignUpUrl=this.getPrimeSignUpUrlForAccessType(a);n.appDownloadUrl=gb.enums.appDownloadURL;n.showPercentClaimed=
n.showPercentClaimed&&this._shouldShowPercentClaimed(e,q);this._setTemplateDataForMetroApp(n);n.shouldDisplayIFDMessage=this.shouldDisplayIFDMessage(a);return n},_shouldShowWaitlistFeatures:function(a){var b=a.isIOS,c=a.isAndroid||a.isAndroidUserAgent,d=a.isFirePhone,e=a.isPhone,g=this.isTablet(gb.clientName);a=a.isAppVersionHigher;var l=gb.resources.getFeature("waitlist_feature_mobile_IOS"),n=gb.resources.getFeature("waitlist_feature_tablet_IOS"),f=gb.resources.getFeature("waitlist_feature_mobile_Android"),
h=gb.resources.getFeature("waitlist_feature_tablet_Android"),g=g&&a&&(b&&n||c&&h),b=e&&(b&&l||c&&f);return gb.clientName===gb.enums.MobileClients.PC?!0:d&&a&&h||g||b},_isPurchaseStateOverrideRequiredForAppDeals:function(a,b){return(a.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&this.isDealInEarlyAccessWindow(a)||a.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)&&b!==gb.enums.CustomerStates.INCART&&b!==gb.enums.CustomerStates.CLAIMED?!0:!1},_isPurchaseStateOverrideRequiredForPrimeDeals:function(a){return(this.isDealInEarlyAccessWindow(a)&&
a.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a.detail.isPrimeOnly)&&!gb.resources.customerData.hasEarlyAccessBenefit?!0:!1},getVariationCustomerActionTemplateInfo:function(a,b){var c=a.deal,d=c.detail.itemType,e=c.dealState,e=b?b.status.itemState:e,g=b?b.status.percentClaimed:c.status.percentClaimed,l=b?b.status.customerState:c.customerState,n={},f=!0,h=!0,k=!0,r=!1,p=a.widgetView.widgetID,q=gb.configManager.getDealViewConfig(p);if(c.dealType===gb.enums.DealTypes.LD&&d===gb.enums.ItemTypes.VARIATION){if(gb.clientName===
gb.enums.MobileClients.PC||gb.widgets[p].widgetName===gb.enums.WidgetNames.ML_HERO)r=!0;n.showWatchDealButton=!1;gb.controller.schedulingParams[p]&&gb.controller.schedulingParams[p].fetchWatchedDeals&&(n.showWatchDealButton=!0);if(e===gb.enums.DealStates.AVAILABLE||e===gb.enums.DealStates.SOLDOUT)n.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,n.buttonText=gb.resources.getString("gb_add_to_cart");r&&(e===gb.enums.DealStates.WAITLIST?(n.purchaseState=gb.enums.PurchaseStates.JOIN_WAITLIST,n.buttonText=
gb.resources.getString("gbd_join_waitlist")):e===gb.enums.DealStates.WAITLISTFULL&&(n.purchaseState=gb.enums.PurchaseStates.WAITLIST_FULL,f=null),l===gb.enums.CustomerStates.INWAITLIST&&(n.purchaseState=gb.enums.PurchaseStates.INWAITLIST,n.buttonText=gb.resources.getString("gb_add_to_cart"),f=null,k=!this.isTablet(gb.clientName)));l===gb.enums.CustomerStates.INCART?(n.purchaseState=gb.enums.PurchaseStates.INCART,f=null,k=!this.isTablet(gb.clientName),h=null):l===gb.enums.CustomerStates.CLAIMED?(n.purchaseState=
gb.enums.PurchaseStates.CLAIMED,f=null,k=!this.isTablet(gb.clientName),h=null):l===gb.enums.CustomerStates.PENDINGATC&&(n.purchaseState=gb.enums.PurchaseStates.PENDINGATC,n.buttonText=gb.resources.getString("gb_add_to_cart"),k=!this.isTablet(gb.clientName),h=null)}n.showButton=f;n.showTime=h;n.showPercentClaimed=k;n.showWaitlistFeatures=r;if(c.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&this.isDealInEarlyAccessWindow(c)||c.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD||
(this.isDealInEarlyAccessWindow(c)||c.detail.isPrimeOnly)&&!gb.resources.customerData.hasEarlyAccessBenefit)if(n.purchaseState=gb.enums.PurchaseStates.LEARN_MORE,n.buttonText=gb.resources.getString("gb_learn_more"),n.showButton=!0,n.showTime=!0,n.showPercentClaimed=!0,c.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||c.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_BD)n.showPercentClaimed=!1;n.primeSignUpUrl=this.getPrimeSignUpUrlForAccessType(c);n.appDownloadUrl=gb.enums.appDownloadURL;
n.showPercentClaimed=n.showPercentClaimed&&this._shouldShowPercentClaimed(g,q);this._setTemplateDataForMetroApp(n);n.shouldDisplayIFDMessage=this.shouldDisplayIFDMessage(c);return n},getPrimeSignUpUrlForAccessType:function(a){return(a=gb.enums.PrimeSignUpURL[a.detail.accessType])?gb.resources.getUrl(a):null},isShowPercentageOffEnabled:function(){return gb.resources.getCustomerData("realm")===gb.enums.Realms.CN?!1:!0},getRandomNumber:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},isDealInEarlyAccessWindow:function(a){var b=
!1;a.status.dates.end.getTime();(new Date).getTime();var c=a.status.dates.start.getTime()-(new Date).getTime();(a.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS)&&0>=c&&-c<a.detail.accessDurationInMs&&(b=!0);return b},isPrimeSignupRedirectSupported:function(){var a=!0;if(gb.resources.deviceInfo.isIOS&&gb.resources.deviceInfo.isApp){var a=!1,b=gb.resources.getFeature("prime_signup_supported_ios_cn");"CN"===gb.resources.getCustomerData("realm")&&
gb.enums.Weblabs.TREATMENTS.T1===b&&(a=!0)}return a},isPEADealForNonPrimeUser:function(a){return a.detail.isPrimeEarlyAccessDeal&&gb.utils.isDealInEarlyAccessWindow(a)&&!gb.resources.getCustomerData("isPrimeMember")?!0:!1},isPODealForNonPrimeUser:function(a){return a.detail.isPrimeOnly&&!gb.resources.getCustomerData("isPrimeMember")?!0:!1},isTablet:function(a){return gb.resources.deviceInfo.isApp&&!gb.resources.deviceInfo.isPhone||a===gb.enums.Platforms.TAB?!0:!1},isDOTDDeal:function(a){return a.dealType===
gb.enums.DealTypes.DOTD||a.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD},getDealsPerRow:function(a,b,c,d,e){a=this.getWindowWidth(a,{hasMargin:c});a=Math.floor(a/b);d?a-=a%2:e||(5===a?a=4:6<=a&&(a=6));return a},getWindowWidth:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&"hasMargin"===c&&b[c]&&(a*=.9);return a},getWindowLocationOrigin:function(){k.location.origin||(k.location.origin=k.location.protocol+"//"+k.location.hostname+(k.location.port?":"+k.location.port:""));var a=
k.location.origin;a||(a=k.location.protocol+"//"+k.location.hostname,k.location.port&&(a=k.location.origin+":"+k.location.port));return a},isUnsupportedEgressURL:function(a){var b=!1,c=gb.enums.Constants.EGRESS_URL_UNSUPPORTED_REGEX;(a.itemType===gb.enums.ItemTypes.MULTI||a.type===gb.enums.DealTypes.BD&&a.itemType===gb.enums.ItemTypes.NONE)&&c.test(a.egressUrl)&&(b=!0);return b},getAsinFromURL:function(a){var b=document.createElement("a");b.href=a;return(a=b.pathname.match(gb.enums.Constants.EXTRACT_ASIN_URL_REGEX))&&
2<a.length?a[2]:""},getReviewStars:function(a){if(null===a||a===q||0>a||5<a)a=0;var b=Math.floor(a);a=parseFloat(a-b).toFixed(1);var c=!1;a>gb.enums.RoundedReviewStarsThresholds.HIGH?b+=1:a>=gb.enums.RoundedReviewStarsThresholds.LOW&&(c=!0);return{fullStars:b,hasHalfStar:c}},sendLogData:function(a,b){k.navigator&&navigator.sendBeacon?navigator.sendBeacon(a,b):h.$.ajax({url:a,data:b,async:!1})},getFilterViewIDs:function(a){var b=this,c={};f.each(a,function(a){var e=f.map(a.attr.split(","),h.$.trim);
c[e.join("_")]=b.getFilterItemViewID(e,a.type)});return c},getExtendedArray:function(a,b,c,d){var e=[],e=d!==q?this.getExtendedArray(a,d):Array(a);c===q&&(c=0);Array.prototype.splice.apply(e,[c,b.length].concat(b));return e},getFilterAttributesList:function(a){return f.flatten(f.map(a,function(a){return f.map(a.attr.split(","),function(a){return a.trim()})}))},getIncludedBins:function(a){a=this.getFilterAttributesList(a);a=f.filter(f.map(a,function(a){return gb.enums.FilterAttrToBinName[a]}),function(a){if(a)return a});
a=f.uniq(a);return f.map(a,function(a){return{name:a,count:gb.enums.BinNamesToCount[a]}})},getBoundingRect:function(a){if(!a)return!1;a=document.getElementById(a);if(!a||"none"===h.$(a).css("display"))return!1;a=a.getBoundingClientRect();return!a||0===a.top&&0===a.bottom&&0===a.left&&0===a.right?!1:a},filterDealsByViewport:function(a){var b={},c=this;f.each(gb.watcher.dealsInView,function(a,d){f.each(a,function(a,e){var f=c.getDealViewID(e,a);b[f]=d})});var d=gb.utils.getDealViewsInViewport(b,1);
return f.intersection(a,d)},getDealViewsInViewport:function(a,b){var c=this,d=h.$(k).height(),e=h.$(k).width(),g=[];f.each(a,function(a,n){var f=c.getBoundingRect(n);f&&f.top>=-1*b*d&&f.top<=(1+b)*d&&f.bottom>=-1*b*d&&f.bottom<=(1+b)*d&&f.left>=-1*b*e&&f.left<=(1+b)*e&&f.right>=-1*b*e&&f.right<=(1+b)*e&&g.push(a)});return g},hasPricingDetails:function(a){var b=!1;a=a.pricingData.prices.dealPrice;a!==q&&null!==a&&(b=!0);return b},isElementInViewPort:function(a){a=this.getBoundingRect(a);if(!1===a)return gb.enums.ViewPortPresence.ABSENT;
var b=a.top,c=a.bottom,d=a.left,e=a.right,g=h.$(k).height(),l=h.$(k).width();a=0<=b&&b<=g;var b=0>b,n=0<=c&&c<=g,c=c>g,g=0<=d&&d<=l,d=0>d,f=0<=e&&e<=l,e=e>l;if(a&&n&&g&&f)return gb.enums.ViewPortPresence.FULL;if(g&&f){if(b&&c)return gb.enums.ViewPortPresence.FULL_VERTICAL_CONTENT;if(a&&c)return gb.enums.ViewPortPresence.PARTIAL_TOP;if(b&&n)return gb.enums.ViewPortPresence.PARTIAL_BOTTOM}if(a&&n){if(d&&e)return gb.enums.ViewPortPresence.FULL_HORIZONTAL_CONTENT;if(g&&e)return gb.enums.ViewPortPresence.PARTIAL_LEFT;
if(d&&f)return gb.enums.ViewPortPresence.PARTIAL_RIGHT}return a&&c&&g&&e?gb.enums.ViewPortPresence.PARTIAL_TOP_LEFT:a&&c&&d&&f?gb.enums.ViewPortPresence.PARTIAL_TOP_RIGHT:b&&n&&g&&e?gb.enums.ViewPortPresence.PARTIAL_BOTTOM_LEFT:b&&n&&d&&f?gb.enums.ViewPortPresence.PARTIAL_BOTTOM_RIGHT:gb.enums.ViewPortPresence.ABSENT},removeImage:function(a){var b=a.find(".dealViewImage");b.length||(b=a.find("img"));if(b.size())return a={imageContent:b.parent().html(),imageContainer:b.parent()},b.remove(),a},addImage:function(a,
b,c){a.html(b);c&&a.find("img").load(function(){c()})},isWidgetWithStatusFilter:function(a){var b=!0;f.contains([gb.enums.WidgetNames.M_HERO,gb.enums.WidgetNames.M_SUPPLE,gb.enums.WidgetNames.TAB_SUPPLE],a)&&(b=!1);return b},shouldShowMiniDetailPageModal:function(a){var b=!1,c=a.deal;a=gb.controller.schedulingParams[a.widgetView.widgetID];var d=a.disableMiniDP;!a.showShortCellView||d||c.dealState!==gb.enums.DealStates.UPCOMING&&c.detail.itemType!==gb.enums.ItemTypes.SINGLE&&c.detail.itemType!==gb.enums.ItemTypes.VARIATION||
(b=!0);return b},isTouchDevice:function(){return"ontouchstart"in k||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},invokeWatchDealStateTransitions:function(a){var b=gb.controller.dealDAOs[a];b.isDealWatched&&(f.each(gb.metadata.watchedDeals,function(c,d){if(d!==gb.enums.Constants.ALL){var e=f.indexOf(c,a),g=gb.enums.WatchedDealStateMap[b.dealState];-1<e&&g!==d?gb.metadata.watchedDeals[d].splice(e,1):-1===e&&g===d&&gb.metadata.watchedDeals[d].unshift(a)}}),gb.metadata.trigger("RefreshWatchedDealWidgets",
f.keys(gb.widgets),b.dealID))},getWatchedDealStates:function(a){return a?f.map(a,function(a){return gb.enums.WatchedDealStateMap[a]}):f.uniq(f.values(gb.enums.WatchedDealStateMap))},getWatchedDealWidgetData:function(a){var b=this.getWatchedDealStates(a),c={},d=[],e=gb.enums.DealStates.AVAILABLE;f.each(gb.metadata.watchedDeals,function(a,l){-1!==f.indexOf(b,l)&&(c[e]=a,d=f.union(d,a))});return{selectedDealsCount:d.length,sortedDealIDs:d,dealsByState:c}},isDealActionable:function(a){if(!a)return!1;
a=gb.controller.getDealDAO(a);return!a||a.dealState!==gb.enums.DealStates.AVAILABLE&&a.dealState!==gb.enums.DealStates.WAITLIST?!1:a.detail.isPrimeOnly?gb.resources.customerData.isPrimeMember:a.detail.isPrimeEarlyAccessDeal&&this.isDealInEarlyAccessWindow(a)?gb.resources.customerData.hasEarlyAccessBenefit:!0},callAsyncAjax:function(a,b){k.navigator&&navigator.sendBeacon?navigator.sendBeacon(a,b):h.$.ajax({url:a,data:b,async:!1})},logRedirectPurchaseAttributes:function(a,b,c){if(a&&b&&(c||a.impressionAsin)){c||
(c=a.impressionAsin);b="/gp/deal/ajax/logPurchaseAttributes.html?asin="+c+"&et="+b+"&ht=redirect";a.parentAsin&&(b+="&ca="+a.parentAsin);a.merchantID&&(b+="&mt="+a.merchantID);var d=gb.resources.getCustomerData("realm"),d=this.price[d].currency,e=null;a.itemType===gb.enums.ItemTypes.VARIATION&&(e=a.getAsinDAO(c).dealPrice);a.dealAsinsHash[c]&&a.dealAsinsHash[c].dealPrice&&(e=a.dealAsinsHash[c].dealPrice.price,d=a.dealAsinsHash[c].dealPrice.currency);null!==e&&null!==d&&(b+="&pr="+this.getCrypticPrice(e),
b+="&cu="+d);h.$.ajax({url:b,async:!1})}},getCrypticPrice:function(a){return f.isNumber(a)?a.toString().split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)+17).replace("?","X")}).join(""):null},areNestedKeysPresent:function(a,b){if(!f.isObject(a)||!f.isString(b))return!1;b=b.split(".");for(var c=0;c<b.length;c++){if(!a||!a.hasOwnProperty(b[c]))return!1;a=a[b[c]]}return!0},showPPU:function(a){var b=gb.resources.getCustomerData("realm");return f.contains(this.ppuRealms,b)&&a?(a=gb.controller.getDealDAO(a))?
a.pricingData.unitPrice&&a.pricingData.baseUnit?!0:!1:!1:!1},hasDigitalCategory:function(a){return f.intersection(a,gb.utils.digitalCategories[gb.resources.customerData.realm]).length?!0:!1},_setTemplateDataForMetroApp:function(a){var b=gb.resources.deviceInfo;b.isApp&&b.isMetro&&b.isWin&&(a.showButton=!1)},removeNulls:function(a){if(f.isObject(a)){var b,c,d;a instanceof Array?(b=[],c=!0,d=0):(b={},c=!1);for(var e in a)if(a.hasOwnProperty(e)){var g=this.removeNulls(a[e]);g&&(b[c?d++:e]=g)}return f.isEmpty(b)?
null:b}return a?a:null},sortRequestObj:function(a,b){if(f.isObject(b)&&!f.isEmpty(b))if(b instanceof Array)if(f.isObject(b[0])){var c=this.requestObjSortBy[a];c&&b.sort(function(a,b){return(a[c]>b[c])-(a[c]<b[c])})}else b.sort();else if(b instanceof Object){for(var d in b)b.hasOwnProperty(d)&&(b[d]=this.sortRequestObj(d,b[d]));if(this.requestObjSortBy[a]){var e={},g=Object.keys(b);g.sort();for(d=0;d<g.length;d++)e[g[d]]=b[g[d]];b=e}}return b},isOfferingRestrictionViolated:function(a){for(var b in a)if("quantityRestriction"===
a[b].category)return!0;return!1},isDefinedAndNonNull:function(a){return null!==a&&a!==q?!0:!1},extractRefFromUrl:function(a){var b=a.indexOf("/ref=");if(-1===b)return"";a=a.substr(b+5);b=a.indexOf("?");-1!==b&&(a=a.substr(0,b));return a},getDeviceOrientation:function(a){a=gb.configManager.getWidgetViewConfig(a);a=parseInt(a.minLandscapeWidth,10);return h.$(k).width()>a&&h.$(k).width()>h.$(k).height()?gb.enums.ClientOrientation.LANDSCAPE:gb.enums.ClientOrientation.PORTRAIT},setDealViewHeightToOriginal:function(a,
b){var c="#"+gb.utils.getDealViewID(a,b),c=gb.widgets[a].skinDomElement.find(c);c.height("auto");var d=c.find("."+gb.enums.dealViewClasses.FOOTER);0<d.length&&c.height(c.height()+d.height())},setDealViewHeightToDealRowHeight:function(a,b){var c="#"+gb.utils.getDealViewID(a,b),c=gb.widgets[a].skinDomElement.find(c),d=c.closest("."+gb.enums.WidgetViewIDs.CONTENTROW);c.height(d.height())},getCSStransitionTime:function(a){var b=a+"ms ease-in-out";0===a&&(b="");return{"-webkit-transition":b,"-moz-transition":b,
"-o-transition":b,transition:b}},getCSStransformDistance:function(a,b){var c;if(b===gb.enums.Constants.X_DIRECTION)c="translate3d("+a+"px,0px,0px)";else if(b===gb.enums.Constants.Y_DIRECTION)c="translate3d(0px,"+a+"px,0px)";else return{};return{"-webkit-transform":c,"-moz-transform":c,"-o-transform":c,transform:c}},convertToRequesterDomainUrl:function(a){return a===q||null===a?null:a.replace(/^https?:\/\/([a-z0-9\.\-]*\.)?amazon\.[a-z]{2,3}(\.[a-z]{2})?\//i,this._getProtocol()+"//"+this._getHost()+
"/")},_getProtocol:function(){return k.location.protocol},_getHost:function(){return k.location.host},getDealsInternalUrl:function(a){var b;gb.resources.urls.deals_internal_website&&(b=gb.resources.urls.deals_internal_website+a);return b},getmarketingIDsToKeep:function(a){return f.filter(a[gb.enums.IncludedDealTargetsSupported.MARKETING_ID],function(a){return!f.contains(gb.resources.whitelistedMarketingIDList,a)})},getPriceTextForBasisKind:function(a){var b=gb.resources.getString("gb-price");if(a){var c=
!1,d=gb.resources.getCustomerData("realm");0<=[gb.enums.Realms.BR].indexOf(d)&&(c=!0);a===gb.enums.priceKind.LIST_PRICE?b=gb.resources.getString("gb-list"):a===gb.enums.priceKind.PRINT_LIST_PRICE&&c?b=gb.resources.getString("fiona_list_price_35050"):a===gb.enums.priceKind.DIGITAL_LIST_PRICE&&c&&(b=gb.resources.getString("fiona_digital_price_42515"))}return b},reloadPage:function(a,b){b.isInstanceOfWidgetView(a)?gb.subnavController&&!gb.subnavController.isWidgetExistinCurrentPageRefreshList(a)||a.refreshWidget(!0):
a.reload()},isLaunchCellPage:function(a){var b=!1,c=gb.controller.schedulingParams[a],d=gb.controller.widgetCurrentPage[a];a=gb.metadata.selectedDealsCount[a];var e=c.widgetTabConfig[c.widgetCurrentTab],e=e?e.launchCellIndex:0,c=c.pageSize;0<e&&0<c&&(b=a<d*c?!0:e>=(d-1)*c&&e<d*c?!0:!1);return b},isWatchedDealsTab:function(a){var b=!1,c=gb.controller.schedulingParams[a];a=c.widgetCurrentTab;c=c.watchedDealsTab;null!==c&&a===c&&(b=!0);return b},getComputedDealWidthForFlexWidget:function(a,b){var c=
b?a-a%2:a;return(100-5*(c-1))/c},validateFetchParam:function(a,b){var c=gb.controller.schedulingParams[a],d=function(a){if(a){for(var b={};Math.floor(c.maxLimitDeals/a)*a!==c.maxLimitDeals;)++a;b.page=Math.ceil(c.maxLimitDeals/a);b.dealsPerPage=a;return b}};b=f.extend(b,function(d){var e={};e.page=d.page?d.page:c.page;e.dealsPerPage=c.pageSize;if(d.dealsPerPage){var g=Math.ceil(((e.page-1)*c.pageSize+1)/d.dealsPerPage);if(!b.isLazyLoadPageCall)for(;gb.metadata.isCurrentWindowFull(a,g,b.dealsPerPage);)g++;
e.page=g;e.dealsPerPage=d.dealsPerPage}return e}(b));if(c.maxLimitDeals){var e=f.compact(gb.metadata.sortedDealIDs[a]),e=e.indexOf(f.last(e))+1,g=(b.page-1)*b.dealsPerPage,e=e>g?e:g;b.dealsPerPage*b.page<c.maxLimitDeals?gb.widgets[a].isMaxDealLimitReached=!1:(e>=c.maxLimitDeals||gb.widgets[a].isMaxDealLimitReached?b.dealsPerPage=0:e+b.dealsPerPage>c.maxLimitDeals&&(d=d(c.maxLimitDeals-e))&&(b=f.extend(b,d)),gb.widgets[a].isMaxDealLimitReached=!0)}return b},deduceAccessTypeInfoFromGetDealResponse:function(a,
b,c){var d,e;e=a.accessBehavior.accesslogic[0][0];a=gb.enums.DealAccessTypes[e.type];a===gb.enums.DealAccessTypes.GIVEAWAY_DEAL?c?d=0:a=null:d=e.duration;b.dealState!==gb.enums.DealStates.AVAILABLE||a!==gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&a!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||0>=parseInt(b.msToStart,10)+parseInt(d,10)*gb.enums.Constants.MINUTE_IN_MILLIS&&(a=null);return{accessType:a,accessTypeDuration:d}},mergeGiveawayWithGdmResponse:function(a,b,c,d){var e=c.giveawaySlots,g=b.length<
e.length?b.length:e.length;if(!this._checkFiltersApplied(d,c))for(c=0;c<g;c++)e[c]<a.sortedDealIDs.length&&(a.sortedDealIDs.splice(e[c],0,b[c]),a.selectedDealsCount++)},_checkFiltersApplied:function(a,b){var c=b.campaignSchedulingParams,d=!1;f.each(gb.filterController.models[gb.widgets[a].widgetGroupID]._selectedFilterValues,function(a,g){if(g===gb.enums.DCSQueryParams.PAGE){if(1!==a&&!0===b.fetchSinglePage)return d=!0,!1}else if(g===gb.enums.DCSQueryParams.DEAL_STATE)f.each(c[g],function(b){if(!f.contains(a,
gb.enums.DealStatesToFilterStates[b]))return d=!0,!1});else if(!f.isEqual(c[g],a))return d=!0,!1});return d},_shouldShowPercentClaimed:function(a,b){var c=gb.resources.getFeature("scarcity_messaging"),d=gb.enums.Weblabs.TREATMENTS,e=!0;b.enableHidingClaimedBar&&(d.T1===c&&30>a||d.T2===c&&80>a||d.T3===c)&&(e=!1);return e},_isAGSMerchant:function(a){return Object.keys(gb.enums.AGSMerchantsID).some(function(b){return gb.enums.AGSMerchantsID[b]===a})},shouldDisplayIFDMessage:function(a){var b=gb.resources.getFeature("gb_ifd_message"),
c=!1;a&&a.merchantID&&this._isAGSMerchant(a.merchantID)&&(c=b===gb.enums.Weblabs.TREATMENTS.T1);return c},getDealViewStyleInformation:function(a,b,c){var d={},e=gb.resources.getFeature("scarcity_messaging"),g=a.dealType===gb.enums.DealTypes.LD,e=null!==e&&e!==gb.enums.Weblabs.TREATMENTS.C;a=a.dealState===gb.enums.DealStates.SOLDOUT||a.dealState===gb.enums.DealStates.EXPIRED;b=b.timerPrefix===gb.resources.getString("gb_ends_in");var l=this.isTablet(gb.clientName),n=gb.clientName===gb.enums.MobileClients.AW&&
gb.resources.deviceInfo.isPhone;d.shouldStyleTimerMessaging=!1;d.shouldStyleScarcityMessaging=!1;c.enableTimerStyling&&(d.shouldStyleTimerMessaging=g&&!l&&!n&&e&&!a&&b);c.enableClaimedStyling&&(d.shouldStyleScarcityMessaging=g&&!l&&!n&&e&&!a);return d},encodeSpaces:function(a){return a.replace(/ /g,encodeURIComponent(" "))}}});p.when("A").register("gb-prime-utils",function(h){return{prime:{iconStyleByRealm:{FR:"premium",ES:"premium",JP:"prime-jp",DEFAULT:"prime"},realmsWithLogoOnRight:["IT"]},getPrimeIconType:function(){var h=
gb.resources.customerData.realm;return this.prime.iconStyleByRealm[h]?this.prime.iconStyleByRealm[h]:this.prime.iconStyleByRealm.DEFAULT},getPrimeLogoPosition:function(){return-1!==this.prime.realmsWithLogoOnRight.indexOf(gb.resources.customerData.realm)?gb.enums.primeIconPositions.RIGHT:gb.enums.primeIconPositions.LEFT}}});p.when("A","gb-resources").register("gb-badge-utils",function(h,k){return{generateBadgeProperties:function(f){var a,b=f.deal.dealType;f=f.deal.detail.accessType;var c,d,e;f?(d=
gb.resources.getFeature("prime_day_badging_2016"),null===d&&(d=0),gb.resources.deviceInfo.isPhone?c=gb.enums.Platforms.PHONE:gb.utils.isTablet(gb.clientName)?c=gb.enums.Platforms.TAB:gb.clientName===gb.enums.Platforms.PC&&(c=gb.enums.Platforms.PC),e=gb.configManager.getBadgeConfig(),(b=e.accessTypeBadge[f])&&b[c]&&((a=b[c][d])&&f===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&e.accessTypeBadge.Overrides[f][gb.resources.customerData.realm]!==q&&(a=e.accessTypeBadge.Overrides[f][gb.resources.customerData.realm]),
a&&(a.primeBadgingWeblab=d))):(e=gb.configManager.getBadgeConfig(),(a=e.dealTypeBadge[b])&&e.dealTypeBadge.Overrides[b][gb.resources.customerData.realm]!==q&&(a=e.dealTypeBadge.Overrides[b][gb.resources.customerData.realm]));return a}}});p.when("A","GoldboxMobile3PAssets").register("gb-metrics",function(h,k){var f=k._;return h.createClass({widgetMetricsParams:{},widgetRefTags:{"GB-M-FACEOUT":"gbmp","GB-M-GRID-HERO":"gbmg","GB-M-HERO":"gbmh","GB-M-HERO-CN":"cnm_ldw_card_atc","GB-M-LIST-HERO":"gbml",
"GB-M-SUPPLE":"gbms","GB-M-SUBNAV":"gbmu","GB-TAB-FACEOUT":"gbtp","GB-TAB-HERO":"gbth","GB-TAB-GRID-HERO":"gbtg","GB-TAB-SUPPLE":"gbts","GB-FILTER-HERO":"gbpf","GB-GRID-HERO":"gbpg","GB-PC-FACEOUT":"gbpp","GB-SUPPLE":"gbps","GB-SHOVELER":"gbph"},refTags:{addToCart:"atc",adSlot:"ads",app:"app",clearFilter:"fcr",dpLink:"dpl",filter:"ftr",getWatchedDeals:"gwd",giveaway:"ga",helpLink:"hlp",image:"img",joinWaitlist:"jwl",miniDpPopOver:"mdp",mobile:"mob",recLearnMore:"rlm",restrictionsApply:"rsa",reviews:"rvw",
seeAllDeals:"sad",seeAllLocalDeals:"sal",subnavTabRefresh:"str",swipe:"swp",tab:"tab",title:"tit",unrecLearnMore:"ulm",unWatchDeal:"uwd",watchDeal:"wtd"},adRowRefTags:{rowNumber:"r"},init:function(){this.reverseMapAmabotParams=f.invert(this.amabotParams)},amabotParams:{pf_rd_p:"placementID",pf_rd_s:"slotName",pf_rd_t:"pageType",pf_rd_i:"pageIndent",pf_rd_m:"merchantID",pf_rd_r:"requestID"},registerWidgetMetricParams:function(a,b){var c=h.$("#"+b+"-amabot").html().split("?");if(1<c.length){for(var c=
c[1].split("&amp;"),d,e={},g=0;g<c.length;g++)d=c[g].split("="),1>=d.length||!this.amabotParams[d[0]]||(e[this.amabotParams[d[0]]]=h.$.trim(d[1]));this.widgetMetricsParams[a]=e}},_addAmabotClickParameters:function(a,b){a&&b&&f.each(this.amabotParams,function(c){b[c]&&(a=gb.utils.setUrlParam(a,this.reverseMapAmabotParams[c],b[c]))},this);return a},addMetricsParams:function(a,b,c,d){if(!a)return"";if(!f.isEmpty(gb.widgets[b])){if(gb.resources.urls.deals_internal_website)return a;var e=this.widgetMetricsParams[b]||
{};b=this.creatRefTag(b,c,d,e);gb.resources.deviceInfo.isWindowsPhone||(a=this._addRefTag(a,b),a=this._addAmabotClickParameters(a,e));return a}},creatRefTag:function(a,b,c,d){a=this.widgetRefTags[gb.widgets[a].widgetName]||"--";b=b||"---";var e=this._getSlotRefTag(d);d=this._getPlacementID(d);c=f.map(c,function(a){return((a||"")+"").replace(/[_ ]/g,"")});c=f.filter(c,function(a){return!!a});c=f.map(c,function(a){return a.substring(0,8)}).join("_");return[a,b,e,d,c].join("_")},partiallyAppliedReffedURLFunction:function(a){var b=
this;return function(c,d){return b.addMetricsParams(c,a.widgetID,d,a.data)}},_getSlotRefTag:function(a){if(!a||!a.slotName)return"";a=a.slotName;return 4>a.length?a:a.substring(0,1)+a.substring(a.length-2,a.length)},_getPlacementID:function(a){return a&&a.placementID?f.last(a.placementID,4).join(""):""},_addRefTag:function(a,b){var c,d,e;d=a.indexOf("#");-1===d?e="":(e=a.substring(d),a=a.substring(0,d));c=a.indexOf("?");-1===c?d="":(d=a.substring(c),a=a.substring(0,c));c=a;"/"===c[c.length-1]&&(c=
c.substring(0,c.length-1));c=c.split("/");0===f.last(c).indexOf("ref=")&&(c=f.initial(c));b=b.replace(/%/g,"");d=gb.utils.clearUrlParam(d,"ref_");c.push("ref="+b);return c.join("/")+d+e},generateRef:function(a,b,c){return this.creatRefTag(a,b,c,this.widgetMetricsParams[a]||{})},recordRefViaAjax:function(a){a&&h.$.ajax({type:"POST",url:"/gp/deal/ajax/record-ref.html/ref="+a,aysnc:!0})}})});p.when("A","GoldboxMobile3PAssets","gb-metrics").register("gb-subnav-metrics",function(h,k,f){var a=k._;return f.extend({init:function(a){this._super(a);
this.registerWidgetMetricParams(a.widgetName,a.domElementID)},addMetricsParams:function(a,c,d,e){if(!a||!c)return"";var g=this.widgetMetricsParams[c]||{};c=this._creatRefTag(c,d,e,g);a=this._addRefTag(a,c);return a=this._addAmabotClickParameters(a,g)},_creatRefTag:function(b,c,d,e){b=this.widgetRefTags[b]||"--";c=c||"---";var g=this._getSlotRefTag(e);e=this._getPlacementID(e);d=a.map(d,function(a){if(null===a||a===q)a="";return(a+"").replace(/[_ ]/g,"")});d=a.filter(d,function(a){return!!a});d=a.map(d,
function(a){return a.substring(0,8)}).join("_");return[b,c,g,e,d].join("_")}})});p.when("A","GoldboxMobile3PAssets").register("gb-link-generator",function(h,k){var f=k._;return h.createClass({redirectionLink:null,init:function(a){this.redirectionLink=this._populateRedirectionBaseUrl(a)},_populateRedirectionBaseUrl:function(a){var b;"pc"===a&&(b=gb.resources.getString("gb_app_all_deals_url"),b=b.trim());return b=b||gb.enums.RedirectionLinks[a].ALL_DEALS},generateRedirectLink:function(a,b){var c=this;
if(!f.isEmpty(a.dealDisplay)){var d=[];f.map(a.dealDisplay,function(a){d.push(f.keys(a))});a.dealTypes=d}var e,g={brands:"gb_bnd",dealGroups:"gb_dgp",dealStates:"gb_dst",dealTypes:"gb_dtp",enforcedCategories:"gb_cat",enforcedDealIDs:"gb_edi",enforcedMerchantIDs:"gb_emi",excludedCategories:"gb_exc",excludedDealIDs:"gb_exd",excludedExtendedFilters:"gb_exf",exclusiveTargetKeys:"gb_exk",exclusiveTargetValues:"gb_exv",expiringWithin:"gb_exp",extendedFilters:"gb_ext",fromTime:"gb_frt",freeShippingEligibleOnly:"gb_fso",
globalEligibleOnly:"gb_geo",inclusiveTargetKeys:"gb_tgk",inclusiveTargetValues:"gb_tgv",minRating:"gb_mnr",primeEligibleOnly:"gb_peo",prioritizedDealIDs:"gb_pdi",redirectPageTitle:"gb_ttl",sortOrder:"gb_srt",toTime:"gb_tot"};f.each(g,function(d,n){if(b!==gb.enums.Constants.PAGINATED_METADATA_VERSION||d!==g.dealGroups)if(e=a[n],!f.isEmpty(e)){switch(d){case g.exclusiveTargetValues:case g.inclusiveTargetValues:var w="";f.each(e,function(a){w+="["+a.join()+"],"});e=w.slice(0,-1);break;case g.extendedFilters:case g.excludedExtendedFilters:e=
JSON.stringify(e);break;default:"string"!==typeof e&&(e=e.join())}c.redirectionLink=gb.utils.setUrlParam(c.redirectionLink,d,encodeURIComponent(e))}},b);return c.redirectionLink}})});p.when("A","GoldboxMobile3PAssets").register("gb-metrics-manager",function(h,r){var f=r._;return h.createClass({asinImpressionsHash:{},ClientActions:{ADD_TO_CART:"A",JOIN_WAITLIST:"J",WATCH_DEAL:"W",SEE_MORE:"M",TITLE:"T",REVIEWS:"R",SHARE_DEAL:"S",IMAGE:"I",DEAL_CLICK:"D",LEARN_MORE:"L",TRY_PRIME:"P",GC_RENDER:"G"},
cdsCallIntervalRef:null,cdsPollInterval:3E5,init:function(){var a=this;h.$(k).unload(function(){k.clearInterval(a.cdsCallIntervalRef);a.cdsCallIntervalRef=null;a.reportImpression()});a.cdsCallIntervalRef=k.setInterval(function(){a.reportImpression()},a.cdsPollInterval)},recordRender:function(a,b,c){if(!a||!b)return null;c=this.getMetricsLogPosition(a,b,c);if(!c)return null;this.asinImpressionsHash[a]||(this.asinImpressionsHash[a]={});this.asinImpressionsHash[a][b]||(this.asinImpressionsHash[a][b]=
{});this.asinImpressionsHash[a][b][c]||(this.asinImpressionsHash[a][b][c]={});return c},recordAction:function(a,b,c,d){a&&b&&c&&f.contains(f.keys(this.ClientActions),c)&&(d=this.recordRender(a,b,d))&&(this.asinImpressionsHash[a][b][d][this.ClientActions[c]]||(this.asinImpressionsHash[a][b][d][this.ClientActions[c]]=0),this.asinImpressionsHash[a][b][d][this.ClientActions[c]]++)},reportImpression:function(){var a=this,b={};f.each(this.asinImpressionsHash,function(c,d){var e=a.getImpressionRef(d);if(e){var g=
[];f.each(c,function(a,b){var c=gb.controller.getDealDAO(b);if(c){var d=c.detail.impressionAsin;if(d){var e=[d,b];gb.utils.isDealActionable(b)&&e.push("Y");c=c.status.percentClaimed;f.isNumber(c)&&0<c&&e.push(c);f.each(a,function(a,b){e.push(b);var c=[];f.each(a,function(a,b){c.push(b,a)});c.length&&e.push(c.join(""))});g.push(e.join("-"))}}});g.length&&(b[e]=g.join())}});this.splitCallClickStream(b);this.asinImpressionsHash={}},splitCallClickStream:function(a){if(!f.isEmpty(a)){var b=gb.utils.setUrlParam(gb.enums.AJAXLinks.CDS,
"sID",gb.resources.getCustomerData("sessionId")),b=gb.utils.setUrlParam(b,"oID",gb.controller.contentMetadata.originRID),c=JSON.stringify(a),b=gb.utils.setUrlParam(b,"imp",c),b=k.encodeURI(b);if(2E3>=b.length)gb.utils.callAsyncAjax(b);else if(b=f.keys(a),b.length){var d={},e={};if(1===b.length){var g=a[b[0]].split(",");if(1>=g.length)return;c=g.slice(0,Math.ceil(g.length/2));g=g.slice(Math.ceil(g.length/2),g.length);d[b[0]]=c.join();e[b[0]]=g.join()}else c=b.slice(0,Math.ceil(b.length/2)),b=b.slice(Math.ceil(b.length/
2),b.length),f.each(c,function(b){d[b]=a[b]}),f.each(b,function(b){e[b]=a[b]});this.splitCallClickStream(d);this.splitCallClickStream(e)}}},getImpressionRef:function(a){if(a){var b=gb.configManager.getWidgetViewConfig(a).clickStreamRefMarker,c=gb.metrics.widgetMetricsParams[a],b=[b,c.slotName,c.placementID];gb.controller.schedulingParams[a].enforceLimitedDeals&&b.push("Y");return b.join(".")}},getMetricsLogPosition:function(a,b,c){if(!(a&&b&&gb.widgets[a]&&gb.widgets[a].dealViews[b]))return null;
var d=gb.widgets[a];b=d.dealViews[b][c];c=gb.controller.widgetCurrentPage[a]-1;var e=b.position,d=d.dealsPerRow,g=0,l=e;b.row!==q&&b.column!==q?(g=b.row,l=b.column):gb.controller.schedulingParams[a].enforceLimitedDeals||(g=Math.floor(e/d),l=e%d);if(gb.controller.schedulingParams[a].enforceLimitedDeals||!gb.controller.schedulingParams[a].enablePagination)c=0;a=[g,l,c];!0===b.isDoubleCell&&a.push("Y");return a.join(".")}})});p.when("A","GoldboxMobile3PAssets").register("gb-widget-clientside-helper",
function(h,k){var f=k._;return h.createClass({callBins:{},callDataArray:{},callID:{},previousDeficit:{},allDealsFetched:{},shouldReduceDeals:{},registerWidgetData:function(a,b){this.callBins[a]=[];this.callID[a]=0;this.allDealsFetched[a]=!1;this.previousDeficit[a]=0;this.shouldReduceDeals[a]=!0;var c=gb.widgets[a],d=gb.controller.schedulingParams[a],e=gb.configManager.getWidgetViewConfig(a),g=d.dealDisplay;if(f.isEmpty(g))if(g=e.defaultNumberOfRows,d.dealTypes){var l=d.dealTypes.join(","),n={};n[l]=
{rows:g};g=[n]}else g=[{"":{rows:g}}];else l=g[g.length-1],n=f.keys(l),l=l[n[0]],l.deals?this.shouldReduceDeals[a]=!1:l.rows&&(this.shouldReduceDeals[a]=!0);d.dealDisplay=g;c=c.dealsPerRow;e=this.callDataArray[a]=(0,this[e.callDataBuilder])(g,c);!f.isEmpty(d.dealGroups)&&d.enforceLimitedDeals?this.previousDeficit[a]=this.calculatePreviousDeficit(b.sortedDealIDs,c,d.showDoubleCellDOTD):d.isCritical||(g=e[0].dealsPerPage,this.callID[a]++,d.enforceLimitedDeals?(e=e[0].scheduledDealData,!f.isEmpty(b)&&
e.rows&&e.rows&&(b.sortedDealIDs=this.filterDisplayableDealsArray(b.sortedDealIDs,e.rows*c,d.showDoubleCellDOTD)),this.previousDeficit[a]=this.calculatePreviousDeficit(b.sortedDealIDs,c,d.showDoubleCellDOTD)):d.fetchSinglePage||(d.pageSize=g))},getGBSuppleCallDataArray:function(a,b){var c=[],d=!0;f.each(a,function(a){f.each(a,function(a,e){var n={};n.dealTypes=e&&"ALL"!==e?e.split(","):[];a.deals?n.dealsPerPage=a.deals:a.rows&&(n.dealsPerPage=a.rows*b,d||(n.dealsPerPage+=b));n.dealStates=[];a.dealStates&&
(n.dealStates=a.dealStates.split(","));n.scheduledDealData=a;n.dealsPerPage&&(c.push(n),d=!1)})});return c},fetchCallDataArrayDeals:function(a){var b=this.callID[a],c=this.callDataArray[a];if(c.length>b){var d=gb.controller.schedulingParams[a],e=c[b];d.page=1;d.pageSize=e.dealsPerPage;d.dealTypes=e.dealTypes;d.dealStatesDD=e.dealStates;d={metaParams:{}};d.metaParams.callDataArray=c;d.metaParams.callID=b;gb.service.fetchDealWithData(a,d,gb.controller.updatePage)}else this.allDealsFetched[a]=!0,"function"===
typeof gb.widgets[a].renderLaunchCell&&gb.widgets[a].renderLaunchCell()},buildSortedDealsArray:function(a,b){var c=gb.widgetHelper.callID[a],d=this.callBins[a][c],e=gb.metadata.sortedDealIDs[a],g=this.callDataArray[a][c].scheduledDealData,c=gb.controller.schedulingParams[a];if(g.rows){var l=d.length;c.showDoubleCellDOTD&&(l=l+f.intersection(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],d).length+f.intersection(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],d).length);g=
g.rows*b;g+=this.previousDeficit[a];d=this.filterDisplayableDealsArray(d,l>=g?g:l,c.showDoubleCellDOTD)}e=f.union(e,d);this.previousDeficit[a]=this.calculatePreviousDeficit(e,b,c.showDoubleCellDOTD);return e},filterDisplayableDealsArray:function(a,b,c){var d=[];f.each(a,function(a){if(0<b){var g=c?f.contains(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],a)||f.contains(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],a):!1;1===b&&g||(d.push(a),g?b-=2:b--)}else return!1});
return d},calculatePreviousDeficit:function(a,b,c){var d=0;c=c?gb.metadata.getDOTDCount(a):0;a=a.length+c;0!==a%b&&(d=b-a%b);return d}})});p.when("A","GoldboxMobile3PAssets","gb-metrics").register("gb-filter-metrics",function(h,k,f){var a=k._;return f.extend({_filterRefTags:{CATEGORIES:"wht",DEAL_STATE:"dls",DEAL_TYPE:"dlt",DISCOUNT:"dct",PRICE:"prc",REVIEW_RATING:"acr",PAGE:"page",PRIME_ELIGIBLE_ONLY:"prm",PRIME_ACCESS_TYPE:"dlt",SORT_ORDER:"sort"},_filterAttrToHandlers:{CATEGORIES:"_getCategoriesMetric",
DEAL_STATE:"_getDealStateMetric",DEAL_TYPE:"_getDealTypeMetric",DISCOUNT:"_getDiscountMetric",PRICE:"_getPriceMetric",REVIEW_RATING:"_getReviewRatingMetric",PAGE:"_getPageMetric",PRIME_ELIGIBLE_ONLY:"_getPrimeEligibleMetric",PRIME_ACCESS_TYPE:"_getDealTypeMetric",SORT_ORDER:"_getSortOrderMetric"},_dealStateRefTags:{ACTIVE:"ACTV",MISSED:"MISD",UPCOMING:"UPCM"},_dealTypeRefTags:{BEST_DEAL:"BD",COUPON_DEAL:"CPN",DEAL_OF_THE_DAY:"DOTD",LIGHTNING_DEAL:"LD",PRIME_EARLY_ACCESS:"PEA"},_sortOrderRefTags:{BY_BEST_SELLING:"BSEL",
BY_DISCOUNT_ASCENDING:"DCTA",BY_DISCOUNT_DESCENDING:"DCTD",BY_PRICE_ASCENDING:"PRCA",BY_PRICE_DESCENDING:"PRCD",BY_RELEVANCE:"FEAT",BY_SCORE:"RELV",BY_START_TIME:"STRT"},_primeEligibleRefTag:{ISPM:"ISPM"},init:function(){this._super();var b=this;this._binningParamsWithHandlersToAttr={};a.each(a.keys(this._filterAttrToHandlers),function(a){b._binningParamsWithHandlersToAttr[gb.enums.BinningParams[a].key]=a});this._getCategoriesMetric=a.wrap(q,this._metricsChangeWrapper);this._getDealStateMetric=a.wrap(this._transformDealStateValue,
this._metricsChangeWrapper);this._getDealTypeMetric=a.wrap(this._transformDealTypeValue,this._metricsChangeWrapper);this._getDiscountMetric=a.wrap(this._transformDiscountValue,this._metricsChangeWrapper);this._getPriceMetric=a.wrap(q,this._metricsChangeWrapper);this._getReviewRatingMetric=a.wrap(q,this._metricsChangeWrapper);this._getPageMetric=a.wrap(q,this._metricsChangeWrapper);this._getPrimeEligibleMetric=a.wrap(this._transformPrimeEligibleValue,this._metricsChangeWrapper);this._getSortOrderMetric=
a.wrap(this._transformSortOrderValue,this._metricsChangeWrapper)},appendFilterMetricParams:function(a,c,d,e){return e instanceof Array&&3===e.length?(e=this._getFilterMetricData(e),this.addMetricsParams(a,c,d,e)):a},_getFilterMetricData:function(a){var c=this._binningParamsWithHandlersToAttr[a[1]];if(c)return this[this._filterAttrToHandlers[c]](a,c);c=a[1];a[0]&&c&&a.shift();return a},_metricsChangeWrapper:function(b){var c=a.tail(arguments),d=c[0],e=d[1],d=d[2],c=c[1];b&&(d=b.call(this,d));if(e&&
d)return[this._filterRefTags[c],d]},_transformDealStateValue:function(b){if(b===parseInt(b,10)&&gb.widgets[b]&&gb.widgets[b].widgetName===gb.enums.WidgetNames.PC_SHOVELER){var c=gb.controller.schedulingParams[b],c=c.widgetTabConfig[c.widgetCurrentTab].dealStates,c=a.flatten(c);a.contains(c,gb.enums.FilterStates.ACTIVE)?b=gb.enums.FilterStates.ACTIVE:a.contains(c,gb.enums.FilterStates.UPCOMING)?b=gb.enums.FilterStates.UPCOMING:a.contains(c,gb.enums.FilterStates.MISSED)&&(b=gb.enums.FilterStates.MISSED)}return this._dealStateRefTags[b]},
_transformDealTypeValue:function(a){return this._dealTypeRefTags[a]},_transformDiscountValue:function(a){return a.substring(0,a.indexOf("-")+1)},_transformPrimeEligibleValue:function(a){return a?this._primeEligibleRefTag.ISPM:""},_transformSortOrderValue:function(a){return this._sortOrderRefTags[a]}})});p.when("A").register("gb-config-manager",function(h){return h.createClass({init:function(){this.dealViewConfigs={};this.widgetViewConfigs={};this.badgeConfig={};this.badgeConfig.accessTypeBadge={PRIME_EARLY_ACCESS:{phone:{0:{tagList:["gb_m_prime_early_access_deal"],
badgeStyleRule:"primeDeal Badge274",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},1:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal solidTransparentBadge",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},2:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal solidTransparentBadge",skewElmStyleRule:"primeSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},1:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},
2:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"}},tablet:{0:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},1:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},2:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"}}},PRIME_ONLY_DOTD:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge162",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},
1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},
tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},PRIME_ONLY_LD:{phone:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeDeal Badge234",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge largeTextPrimeBadge",
skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge largeTextPrimeBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeBadge poBadge"},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"}},
tablet:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeBadge poBadge"},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"}}},PRIME_ONLY_BD:{phone:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0}},pc:{0:null,
1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},APP_EARLY_ACCESS:{phone:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0},1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0},2:{tagList:["gb_app_early_access_caps"],
badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"}},tablet:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},2:{tagList:["gb_app_early_access_caps"],
badgeStyleRule:"appBadge appeaBadge"}}},APP_ONLY_LD:{phone:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},1:{tagList:["gb_app_only_access_caps"],
badgeStyleRule:"appBadge appoBadge"},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"}},tablet:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"}}}};this.badgeConfig.dealTypeBadge={DEAL_OF_THE_DAY:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge160",skewElmStyleRule:"DOTDSlide"}};this.badgeConfig.accessTypeBadge.Overrides=
{PRIME_ONLY_DOTD:{IT:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},
1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},BR:{phone:{0:{tagList:["gb_m_prime_exclusive",
"gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],
badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}}}};this.badgeConfig.dealTypeBadge.Overrides={DEAL_OF_THE_DAY:{IT:{tagList:["gb_m_deal_of_the_day"],
badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"DOTDSlide"},BR:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"DOTDSlide"}}}},registerConfigs:function(h){this.registerDealViewConfigs(h.widgetName,h.dealViewConfig);this.registerWidgetViewConfigs(h.widgetName,h.widgetViewConfig)},registerDealViewConfigs:function(h,f){this.dealViewConfigs[h]=this.dealViewConfigs[h]||f},registerWidgetViewConfigs:function(h,f){this.widgetViewConfigs[h]=this.widgetViewConfigs[h]||f},
getDealViewConfig:function(h){return(h=gb.controller.widgetName[h])?this.dealViewConfigs[h]||null:null},getWidgetViewConfig:function(h){return(h=gb.controller.widgetName[h])?this.widgetViewConfigs[h]||null:null},getBadgeConfig:function(){return this.badgeConfig}})});p.when("A","GoldboxMobile3PAssets").register("gb-template-manager",function(h,k){var f=k._;return h.createClass({templates:{},TemplateGroups:{DEAL_SHARE:"dealShare",DEAL_STATE:"dealState",DEAL_VIEW:"dealView",FILTER_VIEW:"filterView",
MINI_DP_DEAL_STATE:"miniDPDealState",MINI_DP_DEAL_VIEW:"miniDPDealView",WIDGET_VIEW:"widgetView"},templateSettings:{evaluate:/<~([\s\S]+?)~>/g,interpolate:/\{\{([\s\S]+?)\}\}/g,escape:/~\{\{([\s\S]+?)\}\}/g},registerTemplates:function(a,b){if(!this.templates[a]){this.templates[a]={};var c=this,d={};b&&f.each(f.values(this.TemplateGroups),function(a){b[a]&&(d[a]=c._fetchTemplates(b[a]))});f.isEmpty(d)||(this.templates[a]=d)}},_fetchTemplates:function(a){var b={},c=this;f.each(a,function(a){var e=h.$("#"+
a.id).html();b[a.name]=f.template(e,!1,c.templateSettings)});return f.isEmpty(b)?null:b},hasTemplate:function(a){var b=a.widgetID,c=a.templateGroup;a=a.templateName;if(!b||!c||null===a||""===a)return!1;b=gb.controller.widgetName[b];if(!b||!f.contains(f.values(this.TemplateGroups),c))return!1;c=[b,c];a!==q&&c.push(a);return gb.utils.areNestedKeysPresent(this.templates,c.join("."))?!0:!1},getWidgetHTML:function(a){var b=a.widgetID,c=a.templateGroup,d=a.templateName,e=a.templateNames,g=a.data;if(!this.hasTemplate({widgetID:b,
templateGroup:c,templateName:d}))return"";a=gb.controller.widgetName[b];if(d)return this.generateTemplate(this.templates[a][c][d],g);f.isArray(e)||(e=f.keys(this.templates[a][c]));var l={},n=this;f.each(e,function(a){l[a]=n.getWidgetHTML({widgetID:b,templateGroup:c,templateName:a,data:g})});return l},generateTemplate:function(a,b){return a?f.isFunction(a)?a({data:b||{}}):f.isString(a)?f.template(a,{data:b||{}},this.templateSettings):"":""}})});p.when("A","gb-event-emitter").register("gb-deal-dao",
function(h,k){return k.extend({init:function(f){this._super();this.dealID=f;this.dealType=this.offerID=this.legacyDealID=null;this.dealState=gb.enums.DealStates.LOADING;this.checkingDealStatus=!1;this.merchantID=null;this.processWatchAction=this.isDealWatched=this.isDigital=!1;this.customerState=null;this.detail={title:null,imageAsin:null,URL:null,itemType:null,buyAsin:null,impressionAsin:null,marketingMessage:null,isPrimeOnly:null,isPrimeEarlyAccessDeal:null,isGiveawayDeal:null,isFulfilledByAmazon:null,
accessType:null,accessDurationInMs:null,isAppDeal:!1,giveawayValue:null};this.reviews={URL:null,total:null,rating:null};this.teaser={teaserLine:null,teaserImage:null,teaserURL:null};this.auxiliaryData={breaksMAP:null,isPrimeEligible:null};this.pricingData={prices:{dealPrice:null,basisPrice:null},percentOff:null,bKind:null,unitPrice:null,baseUnit:null};this.status={percentClaimed:null,isValidDeal:1,dates:{end:null,start:null,incartEnds:null,cacheExpires:null,startForNonPrimeCustomer:null,pendingATCEnds:null},
timeouts:{end:null,start:null,incartEnds:null,cacheExpires:null,earlyAccessExpires:null,pendingATCEnds:null},cache:{lastMsCacheTtl:null}};this.couponCounts={total:null};this.extendedAttributes={hideAddToCart:!1};this.registerConnections();this.items={};this.selectorData={}},registerConnections:function(){this.on("RefreshView",this.changeView);this.on("RefreshMiniDetailPageView",this.changeMiniDetailPageView)},calculatePercentOff:function(){var f=this.pricingData.prices.dealPrice,a=this.pricingData.prices.basisPrice;
f&&a&&f.max.value===f.min.value&&a.max.value===a.min.value&&(this.pricingData.percentOff=gb.utils.calculatePercentOff(a.max.value,f.max.value))},changeView:function(){gb.controller.refreshDealView(this.dealID)},changeMiniDetailPageView:function(){gb.controller.refreshMiniDetailPageView(this.dealID)},getAsinDAO:function(f){return this.items[f]},getVariationAsin:function(f){var a=null;h.each(this.items,function(b){h.equals(b.variationDimensions,f)&&(a=b)});return a}})});p.when("A").register("gb-deal-asin-dao",
function(h){return h.createClass({init:function(h){if(!h.itemID)throw Error("Cannot create a GBDealAsinDAO object with undefined asin");this.asinID=h.itemID;this.dealID=h.dealID;this.parentDealDAO=null;h.parentItemID&&(this.parentDealDAO=gb.controller.getDealDAO(h.parentItemID));this.marketplaceID=gb.resources.customerData.marketplaceId;this.dealPriceFormatted=gb.utils.getFormattedPrice(h.dealPrice);this.bKind=h.bKind;this.percentOff=h.percentOff;this.basisPriceFormatted=gb.utils.getFormattedPrice(h.bAmount);
this.imageURL=gb.baseUtils.checkAndSetSSLImageUrl(h.primaryImage);this.status={itemState:null,customerState:null,percentClaimed:null,dates:{incartEnds:null,pendingATCEnds:null},timeouts:{incartEnds:null,pendingATCEnds:null}};this.variationDimensions=h.variationDimensions;this.auxiliaryData={isPrimeEligible:h.isPrimeEligible,breaksMAP:null,merchantDetails:{merchantID:h.merchantID,merchantName:h.merchantName}}}})});p.when("A","GoldboxMobile3PAssets","gb-filter-model","gb-shoveler-filter-model").register("gb-filter-model-factory",
function(h,k,f,a){return h.createClass({getFilterModel:function(b,c){var d=null;b&&c&&(d={widgetGroupID:c,widgetID:b},d=gb.widgets[b].widgetName===gb.enums.WidgetNames.PC_SHOVELER?new a(d):new f(d));return d}})});p.when("A","GoldboxMobile3PAssets").register("gb-filter-utils",function(h,k){var f=k._;return{_paginationDummyUrls:{PREV:"prev",NEXT:"next"},_sortAlphabetically:function(a){a=f.pairs(a);return f.sortBy(a,function(a){return a[0]})},_sortRanges:function(a){a=f.pairs(a);return f.sortBy(a,function(a){a=
a[0].split("-")[0]||0;return parseInt(a,10)})},_getFilterOptionsForDealStates:function(a,b){var c={};f.each(a,function(a){var b=gb.enums.DealStatesToFilterStates[a[0]],g=parseInt(c[b],10);c[b]=g?(g+parseInt(a[1],10)).toString():a[1]});return f.map(c,function(a,c){return{value:c,selected:f.contains(b,c),count:a,attribute:gb.enums.BinningParams.DEAL_STATE.key}})},getFilterOptions:function(a,b,c){var d,e=gb.filterController.models[c.widgetGroupID].getSelectedBinningValues(a);if(a===gb.enums.BinningParams.PRICE.key)f.isArray(e)||
(e=[e]),d=this._sortRanges(b),d=f.map(d,function(b){var c=b[0].split("-");return{rangeStart:c[0],rangeEnd:c[1],value:b[0],count:b[1],attribute:a,selected:f.contains(e,b[0])}});else if(a===gb.enums.BinningParams.DISCOUNT.key){var g="",l=0;f.isArray(e)&&(e=e.join(","));d=this._sortRanges(b).reverse();d=f.map(d,function(b){var c=b[0].split("-");g=g?b[0]+","+g:b[0];l+=b[1];return{rangeStart:c[0]?c[0]:"0",value:g,count:l,attribute:a,selected:e===g}});d=d.reverse()}else if(a===gb.enums.BinningParams.PAGE.key)d=
[{currentPage:gb.controller.widgetCurrentPage[c.widgetID],totalPages:c.totalPages,dummyUrls:this._paginationDummyUrls,count:1,attribute:a,minimalPagination:gb.configManager.getWidgetViewConfig(c.widgetID).minimalPagination}];else if(a===gb.enums.BinningParams.SORT_ORDER.key||a===gb.enums.BinningParams.REVIEW_RATING.key)d=[{count:1,attribute:a,selected:e}];else if(a===gb.enums.BinningParams.PRIME_ELIGIBLE_ONLY.key||a===gb.enums.BinningParams.GLOBAL_ELIGIBLE_ONLY.key||a===gb.enums.BinningParams.NEW_RELEASES.key||
a===gb.enums.BinningParams.GIFT_WRAPPABLE.key||a===gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key||a===gb.enums.BinningParams.CASH_ON_DELIVERY.key||a===gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key||a===gb.enums.BinningParams.ACCESS_TYPE)d=[{value:1,selected:e,count:1,attribute:a}];else{a===gb.enums.BinningParams.CATEGORIES.key?(d=f.filter(gb.resources.whitelistedCategoryList,function(a){return a in b}),d=f.map(d,function(a){return[a,b[a]]})):a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID?
(d=f.filter(gb.resources.whitelistedMarketingIDList,function(a){return a in b}),d=f.map(d,function(a){return[a,b[a]]})):d=this._sortAlphabetically(b);var n=gb.filterController.models[c.widgetGroupID].filterConfigValuesHash[a];n&&(d=f.filter(d,function(a){return f.contains(n,a[0])?!0:!1}),d=f.sortBy(d,function(a){return f.indexOf(n,a[0])}));f.isArray(e)||(e=[e]);d=a===gb.enums.BinningParams.DEAL_STATE.key?this._getFilterOptionsForDealStates(d,e):f.map(d,function(b){return{value:b[0],selected:f.contains(e,
b[0]),count:b[1],attribute:a}})}return d},getFilterLabel:function(a,b){var c;if(a){switch(a.attribute){case gb.enums.BinningParams.CATEGORIES.key:c=gb.resources.whitelistedCategoryNamesParsed[a.value];break;case gb.enums.BinningParams.DEAL_STATE.key:case gb.enums.BinningParams.DEAL_TYPE.key:case gb.enums.BinningParams.PRIME_ACCESS_TYPE.key:c=gb.enums.FilterAttrToStrings[a.value];c=gb.resources.getString(c);break;case gb.enums.BinningParams.ACCESS_TYPE.key:c=gb.enums.FilterAttrToStrings[a.value];c=
gb.resources.getString(c);break;case gb.enums.BinningParams.DISCOUNT.key:c=gb.enums.FilterAttrToStrings.DISCOUNT;a.rangeStart?a.rangeEnd||(c=gb.enums.FilterAttrToStrings.DISCOUNT_END):c=gb.enums.FilterAttrToStrings.DISCOUNT_START;c=gb.resources.getString(c,{start:a.rangeStart,end:a.rangeEnd});break;case gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key:c=gb.enums.FilterAttrToStrings.FREE_SHIPPING_ELIGIBLE_ONLY;c=gb.resources.getString(c);break;case gb.enums.BinningParams.GIFT_WRAPPABLE.key:c=
gb.enums.FilterAttrToStrings.GIFT_WRAPPABLE;c=gb.resources.getString(c);break;case gb.enums.BinningParams.GLOBAL_ELIGIBLE_ONLY.key:c=gb.enums.FilterAttrToStrings.GLOBAL_ELIGIBLE_ONLY;c=gb.resources.getString(c);break;case gb.enums.BinningParams.NEW_RELEASES.key:c=gb.enums.FilterAttrToStrings.NEW_RELEASES;c=gb.resources.getString(c);break;case gb.enums.BinningParams.PRICE.key:c=gb.enums.FilterAttrToStrings.PRICE;a.rangeStart?a.rangeEnd||(c=gb.enums.FilterAttrToStrings.PRICE_END):c=gb.enums.FilterAttrToStrings.PRICE_START;
c=gb.resources.getString(c,{start:a.rangeStart,end:a.rangeEnd});break;case gb.enums.BinningParams.PRIME_ELIGIBLE_ONLY.key:c=b?gb.enums.FilterAttrToStrings.PRIME_SUMMARY:gb.enums.FilterAttrToStrings.PRIME;c=gb.resources.getString(c);break;case gb.enums.BinningParams.REVIEW_RATING.key:c=gb.enums.FilterAttrToStrings.REVIEW_RATING;c=gb.resources.getString(c,{stars:a.selected});break;case gb.enums.BinningParams.SORT_ORDER.key:c=gb.enums.SortOrdersToStringsMap[a.selected];c=gb.resources.getString(c);break;
case gb.enums.BinningParams.CASH_ON_DELIVERY.key:c=gb.enums.FilterAttrToStrings.CASH_ON_DELIVERY;c=gb.resources.getString(c);break;case gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key:c=gb.enums.FilterAttrToStrings.FULLFILLED_BY_AMAZON;c=gb.resources.getString(c);break;case gb.enums.IncludedDealTargetsSupported.MARKETING_ID:c=gb.resources.whitelistedMarketingIDNamesParsed[a.value];break;default:c=a.value}return c}},getLabelForSelectedAttribute:function(a,b){var c,d;b.widgetGroupID&&(d=gb.filterController.models[b.widgetGroupID].getSelectedBinningValues(a));
if(d){var e={};gb.enums.BinningParams.DEAL_STATE.key===a?e=f.object(gb.enums.FilterStatesToDealStates[d],f.range(gb.enums.FilterStatesToDealStates[d].length).map(function(){return 1})):f.isArray(d)?f.each(d,function(a){e[a]=1}):e[d]=1;(d=this.getFilterOptions(a,e,b)[0])&&(c=this.getFilterLabel(d))}return c}}});p.when("A","GoldboxMobile3PAssets").register("gb-filter-model",function(h,r){var f=r._;return h.createClass({init:function(a){a.widgetGroupID&&(this.widgetGroupID=a.widgetGroupID,this.widgetID=
a.widgetID);this._selectedFilterValues={};this.availableFilterOptions={};this.hasPageChanged=!1;this.filterPlurals={};this.redirectURL=this.widgetGroupAnchor=null;this.doPageRefresh=!1;this.filterConfigValuesHash={};this.attributesList=[];this.attributesWithDisabledValues=[];this.selectedFiltersCount=0;this.customFilter=null;this.targetedWidget={ID:0,title:null,savedTitle:null,clearTitle:!1};this.setFilterValue=f.wrap(this._setFilterValue,this._filterChangeWrapper);this.addFilterValue=f.wrap(this._addFilterValue,
this._filterChangeWrapper);this.removeFilterValue=f.wrap(this._removeFilterValue,this._filterChangeWrapper);this.removeAllFilterValues=f.wrap(this._removeAllFilterValues,this._filterChangeWrapper)},setupWidgetFilterConnections:function(){var a=gb.controller.schedulingParams[this.widgetID].refreshWidgets;if(a)for(var b in gb.widgets)if(gb.widgets[b].widgetName===a){this.targetedWidget.ID=b;break}},saveTargetedWidgetInfo:function(){gb.controller.schedulingParams[this.targetedWidget.ID]&&(-1===k.location.href.indexOf("gb_ttl_"+
this.widgetGroupID)?this.targetedWidget.savedTitle=gb.controller.schedulingParams[this.targetedWidget.ID].title:this.targetedWidget.title=gb.controller.schedulingParams[this.targetedWidget.ID].title)},mergeFilters:function(a){var b=this;b.widgetGroupAnchor=a.schedulingParams.widgetAnchorName||b.widgetGroupAnchor;a.schedulingParams.widgetCurrentTab&&(b._selectedFilterValues[gb.enums.WidgetConstants.CURRENT_TAB]=a.schedulingParams.widgetCurrentTab);f.each(gb.enums.DCSQueryParams,function(c){var e=a.schedulingParams[c];
if(f.isArray(e)?!f.isEmpty(e):e)f.isArray(e)&&(e=f.clone(e)),c===gb.enums.DCSQueryParams.DEAL_STATE&&(e=f.map(e,function(a){return gb.enums.DealStatesToFilterStates[a]}),e=f.unique(e)),c===gb.enums.DCSQueryParams.PRICE_RANGE&&(c=gb.enums.BinningParams.PRICE.key),c===gb.enums.DCSQueryParams.DISCOUNT_RANGE&&(c=gb.enums.BinningParams.DISCOUNT.key,e=e.join(",")),b._selectedFilterValues[c]=e});f.each(a.schedulingParams.extendedFilters,function(a,c){c===gb.enums.BinningParams.NEW_RELEASES.key&&(a=[1]);
c===gb.enums.BinningParams.DISCOUNT.key&&(a=a.join(","));f.isArray(a)&&(a=f.clone(a));b._selectedFilterValues[c]=a});var c=a.schedulingParams.filterConfig;f.each(c,function(a){var c=f.map(a.attr.split(","),h.$.trim);f.each(c,function(g,l){if(a.plural){var n=f.map(a.plural.split(","),h.$.trim);b.filterPlurals[g]=n[l]}if(a.values){var n=1<c.length?a.values[l]:a.values,w=b.getDCSQueryParamForBinningKey(g);b._selectedFilterValues[w]&&f.isEqual(b._selectedFilterValues[w],n)&&delete b._selectedFilterValues[w];
if(g===gb.enums.BinningParams.DEAL_STATE.key){var k=[];f.each(n,function(a){k.push(gb.enums.FilterStatesToDealStates[a])});n=f.flatten(k,!0)}b.filterConfigValuesHash[g]=n}a.disableValues&&(b.attributesWithDisabledValues=f.union(b.attributesWithDisabledValues,g))})});b.customFilter=a.schedulingParams.customFilter;b.attributesList=f.union(b.attributesList,gb.utils.getFilterAttributesList(c));b.populateAvailableFilters(a.dcsServerResponse.binning);gb.filterController.trigger("gbfilter:mergeFilters",
this)},getDCSQueryParamForBinningKey:function(a){var b=gb.enums.BinningKeyToDCSQueryParamMap[a];if(!b||f.isArray(b))b=a;return b},getSelectedBinningValues:function(a){a=this.getDCSQueryParamForBinningKey(a);var b=this._selectedFilterValues[a];a===gb.enums.DCSQueryParams.ACCESS_TYPE&&(b=this._transformAccessTypesToAnArray(b));return b},_transformAccessTypesToAnArray:function(a){var b=[];f.isArray(a)?f.each(a,function(a){a=f.isArray(a)?a.sort().join("__"):a;b.push(a)}):b.push(a);return b},getSelectedFilters:function(a,
b){var c=this,d=f.map(c._selectedFilterValues,function(d,g){if(b&&!f.contains(b,g))return{};if(g!==gb.enums.DCSQueryParams.SORT_ORDER&&g!==gb.enums.DCSQueryParams.PAGE&&g!==gb.enums.DCSQueryParams.MIN_RATING)if(g===gb.enums.DCSQueryParams.PRIME_ELIGIBLE_ONLY||g===gb.enums.DCSQueryParams.GLOBAL_ELIGIBLE_ONLY||g===gb.enums.DCSQueryParams.FREE_SHIPPING_ELIGIBLE_ONLY)d=!0;else if(g===gb.enums.DCSQueryParams.PRIME_ACCESS_TYPE)d=d.toString();else if(g===gb.enums.DCSQueryParams.ACCESS_TYPE)d=c._populateAccessTypesAsAnArray(d);
else if(g===gb.enums.BinningParams.DISCOUNT.key)a||(g=gb.enums.DCSQueryParams.DISCOUNT_RANGE),d=d.split(",");else if(g===gb.enums.BinningParams.GIFT_WRAPPABLE.key||g===gb.enums.BinningParams.CASH_ON_DELIVERY.key||g===gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key)d=d?["true"]:["false"];else{f.isArray(d)||(d=[d]);if(g===gb.enums.DCSQueryParams.DEAL_STATE){var l=[];f.each(d,function(a){l.push(gb.enums.FilterStatesToDealStates[a])});d=f.flatten(l,!0)}a||g!==gb.enums.BinningParams.PRICE.key||(g=gb.enums.DCSQueryParams.PRICE_RANGE)}return[g,
d]});return f.object(d)},_populateAccessTypesAsAnArray:function(a){var b=[];f.isArray(a)?f.each(a,function(a){var d=a;f.isArray(a)||(d=[a]);b.push(d)}):b.push([a]);return b},populateAvailableFilters:function(a){var b=this;f.each(a,function(a,d){f.isEmpty(a)?delete b.availableFilterOptions[d]:b.availableFilterOptions[d]=a});b.updateSelectedFiltersCount()},_setFilterValue:function(a,b){a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY?
(b=b.toString(),this._removeFilterValue(a,q),this._addFilterValue(a,b)):this._selectedFilterValues[a]=b},_addFilterValue:function(a,b){this._selectedFilterValues[a]=this._selectedFilterValues[a]||[];if(a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY)b=b.toString();this._selectedFilterValues[a].push(b)},_removeFilterValue:function(a,b){var c=f.flatten([this._selectedFilterValues[a]],!0);this._selectedFilterValues[a]=f.without(c,
b);if("undefined"===typeof b||!this._selectedFilterValues[a].length){var c=a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||a===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY,d;c&&(d=gb.utils.getmarketingIDsToKeep(this._selectedFilterValues));c&&d.length?this._selectedFilterValues[a]=d:(this._selectedFilterValues[a]=null,delete this._selectedFilterValues[a])}},_filterChangeWrapper:function(a){var b=f.tail(arguments),c=this.getDCSQueryParamForBinningKey(b[0]),d=b[1],e=b[2],
g=b[3],b=b[4];a.call(this,c,d);c===gb.enums.DCSQueryParams.PAGE&&(this.hasPageChanged=!0);f.isUndefined(e)||(f.isUndefined(d)?e.context=gb.metrics.refTags.clearFilter:e.data.push(d),gb.controller.schedulingParams[e.widgetID].refreshWidgets&&(this.targetedWidget.ID?e.widgetID=this.targetedWidget.ID:g=!0));g||this.triggerChangeEvent(e,b)},_removeAllFilterValues:function(){var a=gb.enums.DCSQueryParams.SORT_ORDER,b=gb.utils.getmarketingIDsToKeep(this._selectedFilterValues);if(this.customFilter){var c=
this.getDCSQueryParamForBinningKey(this.customFilter);this._selectedFilterValues=f.pick(this._selectedFilterValues,c,a)}else this._selectedFilterValues=f.pick(this._selectedFilterValues,a);0<b.length&&(this._selectedFilterValues[gb.enums.IncludedDealTargetsSupported.MARKETING_ID]=b)},triggerChangeEvent:function(a,b){this.hasPageChanged||(this._selectedFilterValues[gb.enums.DCSQueryParams.PAGE]=1,gb.controller.widgetCurrentPage[a.widgetID]=1);a.eventID&&!gb.resources.deviceInfo.isPhone&&gb.resources.deviceInfo.isApp&&
p.when("a-popover").execute(function(a){(a=a.get(gb.enums.WidgetViewIDs.REFINE_POPOVER_NAME))&&a.hide()});this.hasPageChanged=!1;gb.filterController.trigger("gbfilter:change",this,a,b)},updateSelectedFiltersCount:function(){var a=this;a.selectedFiltersCount=0;f.each(a.attributesList,function(b){a.getSelectedBinningValues(b)&&a.selectedFiltersCount++})},getSelectedFilterCount:function(){return this.selectedFiltersCount}})});p.when("A","GoldboxMobile3PAssets","gb-filter-model").register("gb-shoveler-filter-model",
function(h,k,f){var a=k._;return f.extend({init:function(b){this._super(b);this._initalizeFilterChangeHandlers();this._updateDealStates=a.wrap(this._updateDealStatesHandler,this._filterChangeWrapper)},_initalizeFilterChangeHandlers:a.once(function(){h.declarative("gbshovl-state","click",a.wrap(function(a,c){var d=gb.controller.schedulingParams[c.widgetID],e=d.widgetCurrentTab,g=parseInt(a.data.tabIndex,10);e!==g&&(e=gb.widgets[c.widgetID],e.renderShovlButtonsContent(!0),e.skinDomElement.find("#"+
gb.enums.WidgetViewIDs.SHOVL_PAGINATION).html(""),d.widgetCurrentTab=g,e.renderWireFrame(),gb.filterController.models[c.metrics.eventID]._updateDealStates(c.attribute,c.widgetID,c.metrics))},this._shovlFilterChangeWrapper));h.declarative(gb.enums.WidgetActions.Shoveler.SHOVEL,"click",a.wrap(function(a,c){if(a.data.buttonStatus!==gb.enums.ShovlConstants.DISABLED){var d=gb.widgets[c.widgetID];d.renderShovlButtonsContent(!0);d.isLaunchCellPage=gb.utils.isLaunchCellPage(c.widgetID);var d=gb.controller.widgetCurrentPage[c.widgetID],
e=a.data.actionType;e===gb.enums.ShovlConstants.SHOVL_NEXT?d++:e===gb.enums.ShovlConstants.SHOVL_PREVIOUS&&d--;e=parseInt(a.data.totalPages,10);1<=d&&d<=e&&(e=gb.filterController.models[c.metrics.eventID],gb.controller.widgetCurrentPage[c.widgetID]=d,e.setFilterValue(c.attribute,d,c.metrics))}},this._shovlFilterChangeWrapper))}),_shovlFilterChangeWrapper:function(b){var c=a.tail(arguments)[0],d=parseInt(c.data.widgetID,10),e=c.data.attribute,g=gb.widgets[d].widgetGroupID;d&&g&&b.call(this,c,{attribute:e,
metrics:{context:gb.metrics.refTags.filter,data:[g,e],eventID:g,widgetID:d},widgetID:d})},_updateDealStatesHandler:function(b,c){var d=gb.controller.schedulingParams[c],e=a.flatten(d.widgetTabConfig[d.widgetCurrentTab].dealStates);this._selectedFilterValues[b]=a.clone(e);this._selectedFilterValues[gb.enums.ShovlConstants.SHOVL_STATE_TAB]=d.widgetCurrentTab}})});p.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-deal-asin-dao").register("gb-dcs-translator",function(h,r,f,a){var b=r._;return f.extend({init:function(){this._super();
this.registerConnections()},registerConnections:function(){this.on("PopulateMetadata",this.populateSelectDealsMetadata);this.on("PopulateDealDAO",this.populateDealDetails);this.on("PopulateStatus",this.populateDealStatus)},populateSelectDealsMetadata:function(a,d){var e=this;if(d&&d.dealDetails&&d.dealStatus){var g=d.dealDetails,l=d.dealStatus,n=(new Date).getTime();b.each(g,function(a,b){var c=gb.controller.getDealDAO(b),d=l[b];d.responseTimestamp=n;e.trigger("PopulateDealDAO",c,a,d)})}},populateDealDetails:function(a,
d,e){if(d){gb.service.dealsWithDetails[a.dealID]=!0;a.dealType=d.type;a.legacyDealID=d.legacyDealID;a.offerID=d.offerID;a.merchantID=d.merchantID;a.merchantName=d.merchantName;var g=gb.resources.getFeature("gb_giveaway_deals");a.detail.title=d.title;d.primaryImage&&(a.detail.imageAsin=gb.baseUtils.checkAndSetSSLImageUrl(d.primaryImage));a.detail.description=d.description;a.detail.URL=this._setDealDetailURL(d,!1);a.detail.itemType=d.itemType;a.detail.buyAsin=d.reviewAsin;a.detail.impressionAsin=d.impressionAsin;
d.reviewAsin&&(a.reviews.URL=gb.utils.getReviewsPageURL(d.reviewAsin,d.type));d.marketingMessage&&(a.detail.marketingMessage=d.marketingMessage);d.isFulfilledByAmazon&&(a.detail.isFulfilledByAmazon=d.isFulfilledByAmazon);null!==d.totalReviews&&d.totalReviews!==q&&(a.reviews.total=parseInt(d.totalReviews,10));null!==d.reviewRating&&d.reviewRating!==q&&(a.reviews.rating=parseFloat(d.reviewRating));a.auxiliaryData.isPrimeEligible=gb.resources.getCustomerData("isPrimeMarketplace")&&gb.utils.parseBool(d.isPrimeEligible);
d.teaser&&(a.teaser.teaserLine=d.teaser);d.teaserImage&&(a.teaser.teaserImage=gb.baseUtils.checkAndSetSSLImageUrl(d.teaserImage));d.teaserAsin&&(a.teaser.teaserURL=this._setDealDetailURL(d,!0));this._setAccessType(a,d,e,g);a.detail.isPrimeEarlyAccessDeal=!1;a.detail.isPrimeOnly=!1;switch(a.detail.accessType){case gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS:a.detail.isPrimeEarlyAccessDeal=!0;break;case gb.enums.DealAccessTypes.PRIME_ONLY_DOTD:case gb.enums.DealAccessTypes.PRIME_ONLY_LD:case gb.enums.DealAccessTypes.PRIME_ONLY_BD:a.detail.isPrimeOnly=
!0;break;case gb.enums.DealAccessTypes.APP_ONLY_LD:case gb.enums.DealAccessTypes.APP_EARLY_ACCESS:a.detail.isAppDeal=!0;break;case gb.enums.DealAccessTypes.GIVEAWAY_DEAL:a.detail.isGiveawayDeal=!0}a.detail.isGiveawayDeal&&e.dealState===gb.enums.DealStates.AVAILABLE&&(a.detail.URL=this._setGiveawayDealDetailURL(a.detail.URL));a.auxiliaryData.breaksMAP=gb.utils.parseBool(d.isMAP);null!==d.maxDealPrice&&d.maxDealPrice!==q&&null!==d.minDealPrice&&d.minDealPrice!==q?a.pricingData.prices.dealPrice={max:{value:parseFloat(d.maxDealPrice)},
min:{value:parseFloat(d.minDealPrice)}}:a.detail.isGiveawayDeal&&!b.isEmpty(d.marketingMessage)&&(a.detail.giveawayValue=d.marketingMessage);null!==d.maxBAmount&&d.maxBAmount!==q&&null!==d.minBAmount&&d.minBAmount!==q&&(a.pricingData.prices.basisPrice={max:{value:parseFloat(d.maxBAmount)},min:{value:parseFloat(d.minBAmount)}});null!==d.pricePerUnit&&d.pricePerUnit!==q&&(a.pricingData.unitPrice={value:parseFloat(d.pricePerUnit)},a.pricingData.unitPrice.formattedValue=gb.utils.getFormattedPrice(a.pricingData.unitPrice.value));
null!==d.baseUnitValue&&d.baseUnitValue!==q&&null!==d.baseUnitName&&d.baseUnitName!==q&&(a.pricingData.baseUnit={value:d.baseUnitValue,name:d.baseUnitName});b.each(a.pricingData.prices,function(d,e){null===d&&d===q||b.each(d,function(b,d){a.pricingData.prices[e][d].formattedValue=gb.utils.getFormattedPrice(a.pricingData.prices[e][d].value)})});if(d.maxPercentOff&&d.minPercentOff){var g=parseInt(d.maxPercentOff,10),l=parseInt(d.minPercentOff,10);g===l&&(a.pricingData.percentOff=gb.utils.getDisplayablePercentOff(g))}null!==
a.pricingData.percentOff&&a.pricingData.percentOff!==q||a.calculatePercentOff();a.detail.itemType===gb.enums.ItemTypes.VARIATION&&this.populateAsinDetails(d.items,a);d.bKind&&(a.pricingData.bKind=d.bKind);d.glProductGroup&&-1!==b.indexOf(gb.utils.digitalGlProductGroup,d.glProductGroup)&&(a.isDigital=!0);this._setExtendedAttributes(a,d);this._groupDealsByType(a);this._groupDealsByAccessType(a);this._executePostTranslationRules(a);e&&this.populateDealStatus(a,e)}},_setAccessType:function(a,b,e,g){gb.resources.getFeature("appearly_apponly_access")||
g&&e.dealState===gb.enums.DealStates.AVAILABLE?b.accessBehavior&&null!==b.accessBehavior.accesslogic?(b=gb.utils.deduceAccessTypeInfoFromGetDealResponse(b,e,g),a.detail.accessType=b.accessType,a.detail.accessDurationInMs=parseInt(b.accessTypeDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS):b.primeAccessType?(gb.enums.DealAccessTypes[b.primeAccessType]&&(a.detail.accessType=b.primeAccessType),a.detail.accessDurationInMs=parseInt(b.primeAccessDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS):(a.detail.accessType=
null,a.detail.accessDurationInMs=null):(gb.enums.DealAccessTypes[b.primeAccessType]&&(a.detail.accessType=b.primeAccessType),a.detail.accessDurationInMs=parseInt(b.primeAccessDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS)},_setGiveawayDealDetailURL:function(a){var b=k.location.protocol+"//"+k.location.host+gb.enums.GiveawayUrlParams.returnToUrl;a=gb.utils.setUrlParam(a,"fsrc",gb.enums.GiveawayUrlParams.client);a=gb.utils.setUrlParam(a,"return_to",encodeURIComponent(b));return a=gb.utils.setUrlParam(a,
"nav",gb.enums.GiveawayUrlParams.nav)},_groupDealsByType:function(a){var b=gb.metadata.dealsByType[a.dealType]||[];b.push(a.dealID);gb.metadata.dealsByType[a.dealType]=b},_groupDealsByAccessType:function(a){var b=a.detail.accessType;if(b){var e=gb.metadata.dealsByAccessType[b]||[];e.push(a.dealID);gb.metadata.dealsByAccessType[b]=e}},_setExtendedAttributes:function(a,d){var e=d.extendedAttributes;e&&b.isArray(e.hideAddToCart)&&"1"===e.hideAddToCart[0]&&(a.extendedAttributes.hideAddToCart=!0)},_setDealDetailURL:function(a,
b){var e=a.merchantID,g=gb.clientName,l=a.egressUrl,n=l,f=a.itemType,h=a.reviewAsin;b&&(h=a.teaserAsin);l=l?-1===l.indexOf("/dp/")||-1!==l.indexOf("forceLinkOverride"):!1;if(g===gb.enums.MobileClients.PC){if(a.type===gb.enums.DealTypes.EVENT&&!l||b)n=h?gb.utils.getDetailPageURL(h,g):"";n&&e&&!gb.utils.hasConflictingDpParams(n)&&(n=gb.utils.setUrlParam(n,"smid",e))}else{if(a.type!==gb.enums.DealTypes.EVENT||!l){gb.utils.isTablet(g)&&(g=gb.enums.Platforms.TAB);var k=gb.utils.isUnsupportedEgressURL(a),
r=gb.resources.deviceInfo,l=!1;if(a.type===gb.enums.DealTypes.DOTD||a.type===gb.enums.DealTypes.BD||a.primeAccessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD)if(f===gb.enums.ItemTypes.SINGLE||k||r.isWindowsPhone||r.isMetro)l=!0;f=a.type===gb.enums.DealTypes.LD&&a.primeAccessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||a.type===gb.enums.DealTypes.LOCAL||a.type===gb.enums.DealTypes.EVENT;if(b||l||f)a.type===gb.enums.DealTypes.BD&&a.itemType===gb.enums.ItemTypes.NONE&&(h=gb.utils.getAsinFromURL(a.egressUrl)),
n=h?gb.utils.getDetailPageURL(h,g):""}n&&e&&!gb.utils.hasConflictingDpParams(n)&&(n=gb.resources.getFeature("smid_m_standardization")?gb.utils.setUrlParam(n,"smid",e):gb.utils.setUrlParam(n,"m",e));n&&(n=gb.utils.setUrlParam(n,"dealid",a.dealID))}return n=gb.utils.convertToRequesterDomainUrl(n)},populateDealStatus:function(a,d,e){if(d){var g=d.responseTimestamp||(new Date).getTime(),l=a.status.dates.cacheExpires;a.dealType===gb.enums.DealTypes.LD&&!gb.utils.parseBool(d.isRedemptionStatus)&&l&&l.getTime()>
g||(a.customerState=null,a.checkingDealStatus=!1,d.percentClaimed!==q&&null!==d.percentClaimed&&(a.status.percentClaimed=parseInt(d.percentClaimed,10)),d.isValid!==q&&null!==d.isValid&&(a.status.isValidDeal=d.isValid),d.msCacheTtl!==q&&null!==d.msCacheTtl&&(l=parseInt(d.msCacheTtl,10),a.status.cache.lastMsCacheTtl=l,a.status.dates.cacheExpires=new Date(g+l)),d.msToEnd!==q&&null!==d.msToEnd&&(a.status.dates.end=new Date(g+parseInt(d.msToEnd,10))),d.msToStart!==q&&null!==d.msToStart&&(a.status.dates.start=
new Date(g+parseInt(d.msToStart,10))),gb.resources.customerData.hasEarlyAccessBenefit||(g=a.status.dates.start.getTime()+a.detail.accessDurationInMs,a.status.dates.startForNonPrimeCustomer=new Date(g)),d.totalCouponCount!==q&&null!==d.totalCouponCount&&(a.couponCounts.total=parseInt(d.totalCouponCount,10)),gb.metadata.dealsByState[d.dealState]=gb.metadata.dealsByState[d.dealState]||[],gb.metadata.dealsByState[d.dealState].push(a.dealID),d.dealState&&(d.dealState===gb.enums.DealStates.UPCOMING&&0>=
parseInt(d.msToStart,10)?a.dealState=gb.enums.DealStates.COMINGSOON:a.dealState=d.dealState),a.detail.itemType===gb.enums.ItemTypes.VARIATION&&b.each(d.dealItemStatus,function(b,d){var e=a.getAsinDAO(d);e&&b&&gb.translator.populateAsinStatus(e,b)}),!b.isEmpty(gb.metadata.watchedDeals)&&-1<b.indexOf(gb.metadata.watchedDeals.ALL,a.dealID)&&(a.isDealWatched=!0),this._setDealTimeouts(a,d),a.trigger("RefreshView"),e&&e(a))}},populateAsinStatus:function(a,b){a.status.itemState=b.itemState;a.status.customerState=
b.customerState;b.percentClaimed!==q&&null!==b.percentClaimed&&(a.status.percentClaimed=b.percentClaimed);var e=gb.controller.getDealDAO(a.dealID);e.dealType===gb.enums.DealTypes.LD&&this._setAsinTimeouts(e,a,b)},translateClaimDealStatus:function(a,b,e){if(e)return a={isRedemptionStatus:!0,msCacheTtl:gb.enums.DefaultPollingIntervals.LD,dealItemStatus:{}},e.msCacheTtl!==q&&null!==e.msCacheTtl&&(a.msCacheTtl=parseInt(e.msCacheTtl,10)),e.dealItemStatus&&(a.dealItemStatus[b]={itemState:e.dealItemStatus.itemState,
customerState:e.dealItemStatus.customerState,msToCustomerStateExpiry:e.dealItemStatus.msToCustomerStateExpiry}),a},_setAsinTimeouts:function(a,b,e){var g=b.status.timeouts,l=b.status.dates,n=(new Date).getTime();k.clearTimeout(g.incartEnds);k.clearTimeout(g.pendingATCEnds);g.incartEnds=l.incartEnds=g.pendingATCEnds=l.pendingATCEnds=null;b.status.customerState===gb.enums.CustomerStates.INCART&&e.msToCustomerStateExpiry&&(l.incartEnds=new Date(n+parseInt(e.msToCustomerStateExpiry,10)),k.clearTimeout(g.incartEnds),
g.incartEnds=gb.utils.setSafeTimeout(function(){b.status.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},l.incartEnds.getTime()-n));b.status.customerState===gb.enums.CustomerStates.PENDINGATC&&e.msToCustomerStateExpiry&&(l.pendingATCEnds=new Date(n+parseInt(e.msToCustomerStateExpiry,10)),k.clearTimeout(g.pendingATCEnds),g.pendingATCEnds=gb.utils.setSafeTimeout(function(){b.status.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},l.pendingATCEnds.getTime()-n))},
_setDealTimeouts:function(a,d){var e=a.status.timeouts,g=a.status.dates,l=(new Date).getTime();k.clearTimeout(e.end);k.clearTimeout(e.start);k.clearTimeout(e.incartEnds);k.clearTimeout(e.earlyAccessExpires);k.clearTimeout(e.pendingATCEnds);e.end=e.start=e.incartEnds=e.earlyAccessExpires=g.incartEnds=g.pendingATCEnds=e.pendingATCEnds=a.customerState=null;a.dealState!==gb.enums.DealStates.SOLDOUT&&a.dealState!==gb.enums.DealStates.EXPIRED&&(e.end=gb.utils.setSafeTimeout(function(){a.dealState=gb.enums.DealStates.EXPIRED;
a.trigger("RefreshView");gb.utils.invokeWatchDealStateTransitions(a.dealID)},g.end.getTime()-l));if(gb.utils.isDealInEarlyAccessWindow(a)){var n=a.detail.accessDurationInMs+parseInt(d.msToStart,10);n<=parseInt(d.msCacheTtl,10)&&(k.clearTimeout(e.earlyAccessExpires),e.earlyAccessExpires=k.setTimeout(function(){gb.resources.customerData.hasEarlyAccessBenefit||(a.checkingDealStatus=!0,a.dealState=gb.enums.DealStates.LOADING);a.trigger("RefreshView");gb.utils.invokeWatchDealStateTransitions(a.dealID)},
n),g.cacheExpires=new Date(n+l))}a.dealState===gb.enums.DealStates.UPCOMING&&(a.dealType===gb.enums.DealTypes.LD&&gb.utils.hasPricingDetails(a)?e.start=gb.utils.setSafeTimeout(function(){a.dealState=gb.enums.DealStates.AVAILABLE;b.each(a.items,function(a,b,c){a.status.itemState=gb.enums.DealStates.AVAILABLE});gb.service.dealsWithDetails[a.dealID]=!0;gb.utils.invokeWatchDealStateTransitions(a.dealID);a.trigger("RefreshView")},g.start.getTime()-l):e.start=gb.utils.setSafeTimeout(function(){a.dealState=
gb.enums.DealStates.LOADING;gb.service.dealsWithDetails[a.dealID]=!1;a.trigger("RefreshView");gb.service.getDealDetails(a.dealID);gb.utils.invokeWatchDealStateTransitions(a.dealID)},g.start.getTime()-l));gb.watcher.dealsInView[a.dealID]&&(k.clearTimeout(e.cacheExpires),e.cacheExpires=k.setTimeout(function(){a.dealType!==gb.enums.DealTypes.LD||a.dealState!==gb.enums.DealStates.UPCOMING||gb.utils.hasPricingDetails(a)?gb.service.pollDealStatus(a.dealID):(gb.service.dealsWithDetails[a.dealID]=!1,gb.service.getDealDetails(a.dealID))},
g.cacheExpires.getTime()-l));var n=d.dealItemStatus&&d.dealItemStatus[a.detail.buyAsin],f=a.detail.itemType===gb.enums.ItemTypes.VARIATION&&a.dealType===gb.enums.DealTypes.LD;n&&b.contains(b.values(gb.enums.CustomerStates),n.customerState)&&!f&&(a.customerState=n.customerState);a.dealType===gb.enums.DealTypes.LD&&n&&n.customerState===gb.enums.CustomerStates.INCART&&!f&&n.msToCustomerStateExpiry&&(g.incartEnds=new Date(l+parseInt(n.msToCustomerStateExpiry,10)),k.clearTimeout(e.incartEnds),e.incartEnds=
gb.utils.setSafeTimeout(function(){a.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},g.incartEnds.getTime()-l));a.dealType===gb.enums.DealTypes.LD&&n&&n.customerState===gb.enums.CustomerStates.PENDINGATC&&!f&&n.msToCustomerStateExpiry&&(g.pendingATCEnds=new Date(l+parseInt(n.msToCustomerStateExpiry,10)),k.clearTimeout(e.pendingATCEnds),e.pendingATCEnds=gb.utils.setSafeTimeout(function(){a.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},g.pendingATCEnds.getTime()-
l))},populateAsinDetails:function(c,d){b.each(c,function(b){var c=new a(b);d.items[b.itemID]=c})},_executePostTranslationRules:function(a){if("LOCAL_DEAL"===a.dealType&&a.detail){var b=a.detail.URL;if(b){var e=b.match(/:\/\/(.[^\/]+)/)[1];if(e&&e.match(/^local\./)){var g=b.split(e),e=e.replace(/^local\./,"www."),b=g[0],g=g[1];b&&g&&(a.detail.URL=b+e+"/local"+g)}}}}})});p.when("A","GoldboxMobile3PAssets").register("gb-view-component-builder",function(h,r){var f=r._;return h.createClass({_addMetricsData:function(a,
b){var c=[a.deal&&a.deal.dealID];a.deal&&a.deal.detail&&a.deal.detail.isAppDeal&&c.push(gb.metrics.refTags.app);if(a.deal&&a.deal.detail&&a.deal.detail.isGiveawayDeal){var d=f.keys(gb.widgets[a.widgetID].dealViews[a.deal.dealID])[0];c.push(gb.metrics.refTags.giveaway);c.push(d)}a.getReffedURL=gb.metrics.partiallyAppliedReffedURLFunction({widgetID:a.widgetID,data:c});return a},_addMobileReffedDetailURL:function(a){var b="",b=a.deal.dealState===gb.enums.DealStates.UPCOMING||a.deal.dealState===gb.enums.DealStates.COMINGSOON?
a.deal.teaser.teaserURL:a.deal.detail.URL;a.mobileReffedDetailURL=a.getReffedURL(b,gb.metrics.refTags.mobile);return a},_getWidgetViewFlexModelData:function(a,b){var c=gb.configManager.getWidgetViewConfig(a.widgetID),d=document.documentElement.style;if(c.allowFlexRendering&&("flexWrap"in d||"WebkitFlexWrap"in d||"msFlexWrap"in d)){var e=gb.configManager.getDealViewConfig(a.widgetID),d=e.dealsPerRowP,e=e.dealsPerRowL,g,l;l=a.skinDomElement.find(".dealView");g=gb.utils.getDealsPerRow(h.$(k).height(),
a.minDealViewWidth,c.hasMargin,c.supportEvenColumnsOnly);a.viewOrientation===gb.enums.ClientOrientation.LANDSCAPE?(e=b.columnCount<=e?b.columnCount:e,d=g<=d?g:d,b.columnCount=e):(d=b.columnCount<=d?b.columnCount:d,e=g<=e?g:e,b.columnCount=d);0<l.size()?(c=l.eq(0),l=parseFloat(c.data("pwidth")),c=parseFloat(c.data("lwidth"))):(g=gb.utils.getComputedDealWidthForFlexWidget(a.dealsPerRow,c.supportEvenColumnsOnly),l=d===a.dealsPerRow?g:gb.utils.getComputedDealWidthForFlexWidget(d,c.supportEvenColumnsOnly),
c=e===a.dealsPerRow?g:gb.utils.getComputedDealWidthForFlexWidget(e,c.supportEvenColumnsOnly));g=a.viewOrientation===gb.enums.ClientOrientation.PORTRAIT?l:c;b.doFlexRendering=!0;b.dealWidth=g+"%";b.dealWidthP=l+"%";b.dealWidthL=c+"%";b.dealPerRow={};b.dealPerRow[gb.enums.ClientOrientation.PORTRAIT]=d;b.dealPerRow[gb.enums.ClientOrientation.LANDSCAPE]=e;d=b.elements||{};d.flexContainer=gb.templateManager.getWidgetHTML({widgetID:a.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"flexContainer",data:b});b.elements=d}},getWidgetViewTemplateData:function(a,b){var c=a.widgetID,d=gb.controller.schedulingParams[c],e=gb.enums.WidgetViewIDs,g=gb.enums.WidgetHeaderIDs,l=gb.configManager.getDealViewConfig(c),n=a.dealsPerRow,f,h=gb.watcher.lowestDealIDWatchedIndex[c]+1-a.nextPositionToRender,k=Math.ceil(h/d.pageSize);f=Math.ceil((a.nextPositionToRender+1)/d.pageSize);if(d.enforceLimitedDeals||d.enablePagination)var k=1,r=d.pageSize,h=Math.min(gb.metadata.selectedDealsCount[c]-
(gb.controller.widgetCurrentPage[c]-1)*r,r);var p=b?1:f,r=gb.enums.Constants.MAX_SUPPLE_DEALS_TO_DISPLAY;d.pageSize&&(r=d.pageSize);f=this._getCurrentCategory(c);var q=this._getCurrentStates(c),t=gb.utils.getFilterViewIDs(d.filterConfig),A=d.redirectText||gb.resources.getString("gb_see_all_deals"),E=0,D,m=gb.filterController.models[a.widgetGroupID];m&&(E=m.getSelectedFilterCount(),m.customFilter&&(D=gb.filterUtils.getLabelForSelectedAttribute(m.customFilter,{widgetID:a.widgetID,widgetGroupID:a.widgetGroupID,
totalPages:a.totalPages}))&&--E);e={widgetView:a,schedulingParams:d,widgetID:c,widgetGroupID:a.widgetGroupID,viewIDs:e,filterViewIDs:t,totalDeals:gb.metadata.getAllDisplayableDealIDs(c).length,totalDealsToShowCount:gb.controller.totalDealsToShow[c],totalDisplayableDealsCount:gb.controller.totalDisplayableDealsCount[c],orientation:a.viewOrientation,dealViewCount:a.nextPositionToRender,dealViewConfig:l,firstPage:p,columnCount:n,cellCount:h,pagesToDraw:k,pageSize:r,seeAllText:A,WidgetHeaderIDs:g,selectedFilterCount:E,
sortOptionSelected:gb.resources.getString(gb.enums.SortOrdersToStringsMap[d.sortOrder]),customFilterSelected:D,nextAdSlotToRenderIndex:a.nextAdSlotToRenderIndex,currentCategory:f,currentStates:q,title:d.title};this._getWidgetViewFlexModelData(a,e);g=gb.controller.widgetCurrentStatus[c];f&&(gb.controller.isPaginatedMetadataCall(c)&&(e.dealCount=gb.metadata.getAllDisplayableDealIDs(c).length),gb.metadata.sortedDealIDs[c][g]&&gb.metadata.sortedDealIDs[c][g][f]&&(e.dealCount=gb.metadata.sortedDealIDs[c][g][f].length));
d.enablePagination&&(e.widgetLandingPageUrl=gb.utils.getWidgetLandingPageUrl(c));a.deprecateNoDealMsg||(f=this._getNoDealsMessage(a),e.noDealsMessage=f.message,e.isFiltersSelected=f.isFiltersSelected,e.isGDMFailing=a.isGDMFailing,e.isRetryInProgress=a.isRetryInProgress);!d.enablePagination&&gb.watcher.lowestDealIDWatchedIndex[c]<e.totalDeals-1&&!d.watchedDealsWidget?e.showLoadingSpinner=!0:(a.hideScrollContentLoader(),e.showLoadingSpinner=!1);return this._addMetricsData(e)},getRefineTemplateData:function(a,
b){var c=this.getWidgetViewTemplateData(a);c.useLinksForFilterItem=!0;var d=[];if(gb.controller.isPaginatedMetadataCall(a.widgetID)){c.useLinksForFilterItem=!1;var e=gb.metadata.binningInfo[a.widgetID].whitelist_categories,g=[];gb.resources.whitelistedCategoryList.forEach(function(a){e&&e[a]&&g.push(a)});if(g){for(var l=0;l<g.length;l++)var n=e[g[l]],d=this._getRefineRowData(n,g[l],d,b);f.contains(gb.filterController.models[gb.widgets[a.widgetID].widgetGroupID].attributesList,gb.enums.BinningParams.PRIME_ACCESS_TYPE.key)&&
(c.showPEALink=!0,c.PEAText=gb.resources.getString("csld-cat-prime_early_access_deals"),c.POLDText=gb.resources.getString(gb.enums.FilterAttrToStrings.PRIME_ONLY_LD),c.PODOTDText=gb.resources.getString(gb.enums.FilterAttrToStrings.PRIME_ONLY_DOTD))}}else for(var l=gb.metadata.getMetadataCategories(a.widgetID),h=gb.controller.widgetCurrentStatus[a.widgetID],k=0;k<l.length;k++)n=gb.metadata.sortedDealIDs[a.widgetID][h][l[k]].length,d=this._getRefineRowData(n,l[k],d,b);c.categoryData=d;return c},_getRefineRowData:function(a,
b,c,d){d=gb.resources.getCategoryName(b,d);b!==gb.enums.CategoryFilters.ALL&&(d=d+" ("+a+")");0<a&&c.push({nodeId:b,text:d});return c},getDealViewTemplateData:function(a,b){var c=a.deal;if(c.dealState===gb.enums.DealStates.LOADING)return{};var d=a.widgetView,e=gb.configManager.getWidgetViewConfig(d.widgetID),g=gb.configManager.getDealViewConfig(d.widgetID),l=null,n=!1,f=!1,k="",r=gb.resources.getCustomerData("realm");"function"===typeof d._isDoubleCell&&(n=d._isDoubleCell(c.dealID));if(c.dealType===
gb.enums.DealTypes.COUPON||c.dealType===gb.enums.DealTypes.LOCAL)l=c.detail.marketingMessage;gb.utils.showPPU(c.dealID)&&c.pricingData.unitPrice&&c.pricingData.baseUnit&&(f=!0,k=gb.resources.getString("gb_ppu_price",{price:c.pricingData.unitPrice.formattedValue,unitValue:c.pricingData.baseUnit.value,unitName:c.pricingData.baseUnit.name}));var p=gb.controller.watchDealView?gb.controller.watchDealView._isPopupTriggerRequired(d):!1,e={widgetID:d.widgetID,widgetGroupID:d.widgetGroupID,deal:c,dealViewConfig:g,
widgetViewConfig:e,position:a.position,viewIDs:gb.enums.dealViewIDs,totalDeals:gb.metadata.selectedDealsCount[d.widgetID],orientation:d.viewOrientation,marketingMessage:l,isDoubleCell:n,isPrimeEarly:c.detail.isPrimeEarlyAccessDeal,isPrimeOnly:c.detail.isPrimeOnly,showPPU:f,ppuPrice:k,isPopupTriggerRequired:p,realm:r};e.showPercentOff=gb.utils.isShowPercentageOffEnabled();e.priceText=gb.utils.getPriceTextForBasisKind(c.pricingData.bKind);l=gb.templateManager.hasTemplate({widgetID:d.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,
templateName:"badge"});n=gb.templateManager.hasTemplate({widgetID:d.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"primeBadge"});if(l||n)e.badgeProperty=gb.badgeUtils.generateBadgeProperties(a);c.detail.itemType===gb.enums.ItemTypes.VARIATION&&gb.widgets[d.widgetID].widgetName===gb.enums.WidgetNames.ML_HERO?(e.asin=b,e.dimensionData=this._findDimensionData(c),e.selectedDimension=a.variationView.selectedDimension,e.unavailableAsinSelected=a.variationView.unavailableAsinSelected,
e.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(a,b),e.priceText=b?gb.utils.getPriceTextForBasisKind(b.bKind):gb.utils.getPriceTextForBasisKind(c.pricingData.bKind),this._setDealViewTimerData(a,e,b)):(e.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(c,d.widgetID),this._setDealViewTimerData(a,e));e.cellCount=gb.metadata.getSortedDealIDs(d.widgetID).length;e.customerRefTag=gb.service.customerID?gb.metrics.refTags.recLearnMore:gb.metrics.refTags.unrecLearnMore;e.imageSize=
h.capabilities.hires?g.imageSizeLarge||g.imageSize:g.imageSize;c=!1;d="medium";gb.utils.isTablet()&&(c=!0,d="mini");e.isTabletButton=c;e.buttonContainerSpacing=d;return gb.resources.deviceInfo.isPhone?this._addMobileReffedDetailURL(this._addMetricsData(e)):this._addMetricsData(e)},getDealOptionsTemplateData:function(a){var b={},c=a.widgetView.widgetID,d=gb.configManager.getWidgetViewConfig(c),e=gb.utils.isShowPercentageOffEnabled();c&&d.supportWatch&&a.deal.isDealWatched&&(b.StopWatching=gb.enums.BottomSheetActions.StopWatching);
return{widgetID:c,position:a.position,deal:a.deal,dealAction:b,showPercentOff:e}},getMiniDPViewTemplateData:function(a,b,c){var d=a.deal;if(d.dealState===gb.enums.DealStates.LOADING)return{};var e=a.widgetView,g=gb.configManager.getWidgetViewConfig(e.widgetID),l=gb.configManager.getDealViewConfig(e.widgetID),n=null;if(d.dealType===gb.enums.DealTypes.COUPON||d.dealType===gb.enums.DealTypes.LOCAL)n=d.detail.marketingMessage,d.dealType===gb.enums.DealTypes.COUPON&&(n=n+" "+gb.resources.getString("gb_coupon"));
var f=gb.controller.watchDealView?gb.controller.watchDealView._isPopupTriggerRequiredForMiniDP(e):!1,g={widgetID:e.widgetID,widgetGroupID:e.widgetGroupID,deal:d,dealViewConfig:l,widgetViewConfig:g,position:a.position,viewIDs:gb.enums.dealViewIDs,totalDeals:gb.metadata.selectedDealsCount[e.widgetID],orientation:e.viewOrientation,marketingMessage:n,isPrimeEarly:d.detail.isPrimeEarlyAccessDeal,isPrimeOnly:d.detail.isPrimeOnly,isMiniDP:!0,isPopupTriggerRequired:f};g.showPercentOff=gb.utils.isShowPercentageOffEnabled();
g.priceText=gb.utils.getPriceTextForBasisKind(d.pricingData.bKind);g.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(d,e.widgetID);d.detail.itemType===gb.enums.ItemTypes.VARIATION?(g.asin=c,g.dimensionData=this._findDimensionData(d),g.selectedDimension=a.variationView.selectedDimension,g.unavailableAsinSelected=a.variationView.unavailableAsinSelected,g.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(a,c),this._setMiniDPAsinViewTimerData(a,c,g,b.id),g.priceText=c?gb.utils.getPriceTextForBasisKind(c.bKind):
gb.utils.getPriceTextForBasisKind(d.pricingData.bKind)):(g.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(d,e.widgetID),this._setMiniDetailPageViewTimerData(a,g,b.id));return gb.resources.deviceInfo.isPhone?this._addMobileReffedDetailURL(this._addMetricsData(g)):this._addMetricsData(g)},getDealStateTemplateData:function(a,b,c){var d=a.deal,e=a.widgetView,g=gb.configManager.getWidgetViewConfig(e.widgetID),l=gb.configManager.getDealViewConfig(e.widgetID),n=gb.enums.dealViewIDs,f=!1,h=!1,
k=gb.resources.getCustomerData("realm"),r=!1;if(k===gb.enums.Realms.JP||k===gb.enums.Realms.CN)h=!0;d.dealType===gb.enums.DealTypes.LD&&gb.controller.schedulingParams[e.widgetID].fetchWatchedDeals&&(r=!0,d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS||d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)&&(r=!1);"function"===typeof e._isDoubleCell&&(f=e._isDoubleCell(d.dealID));if(d.dealState===gb.enums.DealStates.LOADING)return{};
b={widgetID:e.widgetID,widgetGroupID:e.widgetGroupID,deal:d,dealViewConfig:l,widgetViewConfig:g,position:a.position,viewIDs:n,elements:b,totalDeals:gb.metadata.selectedDealsCount[e.widgetID],orientation:e.viewOrientation,isDoubleCell:f,isPrimeEarly:d.detail.isPrimeEarlyAccessDeal,isPrimeOnly:d.detail.isPrimeOnly,showCouponCount:h,isWatchDeal:r};b.showPercentOff=gb.utils.isShowPercentageOffEnabled();b.priceText=gb.utils.getPriceTextForBasisKind(d.pricingData.bKind);d.detail.itemType===gb.enums.ItemTypes.VARIATION?
(g=gb.controller.getDealDAO(a.dealID),b.asin=c,b.dimensionData=this._findDimensionData(g),b.modalFirstLoad=a.variationView?a.variationView.modalFirstLoad:!1,b.selectedDimension=a.variationView?a.variationView.selectedDimension:{},b.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(a,c),b.unavailableAsinSelected=a.variationView?a.variationView.unavailableAsinSelected:!1,b.priceText=c?gb.utils.getPriceTextForBasisKind(c.bKind):gb.utils.getPriceTextForBasisKind(d.pricingData.bKind)):
b.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(d,e.widgetID);b.cellCount=gb.metadata.getSortedDealIDs(e.widgetID).length;b.customerRefTag=gb.service.customerID?gb.metrics.refTags.recLearnMore:gb.metrics.refTags.unrecLearnMore;return gb.resources.deviceInfo.isPhone?this._addMobileReffedDetailURL(this._addMetricsData(b)):this._addMetricsData(b)},getFilterViewTemplateData:function(a){return{actionNameTileSelected:gb.enums.WidgetActions.Faceout.TILE_SELECTED,attributes:a.attributes,attrPriority:gb.filterController.models[a.widgetView.widgetGroupID].filterAttrituesByPriority,
eventID:a.widgetView.widgetGroupID,filterType:a.type,filterOptions:a.filterOptions,filterConfig:a.filterConfig,maxTilesPerPage:gb.configManager.getWidgetViewConfig(a.widgetView.widgetID).maxTilesPerPage,tileWidth:a.widgetView.tileWidthAsPercentage,title:a.title,view:a,viewIDs:gb.enums.WidgetViewIDs,widgetID:a.widgetView.widgetID,widgetName:a.widgetView.widgetName}},getAdRowViewData:function(a){return{nextAdSlotToRenderIndex:a.nextAdSlotToRenderIndex,adSlots:gb.controller.schedulingParams[a.widgetID].adSlots,
widgetID:a.widgetID}},getMashRefineData:function(a){for(var b=this.getRefineTemplateData(a,!0).categoryData,c=[],d=0;d<b.length;d++)c.push(b[d].text);return{title:gb.controller.schedulingParams[a.widgetID].title,buttonTitles:c,cancelButtonTitle:gb.resources.getString("csld-cancel"),successCallback:function(c){c<b.length&&gb.controller.trigger("WidgetCategoryChange",a.widgetID,b[c].nodeId)}}},getPaginationTemplateData:function(a){var b=gb.controller.widgetCurrentPage[a.widgetID]||1,c=gb.metadata.getAllDisplayableDealIDs(a.widgetID).length,
c=Math.ceil(c/gb.controller.schedulingParams[a.widgetID].pageSize);return{widgetID:a.widgetID,widgetName:a.widgetName,filterOptions:[{attribute:gb.enums.BinningParams.PAGE.key,currentPage:b,totalPages:c,dummyUrls:gb.enums.PaginationDummyURLs,minimalPagination:gb.configManager.getWidgetViewConfig(a.widgetID).minimalPagination}]}},_setDealViewTimerData:function(a,b,c){var d=a.deal,e=a.widgetView,g=c?c.status.dates.incartEnds:d.status.dates.incartEnds,l=gb.utils.getDealViewID(e.widgetID,a.position),
n=l+gb.enums.dealViewIDs.DEALCLOCK,f=g?!0:!1,h=c?c.status.dates.pendingATCEnds:d.status.dates.pendingATCEnds;c=gb.resources.customerData.hasEarlyAccessBenefit;var r=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer,p=gb.configManager.getWidgetViewConfig(e.widgetID).avoidContextBasedTimer;if(f||h)f?(a.incartClock&&(k.clearTimeout(a.incartClock.timeout),a.incartClock=null),n=l+gb.enums.dealViewIDs.INCARTCLOCK,a.incartClock=gb.utils.heroTimer(g,a.viewElement,n,!0),b.incartTimeString=
a.incartClock.timeString):h&&(a.pendingAtcClock&&(k.clearTimeout(a.pendingAtcClock.timeout),a.pendingAtcClock=null),n=l+gb.enums.dealViewIDs.PENDINGATCCLOCK,a.pendingAtcClock=gb.utils.heroTimer(h,a.viewElement,n,!0),b.pendingatcTimeString=a.pendingAtcClock.timeString),e.widgetName!==gb.enums.WidgetNames.PC_SUPPLE||gb.controller.schedulingParams[e.widgetID].showShortCellView||this._genericEndDateTimerGenerator(a,b);else{l=(new Date).getTime();b.timerTextColor="base";if(d.dealState===gb.enums.DealStates.AVAILABLE||
d.dealState===gb.enums.DealStates.WAITLIST||d.dealState===gb.enums.DealStates.WAITLISTFULL)gb.utils.isDealInEarlyAccessWindow(d)?d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||c?d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS?(a.clock=gb.utils.heroTimer(d.status.dates.startForNonPrimeCustomer,a.viewElement,n,r),b.timeString=a.clock.timeString,b.timerPrefix=gb.resources.getString("gb_starts_in"),b.isEarlyAccessTimer=!p,b.timerTextColor="success"):this._genericEndDateTimerGenerator(a,
b):(a.clock=gb.utils.heroTimer(d.status.dates.startForNonPrimeCustomer,a.viewElement,n,r),b.timeString=a.clock.timeString,b.timerPrefix=p?gb.resources.getString("gb_starts_in"):gb.resources.getString("gb_starts_for_you_in"),b.isEarlyAccessTimer=!p,b.timerTextColor="success"):this._genericEndDateTimerGenerator(a,b);else if(d.dealState===gb.enums.DealStates.UPCOMING)if(g=e=d.status.dates.start,d.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS?(b.isEarlyAccessTimer=!p,c||(e=new Date(e.getTime()+
d.detail.accessDurationInMs))):d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&(b.isEarlyAccessTimer=!p,e=new Date(e.getTime()+d.detail.accessDurationInMs)),l=e.getTime()-l,864E5<l)b.showDateOrTime=gb.utils.formatDate(e),b.timerPrefix=gb.resources.getString("gb_starts");else if(36E5<l){if(b.showDateOrTime=gb.utils.formatTime(e.getHours(),e.getMinutes()),b.timerPrefix=gb.resources.getString("gb_starts_at"),b.isEarlyAccessTimer&&!p&&(b.timerPrefix=c?gb.resources.getString("gb_starts_for_prime_at"):
gb.resources.getString("gb_starts_for_you_at")),d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||c||(b.primeTimeString=gb.utils.formatTime(g.getHours(),g.getMinutes()),b.primeTimerPrefix=gb.resources.getString("gb_starts_for_prime_at")),d.detail.isPrimeOnly&&!p&&(b.timerPrefix=gb.resources.getString("gb_starts_for_prime_at")),d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS||d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)b.timerPrefix=gb.resources.getString("gb_starts_at")}else if(a.clock=
gb.utils.heroTimer(e,a.viewElement,n,r),b.timeString=a.clock.timeString,b.timerTextColor="success",b.timerPrefix=gb.resources.getString("gb_starts_in"),b.isEarlyAccessTimer&&!p&&(b.timerPrefix=c?gb.resources.getString("gb_starts_for_prime_in"):gb.resources.getString("gb_starts_for_you_in")),d.detail.isPrimeOnly&&!p&&(b.timerPrefix=gb.resources.getString("gb_starts_for_prime_in")),d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||c||(b.primeTimeString=gb.utils.formatTime(g.getHours(),
g.getMinutes()),b.primeTimerPrefix=gb.resources.getString("gb_starts_for_prime_at")),d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD||d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS)b.timerPrefix=gb.resources.getString("gb_starts_in");a=gb.resources.getCustomerData("realm")!==gb.enums.Realms.IN&&(b.isEarlyAccessTimer&&c||d.detail.isPrimeOnly&&d.dealState===gb.enums.DealStates.UPCOMING);b.addLineBreak=a}},_setMiniDetailPageViewTimerData:function(a,b,c){a.modalClock&&(k.clearTimeout(a.modalClock.timeout),
a.modalClock=null);var d=a.deal,e=a.widgetView,g=d.status.dates.incartEnds,l=gb.utils.getDealViewID(e.widgetID,a.position),n=l+gb.enums.dealViewIDs.DEALCLOCK,f=gb.enums.WidgetViewIDs.MINI_DP_MODAL+n,h=d.status.dates.pendingATCEnds,r=gb.resources.customerData.hasEarlyAccessBenefit,p=d.dealType===gb.enums.DealTypes.LD&&d.detail.itemType!==gb.enums.ItemTypes.SINGLE,e=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer,q=gb.enums.WidgetViewIDs.A_POPOVER+c;!g&&!h||p?(g=(new Date).getTime(),
d.dealState===gb.enums.DealStates.AVAILABLE||d.dealState===gb.enums.DealStates.WAITLIST||d.dealState===gb.enums.DealStates.WAITLISTFULL?(gb.utils.isDealInEarlyAccessWindow(d)&&!r&&this._setMiniDPPrimeTimerData(a,b,q),this._genericEndDateTimerGenerator(a,b,c)):d.dealState===gb.enums.DealStates.UPCOMING&&(n=d.status.dates.start,d.detail.accessType?this._setMiniDPPrimeTimerData(a,b,q):(d=n.getTime()-g,864E5<d?(b.showDateOrTime=gb.utils.formatDate(n),b.timerPrefix=gb.resources.getString("gb_deal_starts")):
36E5<d?(b.showDateOrTime=gb.utils.formatTime(n.getHours(),n.getMinutes()),b.timerPrefix=gb.resources.getString("gb_deal_starts_at")):(a.modalClock=gb.utils.heroTimer(n,q,f,e),b.timeString=a.modalClock.timeString,b.timerPrefix=gb.resources.getString("gb_deal_starts_in"))))):(g?(a.modalIncartClock&&(k.clearTimeout(a.modalIncartClock.timeout),a.modalIncartClock=null),f=gb.enums.WidgetViewIDs.MINI_DP_MODAL+l+gb.enums.dealViewIDs.INCARTCLOCK,a.modalIncartClock=gb.utils.heroTimer(g,q,f,!0),b.modalIncartTimeString=
a.modalIncartClock.timeString):h&&(a.modalPendingAtcClock&&(k.clearTimeout(a.modalPendingAtcClock.timeout),a.modalPendingAtcClock=null),f=gb.enums.WidgetViewIDs.MINI_DP_MODAL+l+gb.enums.dealViewIDs.PENDINGATCCLOCK,a.modalPendingAtcClock=gb.utils.heroTimer(h,q,f,!0),b.modalPendingatcTimeString=a.modalPendingAtcClock.timeString),c=d.status.dates.end,g=(new Date).getTime(),r=c.getTime()-g,f=gb.enums.WidgetViewIDs.MINI_DP_MODAL+n,864E5<r?(b.showDateOrTime=gb.utils.formatDate(c),b.timerPrefix=gb.resources.getString("gb_ends")):
d.dealType===gb.enums.DealTypes.BD&&36E5<r?(b.showDateOrTime=gb.utils.formatTime(c.getHours(),c.getMinutes()),b.timerPrefix=gb.resources.getString("gb_ends_at")):(a.modalClock=gb.utils.heroTimer(c,q,f,e),b.timeString=a.modalClock.timeString,b.timerPrefix=gb.resources.getString("gb_ends_in")))},_setMiniDPPrimeTimerData:function(a,b,c){a.modalPrimeClock&&(k.clearTimeout(a.modalPrimeClock.timeout),a.modalPrimeClock=null);var d=a.deal,e=a.widgetView,g=gb.resources.customerData.hasEarlyAccessBenefit,l=
gb.enums.WidgetViewIDs.MINI_DP_MODAL+gb.enums.WidgetViewIDs.PRIME+gb.utils.getDealViewID(e.widgetID,a.position)+gb.enums.dealViewIDs.DEALCLOCK;gb.utils.getDealViewID(e.widgetID,a.position);e=(new Date).getTime();if(d.dealState===gb.enums.DealStates.UPCOMING){var n=d.status.dates.start;g||(n=new Date(n.getTime()+d.detail.accessDurationInMs));36E5<n.getTime()-e?(b.modalPrimeTimerPrefix=g?gb.resources.getString("gb_deal_starts_for_prime_at"):gb.resources.getString("gb_deal_starts_for_you_at"),d.detail.isPrimeOnly&&
(b.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_at")),b.modalPrimeShowDateOrTime=gb.utils.formatTime(n.getHours(),n.getMinutes())):(a.modalPrimeClock=gb.utils.heroTimer(n,c,l,!0),b.modalPrimeTimeString=a.modalPrimeClock.timeString,b.modalPrimeTimerPrefix=g?gb.resources.getString("gb_deal_starts_for_prime_in"):gb.resources.getString("gb_deal_starts_for_you_in"),d.detail.isPrimeOnly&&(b.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_in")))}else a.modalPrimeClock=gb.utils.heroTimer(d.status.dates.startForNonPrimeCustomer,
c,l,!0),b.modalPrimeTimeString=a.modalPrimeClock.timeString,b.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_for_you_in")},_setMiniDPAsinViewTimerData:function(a,b,c,d){a.modalClock&&(k.clearTimeout(a.modalClock.timeout),a.modalClock=null);var e=a.deal;if(b){var g=b.status,l=a.widgetView,n=b.status.dates.incartEnds,f=gb.utils.getDealViewID(l.widgetID,a.position),h=gb.enums.WidgetViewIDs.MINI_DP_MODAL+(f+gb.enums.dealViewIDs.DEALCLOCK);b=b.status.dates.pendingATCEnds;h=gb.resources.customerData.hasEarlyAccessBenefit;
gb.configManager.getWidgetViewConfig(l.widgetID);l=gb.enums.WidgetViewIDs.A_POPOVER+d;if(n||b)n?(a.modalIncartClock&&(k.clearTimeout(a.modalIncartClock.timeout),a.modalIncartClock=null),h=gb.enums.WidgetViewIDs.MINI_DP_MODAL+f+gb.enums.dealViewIDs.INCARTCLOCK,a.modalIncartClock=gb.utils.heroTimer(n,l,h,!0),c.modalIncartTimeString=a.modalIncartClock.timeString):b&&(a.modalPendingAtcClock&&(k.clearTimeout(a.modalPendingAtcClock.timeout),a.modalPendingAtcClock=null),h=gb.enums.WidgetViewIDs.MINI_DP_MODAL+
f+gb.enums.dealViewIDs.PENDINGATCCLOCK,a.modalPendingAtcClock=gb.utils.heroTimer(b,l,h,!0),c.modalPendingatcTimeString=a.modalPendingAtcClock.timeString),this._genericEndDateTimerGenerator(a,c,d);else if((new Date).getTime(),g.itemState===gb.enums.DealStates.AVAILABLE||g.itemState===gb.enums.DealStates.WAITLIST||g.itemState===gb.enums.DealStates.WAITLISTFULL)gb.utils.isDealInEarlyAccessWindow(e)&&!h&&this._setMiniDPPrimeTimerData(a,c,l),this._genericEndDateTimerGenerator(a,c,d)}else this._setMiniDetailPageViewTimerData(a,
c,d)},_genericEndDateTimerGenerator:function(a,b,c){var d=(new Date).getTime(),e=a.widgetView,g=a.deal.status.dates.end,d=g.getTime()-d,l=gb.utils.getDealViewID(e.widgetID,a.position)+gb.enums.dealViewIDs.DEALCLOCK,e=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer;b.timerTextColor="base";864E5<d?(b.showDateOrTime=gb.utils.formatDate(g),b.timerPrefix=gb.resources.getString("gb_ends")):a.deal.dealType===gb.enums.DealTypes.BD&&36E5<d?(b.showDateOrTime=gb.utils.formatTime(g.getHours(),
g.getMinutes()),b.timerPrefix=gb.resources.getString("gb_ends_at")):(c?(e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+l,c=gb.enums.WidgetViewIDs.A_POPOVER+c,a.modalClock&&(k.clearTimeout(a.modalClock.timeout),a.modalClock=null),a.modalClock=gb.utils.heroTimer(g,c,e,!0),b.timeString=a.modalClock.timeString):(a.clock&&(k.clearTimeout(a.clock.timeout),a.clock=null),a.clock=gb.utils.heroTimer(g,a.viewElement,l,e),b.timeString=a.clock.timeString),b.timerPrefix=gb.resources.getString("gb_ends_in"),36E5>=d&&(b.timerTextColor=
"success"))},_addRedirectDetails:function(a,b,c){a=a||gb.resources.getString("gb_see_all_deals");var d=b===gb.enums.MiscLinks.LOCAL_URL?gb.metrics.refTags.seeAllLocalDeals:gb.metrics.refTags.seeAllDeals;c&&(b=c.getReffedURL(b,d),c.seeAllText=a,c.redirectLink=b);return c},getLaunchCellTemplateData:function(a){var b=gb.controller.schedulingParams[a.widgetID];a={widgetView:a,widgetID:a.widgetID,schedulingParams:b};a=this._addMetricsData(a);return a=this._addRedirectDetails(b.redirectText,b.redirectLink,
a)},getShovelerLaunchCellTemplateData:function(a){var b=gb.controller.schedulingParams[a.widgetID],c=b.widgetTabConfig[b.widgetCurrentTab];a={widgetView:a,widgetID:a.widgetID,schedulingParams:b,cssClasses:"gridColumn"+a.dealsPerRow};a=this._addMetricsData(a);return a=this._addRedirectDetails(c.redirectText,c.redirectLink,a)},getSuppleWidgetViewTemplateData:function(a,b){var c=gb.controller.schedulingParams[a.widgetID],d=gb.enums.WidgetViewIDs,e=gb.configManager.getDealViewConfig(a.widgetID),g=a.dealsPerRow,
l=gb.watcher.lowestDealIDWatchedIndex[a.widgetID]+1,n=l;if(c.enforceLimitedDeals&&c.showDoubleCellDOTD)var f=gb.metadata.getAllDisplayableDealIDs(a.widgetID),f=gb.metadata.getDOTDCount(f),n=n+f;c.enforceLimitedDeals&&c.showLaunchCell&&gb.widgetHelper&&gb.widgetHelper.shouldReduceDeals[a.widgetID]&&0===n%a.dealsPerRow&&l--;n=Math.ceil(l/c.pageSize);if(c.enforceLimitedDeals||c.enablePagination)n=1;var f=b?1:gb.controller.widgetCurrentPage[a.widgetID],h=gb.enums.Constants.MAX_SUPPLE_DEALS_TO_DISPLAY;
c.pageSize&&(h=c.pageSize);var k=gb.utils.getFilterViewIDs(c.filterConfig),r=a.isLeftFilterRequired,p="",q="";c.disableRestrictionsApply||(p=gb.resources.getString("gb-restrictions-apply"),q=c.customRestrictionsApply||gb.resources.getString("csld-restrictions_link"));var t=c.redirectText||gb.resources.getString("gb_see_all_deals"),e={widgetView:a,schedulingParams:c,widgetID:a.widgetID,widgetGroupID:a.widgetGroupID,viewIDs:d,filterViewIDs:k,totalDeals:gb.metadata.selectedDealsCount[a.widgetID],totalDealsToShowCount:gb.controller.totalDealsToShow[a.widgetID],
orientation:a.viewOrientation,dealViewCount:a.nextPositionToRender,dealViewConfig:e,firstPage:f,columnCount:g,dealCount:l,pagesToDraw:n,pageSize:h,seeAllText:t,restrictionsApplyText:p,restrictionsApplyLink:q,title:c.title,isLeftFilterRequired:r},d=this._getNoDealsMessage(a);e.noDealsMessage=d.message;e.isFiltersSelected=d.isFiltersSelected;e.isGDMFailing=a.isGDMFailing;e.isRetryInProgress=a.isRetryInProgress;e=this._addMetricsData(e);c.titleRedirectLink&&(e=this._addRedirectDetails(c.titleRedirectText,
c.titleRedirectLink,e));return e},getShovelerWidgetViewTemplateData:function(a){var b=gb.controller.schedulingParams[a.widgetID],c=gb.enums.WidgetViewIDs,d=!1,e,g=gb.metadata.selectedDealsCount[a.widgetID],l=a.dealsPerRow||b.pageSize;b.pageSize=l;!b.enableFilter||b.widgetTabConfig[b.widgetCurrentTab].watchedDealsTab?d=!0:(e=gb.utils.getFilterViewIDs(b.filterConfig)[gb.enums.BinNames.CATEGORIES],d=!1);var n,f=b.widgetTabConfig[b.widgetCurrentTab];n=f&&f.launchCellIndex?Math.ceil((g+1)/l):Math.ceil(g/
l);var h=gb.controller.widgetCurrentPage[a.widgetID];n&&h>n&&(h=n);gb.controller.widgetCurrentPage[a.widgetID]=h;var k=0;g&&(k=Math.min(l,g-(h-1)*l));var r=l="";b.disableRestrictionsApply||(l=gb.resources.getString("gb-restrictions-apply"),r=b.customRestrictionsApply||gb.resources.getString("csld-restrictions_link"));c={actionName:gb.enums.WidgetActions.Shoveler.SHOVEL,currentPage:h,disableFilter:d,filterDomID:e,lastDealIDPosition:k,restrictionsApplyText:l,restrictionsApplyLink:r,schedulingParams:b,
title:b.title,totalDeals:g,totalPages:n,viewIDs:c,widgetID:a.widgetID,widgetGroupID:a.widgetGroupID};b=this._getNoDealsMessage(a);c.noDealsMessage=b.message;c.isGDMFailing=a.isGDMFailing;c.isRetryInProgress=a.isRetryInProgress;c.gridColumnCSS="gridColumn"+a.dealsPerRow;c=this._addMetricsData(c);f&&f.titleRedirectText&&(c=this._addRedirectDetails(f.titleRedirectText,f.titleRedirectLink,c));return c},_findDimensionData:function(a){var b={};f.each(a.items,function(a){f.each(a.variationDimensions,function(a,
c){b[c]||(b[c]=[]);b[c].push(a);b[c]=f.unique(b[c])})});return b},getCartErrorDisplayData:function(){var a=gb.resources.getString("gb-cart-error-header"),b=gb.resources.getString("gb-cart-error");return{errorAlertHeaderText:a,errorText:b}},getBottomSheetFilterContentExpanderData:function(a,b){return{view:a,filterOptions:a.filterJSONData,isSortFilter:b.isSortFilter,schedulingParams:gb.controller.schedulingParams[a.widgetID]}},getBottomSheetFilterContentData:function(a){return{view:a,filterOptionList:a.filterOptions,
currentSelection:a.widgetView.filterJSONData[a.filterConfig.attr].currentSelection,attribute:a.filterConfig.attr}},getBottomSheetFilterHeaderData:function(a,b){return{title:b.title,widgetView:a.widgetView?a.widgetView:a,selectedOption:a.filterConfig?a.widgetView.filterJSONData[a.filterConfig.attr].currentSelection:"",showClearOption:b.showClearOption,enableBack:b.enableBack}},getBottomSheetFilterFooterData:function(){return{text:gb.resources.getString("csld-cancel")}},_getNoDealsMessage:function(a){var b,
c,d=gb.controller.schedulingParams[a.widgetID];if(d.watchedDealsWidget||gb.utils.isWatchedDealsTab(a.widgetID))gb.metadata.watchedDeals.ALL&&0!==gb.metadata.watchedDeals.ALL.length||(gb.clientName===gb.enums.MobileClients.PC?b=gb.resources.getString("gb_no_watched_deals_punting_message",{watchDeal:"<b>"+gb.resources.getString("gb_watch_deal")+"</b>"}):gb.configManager.getWidgetViewConfig(a.widgetID).showNoWatchedDealsMessg&&(b=gb.resources.getString("gb_no_watched_deals_to_show",{watchDeal:"<b>"+
gb.resources.getString("gb_watch_deal")+".</b>"})));else if(f.isEmpty(gb.metadata.getAllDisplayableDealIDs(a.widgetID))){var e=0;if(a.widgetGroupID){var g=gb.filterController.models[a.widgetGroupID].attributesList,e=gb.filterController.models[a.widgetGroupID].getSelectedFilterCount();-1!==g.indexOf(gb.enums.BinningParams.SORT_ORDER.key)&&e--; -1!==g.indexOf(gb.enums.BinningParams.PAGE.key)&&e--}e?(b=d.noDealsFilterMessage||gb.resources.getString("gb_no_active_deals_on_filters"),c=!0):gb.widgetHelper&&
"undefined"!==typeof gb.widgetHelper.callID[a.widgetID]&&gb.widgetHelper.callID[a.widgetID]!==gb.widgetHelper.callDataArray[a.widgetID].length||(b=d.noDealsMessage||gb.resources.getString("gb_no_results_to_show"))}return{message:b,isFiltersSelected:c}},_getCurrentCategory:function(a){var b=gb.enums.CategoryFilters.ALL;if(gb.controller.isPaginatedMetadataCall(a)){a=gb.widgets[a].widgetGroupID;if(!a)return;a=gb.filterController.models[a].getSelectedFilters(!1,[gb.enums.DCSQueryParams.CATEGORIES,gb.enums.DCSQueryParams.PRIME_ACCESS_TYPE]);
a.enforcedCategories?b=a.enforcedCategories[0]:a.primeAccessType&&(b=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS)}else b=gb.controller.widgetCurrentCategory[a];return b},_getCurrentStates:function(a){var b=gb.enums.DealStates.AVAILABLE;if(gb.controller.isPaginatedMetadataCall(a)){a=gb.widgets[a].widgetGroupID;if(!a)return;a=gb.filterController.models[a].getSelectedFilters(!1,[gb.enums.DCSQueryParams.DEAL_STATE]);a.dealStates&&(b=a.dealStates);"object"===typeof b&&(b=gb.enums.DealStatesToFilterStates[b[0]])}else b=
gb.controller.widgetCurrentStatus[a];b&&(b=b.toLowerCase());return b}})});p.when("A","GoldboxMobile3PAssets").register("gb-share-manager",function(h,k){var f=k._;return h.createClass({_CONSTANTS:{ShareStringPrefix:"gb-share",ShareHTMLTemplatePostfix:"Share",SharePlatforms:{MOBILE_APP:"appMobile",TABLET_APP:"appTablet",AW:"aw",PC:"pc"},StringElements:["redirectURL","subject"],ShareCallbackFns:{appMobile:"_mashShareDeal",appTablet:"_placeHolderPlatformShare",aw:"_placeHolderPlatformShare",pc:"_placeHolderPlatformShare"},
ShareRedirectRefPrefix:"gb_share_"},sharePlatform:null,supportsDeepLinking:!1,shareHTMLTemplateName:null,_shareToPlatform:null,shareRedirectRef:null,_setSharePlatform:function(){var a=gb.resources.deviceInfo.isPhone,b=gb.resources.deviceInfo.isApp,c=this._CONSTANTS.SharePlatforms;this.sharePlatform=c.PC;if(a)if(b){if(this.sharePlatform=c.MOBILE_APP,gb.resources.deviceInfo.isAndroid||gb.resources.deviceInfo.isIOS)this.supportsDeepLinking=!0}else this.sharePlatform=c.AW;else b&&(this.sharePlatform=
c.TABLET_APP)},_setShareHTMLTemplateName:function(){this.shareHTMLTemplateName=this.sharePlatform+this._CONSTANTS.ShareHTMLTemplatePostfix},_setShareRedirectRef:function(){this.shareRedirectRef=this._CONSTANTS.ShareRedirectRefPrefix+this.sharePlatform},init:function(){this._setSharePlatform();this._setShareHTMLTemplateName();this._setShareRedirectRef();this._shareToPlatform=this[this._CONSTANTS.ShareCallbackFns[this.sharePlatform]]},_getShareString:function(a,b,c){if(!a||!b||!f.contains(this._CONSTANTS.StringElements,
a))return"";a=[this._CONSTANTS.ShareStringPrefix,this.sharePlatform,a,b.toLowerCase()].join("_");return c?gb.resources.getString(a,c):gb.resources.getString(a)},_getShareHTML:function(a,b){return gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:gb.templateManager.TemplateGroups.DEAL_SHARE,templateName:this.shareHTMLTemplateName,data:b})},_getMashShareParams:function(a,b){var c=gb.configManager.getDealViewConfig(a),d=b.dealType,e=b.dealID,g=b.detail.title,l={ref:this.shareRedirectRef,dealID:b.dealID,
asin:b.detail.impressionAsin},n=gb.resources.getString("gb-share-defaultRedirect",l),f=n;this.supportsDeepLinking&&(f=this._getShareString("redirectURL",d,l));l=gb.resources.getImage("goldbox_upcoming");b.detail.imageAsin&&(l=b.detail.imageAsin);b.dealState!==gb.enums.DealStates.UPCOMING&&b.dealState!==gb.enums.DealStates.COMINGSOON||!b.teaser.teaserImage||(l=b.teaser.teaserImage);l=gb.utils.resizeImage(l,c.shareImageSize);c=this._getShareString("subject",d);d={redirectURL:f,imageURL:l,viewTitle:c,
dealTitle:g};b.merchantID&&b.merchantID!==gb.resources.customerData.amznMerchantID&&b.merchantName&&(d.merchantName=b.merchantName);if(b.pricingData.prices.dealPrice&&!b.auxiliaryData.breaksMAP){var h=b.pricingData.prices.dealPrice.min.formattedValue;b.pricingData.prices.dealPrice.min.value!==b.pricingData.prices.dealPrice.max.value&&(h+=" - "+b.pricingData.prices.dealPrice.max.formattedValue);d.dealPrice=h;gb.utils.showPPU(e)&&(d.ppuValue=gb.resources.getString("gb_ppu_price",{price:b.pricingData.unitPrice.formattedValue,
unitValue:b.pricingData.baseUnit.value,unitName:b.pricingData.baseUnit.name}));b.pricingData.percentOff&&(e=b.pricingData.prices.basisPrice.min.formattedValue,d.basisPriceText=gb.utils.getPriceTextForBasisKind(b.pricingData.bKind),d.basisPrice=e,d.percentOff=gb.resources.getString("csld-percent_off",{discountPercentage:b.pricingData.percentOff}))}b.detail.isPrimeEarlyAccessDeal&&(d.primeMessaging=gb.resources.getString("gb_m_prime_early_access_deal"));b.detail.isPrimeOnly&&(d.primeMessaging=gb.resources.getString("gb_m_prime_exclusive"));
this.supportsDeepLinking&&(d.platformText=gb.resources.getString("gb-sent-using"),gb.resources.deviceInfo.isAndroid?(d.platformURL=gb.resources.getString("gb-android-app-url"),d.platformName=gb.resources.getString("gb-android-name")):(d.platformURL=gb.resources.getString("gb-ios-app-url"),d.platformName=gb.resources.getString("gb-iphone-name")));n=n+" "+g;f=f+" "+g;return{subject:c+" "+g,messagePlain160:n.substring(0,160),messagePlain140:n.substring(0,140),messageHTML:this._getShareHTML(a,d),messagePlain:f,
imageURL:l}},_mashShareDeal:function(a,b){var c=this._getMashShareParams(a,b);p.when("mash").execute(function(a){a.share(c)})},_placeHolderPlatformShare:function(a,b){},shareDeal:function(a,b){if(a&&b){var c=gb.controller.getDealDAO(b);c&&this._shareToPlatform(a,c)}}})});p.when("A","GoldboxMobile3PAssets","gb-variation-view").register("gb-deal-view",function(h,r,f){return h.createClass({init:function(a){this.widgetView=a.widgetView;this.position=a.position;this.viewElementID="#"+gb.utils.getDealViewID(this.widgetView.widgetID,
this.position);this.viewElement=this.widgetView.skinDomElement.find(this.viewElementID);this.viewOrientation=this.widgetView.viewOrientation;this.dealID=a.dealID;this.isDoubleCell=a.isDoubleCell;this.row=a.row;this.column=a.column;this.deal=gb.controller.getDealDAO(this.dealID);this.modalClock=this.clock=this.truncatedShipSoldInfo=this.truncatedTitle=this.viewSkin=null},render:function(){if(!gb.controller.buyingDeals[this.dealID]){var a=this.widgetView.widgetID,b=gb.configManager.getWidgetViewConfig(a),
c=b.useCssEllipsification;if(this.viewOrientation!==this.widgetView.viewOrientation){this.truncatedTitle=null;var d=this.deal.detail;d.truncatedDescription=null;d.restDescription=null}this.viewOrientation=this.widgetView.viewOrientation;this.clock&&k.clearTimeout(this.clock.timeout);this.modalClock&&k.clearTimeout(this.modalClock.timeout);this.deal.detail.itemType===gb.enums.ItemTypes.VARIATION&&gb.widgets[a].widgetName===gb.enums.WidgetNames.ML_HERO?(this.variationView=this.variationView||new f({dealID:this.deal.dealID,
widgetView:this.widgetView,isMiniDP:!1,position:this.position,dealView:this}),this.variationView.render()):(this.viewSkin=this._generateStateHTMLFromViewSubTemplates(),this.viewElement.html(this.viewSkin));this.renderTitle(c);this.renderDescription();this._renderShipSold();this._handleDealActions(b);b=gb.controller.schedulingParams[a];gb.utils.isTouchDevice()&&b.showShortCellView&&(this.viewElement.find(".restVisible").remove(),this.viewElement.find(".hoverVisible").css("display","block"));this.updateOptionsHTML();
!gb.resources.deviceInfo.isCSS3Supported&&gb.configManager.getWidgetViewConfig(a).applyDealRowHeight&&(b=0===this.position%2?this.position+1:this.position-1,gb.utils.setDealViewHeightToOriginal(a,this.position),gb.utils.setDealViewHeightToOriginal(a,b),c=this.viewElement.closest("."+gb.enums.WidgetViewIDs.CONTENTROW),c.height(""),c.height(c.height()),gb.utils.setDealViewHeightToDealRowHeight(a,this.position),gb.utils.setDealViewHeightToDealRowHeight(a,b));this.renderEldaradoUtil();gb.metricsManager.recordRender(a,
this.dealID,this.position)}},_generateStateHTMLFromViewSubTemplates:function(a){var b=this.widgetView.widgetID,c=gb.utils.getStateTemplateName(this.deal.dealState,this.deal.dealType),d=gb.utils.getViewTemplatesForState(this.deal),e=gb.configManager.getWidgetViewConfig(b);a=a||{};var g=a.stateTemplateGroup||gb.templateManager.TemplateGroups.DEAL_STATE,l=a.viewTemplateGroup||gb.templateManager.TemplateGroups.DEAL_VIEW,n=a.viewTemplateData||gb.viewComponentBuilder.getDealViewTemplateData(this);n.viewStyleInfo=
gb.utils.getDealViewStyleInformation(this.deal,n,e);var f=this;a=a.stateTemplateDataBuilderFn||function(a){return gb.viewComponentBuilder.getDealStateTemplateData(f,a)};d=gb.templateManager.getWidgetHTML({widgetID:b,templateGroup:l,templateNames:d,data:n});d=a(d);d.viewStyleInfo=gb.utils.getDealViewStyleInformation(this.deal,n,e);b=gb.templateManager.getWidgetHTML({widgetID:b,templateGroup:g,templateName:c,data:d});return b=gb.accessibility.generateDealViewAccessibilityFlow(this,b)},enableOptions:function(a){a=
h.$(a);var b={header:a.find("#"+gb.enums.dealViewIDs.OPT_HEADER),contents:a.find("#"+gb.enums.dealViewIDs.OPT_CONTENT),footer:a.find("#"+gb.enums.dealViewIDs.OPT_FOOTER)};this.viewElement.find(".dealAction").click(function(a){gb.controller.getBottomSheet().render(b);a.stopPropagation();a.preventDefault()})},_handleDealActions:r._.once(function(a){h.declarative("gbdeal-addtocart","click",function(a){a=a.data;var c=a.asin;gb.metricsManager.recordAction(a.widgetID,a.dealID,"ADD_TO_CART",a.position);
gb.controller.dealDAOs[a.dealID].checkingDealStatus=!0;gb.controller.refreshDealView(a.dealID,c);gb.controller.processActionableClick({widgetID:a.widgetID,dealID:a.dealID,dealType:a.dealType,dealState:a.dealState,asin:c,offerID:a.offerID,legacyDealID:a.legacyDealID,quantity:1})});h.declarative("gbdeal-watchdeal",a.enableClickOnlyWatch?"click":"click touchstart",function(a){var c=a.data.dealID,d=a.data.widgetID,e=gb.controller.dealDAOs[c],g=gb.controller.watchDealView,l=k.dealNotifier;!g||e.isDealWatched||
gb.resources.customerData.isWatchDealPopupMarked||(g.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP),gb.watchDealService.modifyPopupStatus({action:gb.enums.SembuActions.SET_COOKIE,type:gb.enums.DataTypes.BOOL,value:1,key:g.key,domain:g.domain}),gb.resources.customerData.isWatchDealPopupMarked=!0,l&&l.watchDealNotifier&&l.watchDealNotifier.registerWatchDeals([]));gb.metricsManager.recordAction(d,c,"WATCH_DEAL",a.data.position);gb.controller.watchDeal(d,c)});gb.clientName===
gb.enums.MobileClients.PC&&h.declarative("gbdeal-watchdeal","mouseenter mouseleave",function(a){var c=a.data.dealID,d=a.data.widgetID,e=gb.controller.dealDAOs[c];if(gb.controller.watchDealView&&e.isDealWatched&&!e.processWatchAction){var g=a.$target.closest("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON+c);gb.controller.watchDealView.triggerMouseEventsOnWatchingDeal(c,g,a.type);p.when("A","a-modal").execute(function(e,n){var f=n.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+c);f&&f.isActive()&&(f.$popover.find("."+
gb.enums.WatchDealViewIDs.MINI_DP_WATCH_BUTTON_MAPPING[gb.widgets[d].widgetName]),gb.controller.watchDealView.triggerMouseEventsOnWatchingDeal(c,g,a.type))})}});h.declarative("gbdeal-joinwaitlist","click",function(a){a=a.data;var c=a.asin;gb.metricsManager.recordAction(a.widgetID,a.dealID,"JOIN_WAITLIST",a.position);gb.controller.dealDAOs[a.dealID].checkingDealStatus=!0;gb.controller.refreshDealView(a.dealID,c);gb.controller.processActionableClick({widgetID:a.widgetID,dealID:a.dealID,dealType:a.dealType,
dealState:a.dealState,asin:c,offerID:a.offerID,legacyDealID:a.legacyDealID,action:gb.metrics.refTags.joinWaitlist})});h.declarative("gbdeal-checkout","click",function(a){k.location.href="/gp/cart/view.html"});h.declarative("gbdeal-add-to-wishlist","click",function(a){a=a.data;gb.controller.dealDAOs[a.dealID].addingToWishList=!0;gb.controller.refreshDealView(a.dealID);gb.controller.addItemToWishList({dealID:a.dealID,asin:a.asin})});h.declarative("gbdeal-view-wishlist","click",function(a){k.location.href=
"/gp/registry/wishlist/"+a.data.defaultRegistryID});h.declarative("gbdeal-seeoptions","click",function(a){var c=gb.widgets[a.data.widgetID].dealViews[a.data.dealID][a.data.position];gb.metricsManager.recordAction(a.data.widgetID,a.data.dealID,"SEE_MORE",a.data.position);c.renderMiniDetailPage(a.data.asin);a=gb.metrics.generateRef(a.data.widgetID,gb.metrics.refTags.miniDpPopOver,[a.data.dealID]);gb.metrics.recordRefViaAjax(a)});h.declarative("gb-image","click tap",function(a){var c=gb.widgets[a.data.widgetID].dealViews[a.data.dealID][a.data.position],
d=gb.utils.shouldShowMiniDetailPageModal(c);gb.metricsManager.recordAction(a.data.widgetID,a.data.dealID,"IMAGE",a.data.position);d?(c.renderMiniDetailPage(),a=gb.metrics.generateRef(a.data.widgetID,gb.metrics.refTags.miniDpPopOver,[a.data.dealID]),gb.metrics.recordRefViaAjax(a)):k.location.href=a.data.redirectionUrl});h.declarative("gbdeal-actionrecord","click",function(a){var c=a.data.customURL;gb.metricsManager.recordAction(a.data.widgetID,a.data.dealID,a.data.actionType,a.data.position);c&&(k.location.href=
c)});h.declarative("gbdeal-mashshare","click",function(a){var c=a.data.widgetID,d=a.data.dealID;c&&d&&gb.controller.getDealDAO(d)&&(gb.metricsManager.recordAction(c,d,"SHARE_DEAL",a.data.position),gb.controller.closeBottomSheet(),gb.controller.getShareManager().shareDeal(c,d))})}),renderTitle:function(a){var b=this.widgetView.widgetID;if(!a&&!gb.configManager.getWidgetViewConfig(b).disableJsEllipsification&&(a=this.viewElement.find("#"+gb.enums.dealViewIDs.TITLE),a.length))for(var c=0;c<a.length;c++){var d=
h.$(a[c]);this._truncateText(d,"truncatedTitle");gb.configManager.getWidgetViewConfig(b).enableAutoTitleAdjustment&&d.addClass("autoHeight")}},renderDescription:function(){var a=this.viewElement.find("#"+gb.enums.dealViewIDs.DESC_ABBR);if(a.length){var a=h.$(a[0]),b=this.deal.detail;if(!b.truncatedDescription){var c=a.html().trim();if(c){var d=!0;if(gb.resources.customerData.realm===gb.enums.Realms.CN||gb.resources.customerData.realm===gb.enums.Realms.JP)d=!1;gb.utils.ellipsify({jQuery:h.$,el:a,removeDots:!0,
wordsIntact:d});b.truncatedDescription=a.html().trim();b.restDescription=c.substr(b.truncatedDescription.length);b.restDescription&&(a=this.viewElement.find("#"+gb.enums.dealViewIDs.DESC_REST),h.$(a[0]).html(b.restDescription))}}b.restDescription&&(b=this.viewElement.find("."+gb.enums.dealViewClasses.DESC_EXPANDER),0<b.length&&b.removeClass("aok-hidden"))}},_renderShipSold:function(){var a=this.viewElement.find("#"+gb.enums.dealViewIDs.SHIP_SOLD);0<a.length&&this._truncateText(a,"truncatedShipSoldInfo");
gb.configManager.getWidgetViewConfig(this.widgetView.widgetID).enableAutoTitleAdjustment&&a.addClass("autoHeight")},_truncateText:function(a,b){this[b]?a.html(this[b]):(gb.utils.ellipsify({jQuery:h.$,el:a}),this[b]=a.html())},signalMarker:function(a,b){if(gb.csm&&a&&!gb.csm.recordedMarkers[a]){var c=b&&b.recordMarkerFeature?!0:!1,d=function(){gb.csm.signalMarker(a)},e=this.viewElement.find("img");e.length&&e[0]&&e[0].complete?d():e.load(d).error(d);c&&(gb.csm.recordedMarkers[a]=!0,p.register(a))}},
renderMiniDetailPage:function(a){var b=this,c=b.deal,d=c.dealID,e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+d,g=gb.resources.getImage("spinner");p.when("A","a-modal","ready").execute(function(l,h){var k={name:e,header:gb.resources.getString("gb_deal_details"),width:"655",inlineContent:"<img src="+g+">"},r=b.viewElement.find("#"+gb.enums.dealViewIDs.IMAGE),p=h.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+d);p||(p=h.create(r,k),p.show());c.detail.itemType===gb.enums.ItemTypes.VARIATION?(b.variationView=b.variationView||
new f({dealID:d,widgetView:b.widgetView,asinID:a,isMiniDP:!0,modalInstance:p,position:b.position,dealView:b}),b.variationView.render()):(b.viewSkin=b._generateStateHTMLFromViewSubTemplates({viewTemplateGroup:gb.templateManager.TemplateGroups.MINI_DP_DEAL_VIEW,stateTemplateGroup:gb.templateManager.TemplateGroups.MINI_DP_DEAL_STATE,viewTemplateData:gb.viewComponentBuilder.getMiniDPViewTemplateData(b,p,a)}),p.updateContent(b.viewSkin).lock().show(),gb.controller.popOverVisible=!0)});var l="a:popover:beforeHide:"+
e;p.when("A").execute(function(a){a.on(l,function(){p.when("GBEventManager").execute(function(a){a.trigger("popoverClosed");gb.controller.popOverVisible=!1})})})},renderEldaradoUtil:function(){var a=gb.utils.getDealsInternalUrl(this.dealID);if(a){var b=document.createElement("a");b.href=a;b.setAttribute("value","View Deals Internal Website");b.style.backgroundImage="url('http://g-ec2.images-amazon.com/images/G/01/goldbox/gb_icon_tiny._V192570393_.gif')";b.style.width="30px";b.style.height="26px";
b.style.border="none";b.style.display="block";b.style.position="absolute";b.style.top=0;b.style.zIndex=100;this.viewElement.css("position","relative");this.viewElement.append(b)}},updateOptionsHTML:function(){var a=this.widgetView.widgetID,b=gb.configManager.getWidgetViewConfig(a);gb.resources.deviceInfo.isPhone&&b.supportWatch&&(a=gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"dealOptions",data:gb.viewComponentBuilder.getDealOptionsTemplateData(this)}),
this.enableOptions(a))},updateStatusMessage:function(a){var b=this,c=this.viewElement.find(".dealButtonContainer .dealStatusMessageHolder");c&&"function"===typeof c.text&&c.text(a);b.variationView&&p.when("A","a-modal").execute(function(c,e){var g=e.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+b.dealID);g&&g.isActive()&&g.$popover&&(g=g.$popover.find(".dealButtonContainer .dealStatusMessageHolder"),0<g.length&&g.text(a))})},updateWatchDealStatusMessage:function(a){this.viewElement.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+
this.dealID).html(a)}})});p.when("A","GoldboxMobile3PAssets").register("gb-variation-view",function(h,k){var f=k._;return h.createClass({init:function(a){this.dealID=a.dealID;this.viewSkin=null;this.isMiniDP=a.isMiniDP;this.asinID=a.asinID;this.unavailableAsinSelected=!1;this.selectedDimension={};this.modalInstance=a.modalInstance;this.dealView=a.dealView},render:function(){var a=null,a=this.asinID,b=this.dealView.deal,a=this.selectedDimension?b.getVariationAsin(this.selectedDimension):a?b.getAsinDAO(a):
null;this.modalFirstLoad=!0;this.update(a);this.handleDropDownActions();this.modalFirstLoad=!1},update:function(a){var b=this,c=b.modalInstance,d=b.isMiniDP;a&&a.status.itemState!==gb.enums.DealStates.SOLDOUT?(f.each(a.variationDimensions,function(a,c){b.selectedDimension[c]=a}),b.unavailableAsinSelected=!1):b.unavailableAsinSelected=!0;var e=gb.templateManager.TemplateGroups.DEAL_VIEW,g=gb.templateManager.TemplateGroups.DEAL_STATE,l=gb.viewComponentBuilder.getDealViewTemplateData(b.dealView,a);d&&
(e=gb.templateManager.TemplateGroups.MINI_DP_DEAL_VIEW,g=gb.templateManager.TemplateGroups.MINI_DP_DEAL_STATE,l=gb.viewComponentBuilder.getMiniDPViewTemplateData(b.dealView,c,a));b.viewSkin=b.dealView._generateStateHTMLFromViewSubTemplates({viewTemplateGroup:e,stateTemplateGroup:g,viewTemplateData:l,stateTemplateDataBuilderFn:function(c){return gb.viewComponentBuilder.getDealStateTemplateData(b.dealView,c,a)}});d&&c?c.updateContent(b.viewSkin).lock().show():(b.dealView.viewElement.html(b.viewSkin),
b.dealView.updateOptionsHTML())},handleDropDownActions:function(){var a=this,b=a.dealID,c=a.dealView.deal;f.keys(c.items);p.when("A","a-dropdown").execute(function(d,e){d.on("a:dropdown:select",function(d){if(d.id.slice(d.id.length-b.length,d.id.length)===b){a.selectedDimension={};var l;a.selectedDimension[d.name]=decodeURIComponent(d.value);var n=c.items[f.keys(c.items)[0]];f.each(n.variationDimensions,function(b,l){if(l!==d.name){var n=l.replace(/\s/g,"")+c.dealID,n=encodeURIComponent(n),n=n.replace(/%/g,
"\\%"),n=decodeURIComponent(e.getSelect(n).val());a.selectedDimension[l]=n}});l=a.getSelectorData();f.isEmpty(l)&&f.find(a.selectedDimension,function(b,c){if(c!==d.name)return a.selectedDimension[c]=gb.resources.getString("csld-select"),l=a.getSelectorData(),!f.isEmpty(l)});a._setDropdownValueBasedOnSelection(l,e,d);n=c.getVariationAsin(a.selectedDimension);a.update(n)}})});p.when("A").execute(function(d,e){d.on("a:popover:dismiss:"+gb.enums.WidgetViewIDs.MINI_DP_MODAL+b,function(){c.detail.itemType===
gb.enums.ItemTypes.VARIATION&&(a.selectedDimension={})})})},getSelectorData:function(){var a=this,b={},c=this.dealView.deal;f.each(a.selectedDimension,function(d,e){f.each(c.items,function(c){a.isMatchingCombination(c)&&f.each(c.variationDimensions,function(a,c){c!==e&&(b[c]||(b[c]=[]),b[c].push(a))})})});return b},isMatchingCombination:function(a){var b=!0;f.each(this.selectedDimension,function(c,d){c!==a.variationDimensions[d]&&c!==gb.resources.getString("csld-select")&&(b=!1)});return b},_setDropdownValueBasedOnSelection:function(a,
b,c){var d=this;f.each(a,function(e,g){if(g!==c.name){var l=g.replace(/\s/g,"")+d.dealID,l=encodeURIComponent(l),l=l.replace(/%/g,"\\%");1===e.length?(b.getSelect(l).setValue(e[0]),d.selectedDimension[g]=e[0]):-1===a[g].indexOf(d.selectedDimension[g])&&(b.getSelect(l).setValue(gb.resources.getString("csld-select")),d.selectedDimension[g]=gb.resources.getString("csld-select"))}})}})});p.when("A","GoldboxMobile3PAssets").register("gb-viewport-manager",function(h,r){var f=r._;return h.createClass({init:function(a){this.lastDealPosition=
this.firstDealPosition=this.lastScrollTop=-1;this.widgetContentPage=1;this.shouldGarbageCollect=!0;this.isScrollBound=!1;this.scrollCallback=null;this.widgetID=a.widgetID;this.pageSize=a.pageSize;this.totalDeals=a.totalDeals;this.domElementID=a.domElementID;this.pageScroll();this.attachScroll();switch(gb.resources.getFeature("image_failure_investigation")){case gb.enums.Weblabs.TREATMENTS.T1:this.shouldGarbageCollect=!1;break;case gb.enums.Weblabs.TREATMENTS.T2:this.pagesToAvoidInGC=4;break;case gb.enums.Weblabs.TREATMENTS.T3:this.pagesToAvoidInGC=
6;break;case gb.enums.Weblabs.TREATMENTS.T4:this.pagesToAvoidInGC=0;break;default:this.pagesToAvoidInGC=2}},detachScroll:function(){this.isScrollBound&&null!==this.scrollCallback&&(h.$(k).unbind("scroll",this.scrollCallback),this.isScrollBound=!1,this.scrollCallback=null)},attachScroll:function(){this.isScrollBound||null!==this.scrollCallback||(this.scrollCallback=f.bind(this.pageScroll,this),gb.subnavController&&f.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&(this.subnavPage=
gb.controller.schedulingParams[this.widgetID].subnavPage,gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&this.setHidingHeaderVariables()),!gb.subnavController||f.isNumber(this.subnavPage)&&this.subnavPage!==gb.subnavController.currentPageNumber||h.$(k).scrollTop(0),h.$(k).bind("scroll",this.scrollCallback),this.isScrollBound=!0)},clearHeaderInSubnav:function(){gb.subnavController&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.subnavController.positioning===
gb.subnavController.Constants.TOP&&(this.widgetHeaderInSubnav&&this.disableHidingWidgetHeaderOnScroll(),this.subnavPage===gb.subnavController.currentPageNumber&&gb.subnavController.subnavSlideCompletelyDown())},setHidingHeaderVariables:function(){gb.subnavController&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.subnavContainer=document.querySelector(gb.subnavController.SubnavIDs.SubnavContainer),this.widgetHeaderHolder=h.$(gb.subnavController.SubnavIDs.SubnavWidgetHolder+
this.subnavPage),this.widgetHeaderInSubnav=!1,this.subnavContainerHeightDiv=h.$(gb.subnavController.SubnavIDs.SubnavHeightDiv+this.subnavPage),this.enableHidingWidgetHeaderOnScroll())},pageScroll:function(){var a;if(!f.isNumber(this.subnavPage)||!gb.subnavController||gb.subnavController.currentPageNumber===this.subnavPage||-1===this.lastScrollTop){a=h.$(k).scrollTop();var b=this.lastScrollTop;this.lastScrollTop=a;a<b?this.setWidgetCurrentPage(gb.enums.Direction.UP):a>b&&this.setWidgetCurrentPage(gb.enums.Direction.DOWN);
this.handlePageChange()}},handlePageChange:function(){var a=gb.controller.widgetCurrentPage[this.widgetID],b=this.getCurrentPage();a!==b&&(gb.controller.widgetCurrentPage[this.widgetID]=b,a=gb.widgets[this.widgetID].totalPages,b>=a-1&&gb.widgets[this.widgetID].hideScrollContentLoader(),b!==a&&(gb.controller.trigger("WidgetPageScroll",this.widgetID,b+1),!0===this.shouldGarbageCollect&&this.garbageCollectAndReRender()))},getCurrentPage:function(){return this.widgetContentPage},setWidgetCurrentPage:function(a){for(var b=
this.widgetContentPage;gb.utils.isElementInViewPort(gb.utils.getPageID(this.widgetID,b))===gb.enums.ViewPortPresence.ABSENT;)if(a===gb.enums.Direction.UP&&0<b)--b;else if(a===gb.enums.Direction.DOWN&&b<=this.totalDeals/this.pageSize)++b;else{b=1;break}this.widgetContentPage=b},garbageCollectAndReRender:function(){this.firstDealPosition=this.widgetContentPage>this.pagesToAvoidInGC+1?(this.widgetContentPage-(this.pagesToAvoidInGC+1))*this.pageSize:0;this.lastDealPosition=(this.widgetContentPage+this.pagesToAvoidInGC)*
this.pageSize-1;this.lastDealPosition>=this.totalDeals&&(this.lastDealPosition=this.totalDeals-1);this.renderedDealViews=this.renderedDealViews||[];var a=gb.metadata.getAllDisplayableDealIDs(this.widgetID).slice(this.firstDealPosition,this.lastDealPosition),b=f.difference(this.renderedDealViews,a);this.renderedDealViews=a;gb.widgets[this.widgetID].reRenderDealViews(this.firstDealPosition,this.lastDealPosition);gb.garbageCollector.deepCleanDealViews(this.widgetID,b)},enableHidingWidgetHeaderOnScroll:function(){gb.subnavController&&
gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.widgetHeader=h.$("#"+gb.enums.WidgetHeaderIDs.WidgetHeader+this.widgetID),this.widgetHeaderHolder.html(this.widgetHeader.html()),this.widgetHeader.html(""),this.subnavContainerHeightDiv.height(this.subnavContainer.getBoundingClientRect().height),this.widgetHeaderInSubnav=!0)},disableHidingWidgetHeaderOnScroll:function(){this.widgetHeader.html(this.widgetHeaderHolder.html());this.widgetHeaderHolder.html("");this.widgetHeaderInSubnav=
!1;this.subnavContainerHeightDiv.height(this.subnavContainer.getBoundingClientRect().height)}})});p.when("A","GoldboxMobile3PAssets","gb-filter-item-view","gb-deal-view","gb-viewport-manager","gb-page-refresher").register("gb-widget-view",function(h,r,f,a,b,c){var d=r._;return h.createClass({init:function(a){this.widgetID=a.widgetID;this.widgetGroupID=a.widgetGroupID;this.widgetName=a.widgetName;this.domElementID=a.domElementID;this.dealViews={};this.fullyRenderedPages=[];this.pageHandlers=[];this.filterViews=
[];this.skinDomElement=null;this.isRefineRender=!1;this.totalPages=this.viewOrientation=null;this.isRetryInProgress=this.isGDMFailing=this.isCFRecorded=!1;this.minDealViewWidth=this.getMinDealWidth();this.viewPortManager=this.dealsPerRow=null;this.nextPositionToRender=0;this.filterJSONData={};this.nextAdSlotToRenderIndex=-1;this.isMaxDealLimitReached=!1;this.initializeView()},initializeView:function(){this.skinDomElement=h.$("#"+this.domElementID);gb.configManager.getWidgetViewConfig(this.widgetID).disableOrientationChange||
this.enableOrientationChange();this.dealsPerRow=this.getDealsPerRow();var a=gb.controller.schedulingParams[this.widgetID];d.isEmpty(a.adSlots)||(this.nextAdSlotToRenderIndex=0);var b=null;if(gb.subnavController&&d.isNumber(a.subnavPage)&&(gb.subnavController.widgetsOnSubnavPage[a.subnavPage]||(b=parseInt(gb.subnavController.idleTimeRefresh,10)),a.allowWidgetRefresh)){var l=a.subnavPage;gb.subnavController.widgetsOnSubnavPage[l]=gb.subnavController.widgetsOnSubnavPage[l]||{};gb.subnavController.widgetsOnSubnavPage[l][a.subnavPageSlot]=
this}gb.subnavController&&(a=parseInt(gb.subnavController.pageRefreshInterval,10),l=parseInt(gb.subnavController.tabRefreshElapseTime,10),b||a||l)&&(this.pageRefresher=new c(b,this.widgetID),this.pageRefresher.initializeVisibilityHandler());this._handleRefreshClick()},enableRefine:function(){var a=this;a.skinDomElement.find("#"+gb.enums.WidgetViewIDs.REFINE).click(function(){a.renderRefine()});a.filterAndSortEventsCache=a.filterAndSortEventsCache||{};a.filterAndSortEventsCache[a.widgetID]||(a.filterAndSortEventsCache[a.widgetID]=
d.once(function(){h.declarative("gbfilter-click-"+a.widgetID,"click",function(b){b.data.filterType===gb.enums.FilterConstants.CUSTOM_FILTER?a.renderFilter({isSortFilter:!1,isCustomFilter:!0}):a.renderFilter({isSortFilter:!1})});h.declarative("gbsort-click-"+a.widgetID,"click",function(b){a.renderFilter({isSortFilter:!0})})}));a.filterAndSortEventsCache[a.widgetID].call()},enableOrientationChange:function(){gb.clientName!==gb.enums.MobileClients.PC&&(this.viewOrientation=gb.utils.getDeviceOrientation(this.widgetID));
h.$(k).resize(d.bind(this.resizeWindow,this))},enableInfiniteScroll:function(){var a=gb.controller.schedulingParams[this.widgetID],c=!0;d.each(a.filterConfig,function(a){if(a.attr===gb.enums.BinningParams.PAGE.key)return c=!1});if(c&&!this.viewPortManager){var l=gb.metadata.getAllDisplayableDealIDs(this.widgetID);this.viewPortManager=new b({widgetID:this.widgetID,pageSize:a.pageSize,totalDeals:l.length,domElementID:this.domElementID})}},getMinDealWidth:function(){return gb.enums.Constants.MIN_TABLET_VIEW_WIDTH},
getDealsPerRow:function(){var a=gb.configManager.getDealViewConfig(this.widgetID),b=gb.configManager.getWidgetViewConfig(this.widgetID);return gb.resources.deviceInfo.isPhone?this.viewOrientation===gb.enums.ClientOrientation.LANDSCAPE?a.dealsPerRowL||gb.enums.Constants.PHONE_LANDSCAPE_COLUMN_COUNT:a.dealsPerRowP||gb.enums.Constants.PHONE_PORTRAIT_COLUMN_COUNT:gb.utils.getDealsPerRow(h.$(k).width(),this.minDealViewWidth,b.hasMargin,b.supportEvenColumnsOnly)},resizeWindow:function(){var a=gb.configManager.getWidgetViewConfig(this.widgetID).allowFlexRendering;
if(!this.isRefineRender){gb.controller.watchDealView&&(gb.controller.watchDealView.isWatchDealPopupRendered=!1);var b=this.dealsPerRow;this.dealsPerRow=this.getDealsPerRow();if(gb.clientName===gb.enums.MobileClients.PC){if(b===this.dealsPerRow)return}else{b=gb.utils.getDeviceOrientation(this.widgetID);if(b===this.viewOrientation)return;var c=gb.configManager.getDealViewConfig(this.widgetID);this.viewOrientation=b;this.viewPortManager&&(this.viewPortManager.lastScrollTop=b===gb.enums.ClientOrientation.LANDSCAPE?
Math.ceil(this.viewPortManager.lastScrollTop*c.dealsPerRowP/c.dealsPerRowL):Math.ceil(this.viewPortManager.lastScrollTop*c.dealsPerRowL/c.dealsPerRowP))}a?(a=this.skinDomElement.find(".dealView"),0<a.size()&&(this.viewOrientation===gb.enums.ClientOrientation.PORTRAIT?a.width(a.eq(0).data("pwidth")):a.width(a.eq(0).data("lwidth"))),this.viewPortManager&&h.$(k).scrollTop(this.viewPortManager.lastScrollTop),this._navigateToWidget()):(this.renderContent(!0),gb.controller.watchDealView&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP))}},
renderWireFrame:function(){this.isRefineRender=!1;gb.garbageCollector.clearDealViews(this.widgetID);d.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.widgets[this.widgetID]&&gb.widgets[this.widgetID].viewPortManager&&gb.widgets[this.widgetID].viewPortManager.clearHeaderInSubnav();this.totalCellsRendered=0;var a=gb.viewComponentBuilder.getWidgetViewTemplateData(this);this.filterViews=[];var b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:a});this.skinDomElement.html(b);d.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.widgets[this.widgetID]&&gb.widgets[this.widgetID].viewPortManager&&gb.widgets[this.widgetID].viewPortManager.enableHidingWidgetHeaderOnScroll();this._handleFilterChange();this._handleClearFilters();gb.controller.schedulingParams[this.widgetID].enablePagination&&
this.renderPagination(a)},showLoading:function(){if(gb.subnavController&&(h.$(gb.subnavController.subnavPages[gb.subnavController.currentPageNumber]).find("."+gb.enums.WidgetViewIDs.LOADING).length||gb.subnavController.showRefresher))this.skinDomElement.html("");else{var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetLoading"});this.skinDomElement.html(a)}},hideScrollContentLoader:function(){this.skinDomElement.find("."+
gb.enums.WidgetViewIDs.SCROLL_CONTENT_LOADER).css("display","none")},renderContent:function(b){var c=null;b&&(c=this.viewPortManager?this.viewPortManager.lastScrollTop:null,this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).empty(),this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS).empty(),this.filterViews=[],gb.garbageCollector.clearViewPort(this.widgetID),gb.garbageCollector.clearDealViews(this.widgetID));var l=gb.viewComponentBuilder.getWidgetViewTemplateData(this,b),n=gb.metadata.getAllDisplayableDealIDs(this.widgetID),
f=gb.controller.schedulingParams[this.widgetID],r=gb.enums.WidgetViewIDs.CONTENT,l=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:l});this.totalPages=Math.ceil(n.length/f.pageSize);f.enablePagination?this.skinDomElement.find("#"+r).html(l):this.skinDomElement.find("#"+r).append(l);for(var l=gb.controller.widgetCurrentPage[this.widgetID],r=f.pageSize,l=gb.controller.schedulingParams[this.widgetID].eventID||
f.enablePagination?r*(l-1):0,p=n.length<this.dealsPerRow?n.length:this.dealsPerRow;this.nextPositionToRender<=gb.watcher.lowestDealIDWatchedIndex[this.widgetID]&&l+this.nextPositionToRender<n.length;){var x=n[l+this.nextPositionToRender],y=new a({dealID:x,widgetView:this,position:this.nextPositionToRender});this.dealViews[x]=this.dealViews[x]||{};this.dealViews[x][this.nextPositionToRender]=y;y.render();this._publishLatencyMetrics(this.nextPositionToRender,gb.watcher.lowestDealIDWatchedIndex[this.widgetID],
p,y);this._recordWidgetCF(f.featureScope);this.nextPositionToRender++}f.maxLimitDeals&&this.nextPositionToRender>=f.maxLimitDeals&&this.renderMaxLimitDealTemplate();n=f.adSlots;if(!d.isEmpty(n))for(;this.nextAdSlotToRenderIndex<n.length;)if(l=gb.utils.getAdRowID(this.widgetID,this.nextAdSlotToRenderIndex),p=this.skinDomElement.find("#"+l),p.length)l=gb.viewComponentBuilder.getAdRowViewData(this),l=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"adSlot",data:l}),p.html(l),this.nextAdSlotToRenderIndex++;else break;!f.enforceLimitedDeals&&!f.enablePagination&&0<r&&this.enableInfiniteScroll();f.enableCategoryRefine&&this.enableRefine();this.widgetName!==gb.enums.WidgetNames.TAB_GRID_HERO||f.enforceLimitedDeals||(r=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTER_CONTENT),r.html(this._getRefineHTML()),gb.accessibility.trigger("AccessibilityAction","updateRefineView",{filterEl:r}));this._renderFilterViews();b&&this.viewPortManager&&
(c&&(this.viewPortManager.lastScrollTop=c),f.subnavPage!==q&&null!==f.subnavPage?h.$(gb.utils.getSubnavPageElementFromDomID(this.domElementID)).scrollTop(this.viewPortManager.lastScrollTop):h.$(k).scrollTop(this.viewPortManager.lastScrollTop));this._publishWidgetLatencyMetrics(f.featureScope);this._navigateToWidget();this._renderEllipsifiedTitle();this.applyWidgetSpecificStyle()},_publishLatencyMetrics:function(a,b,c,d){100===parseInt(this.widgetID,10)&&(a<c&&(a===c-1?d.signalMarker("af",{recordMarkerFeature:!0}):
d.signalMarker("af")),a===b-1?d.signalMarker("cf",{recordMarkerFeature:!0}):d.signalMarker("cf"))},showExcessiveTrafficMessage:function(){gb.metadata.sortedDealIDs[this.widgetID]=[];gb.watcher.unwireStatusRefresh(gb.watcher.viewPort[this.widgetID]);this.renderWireFrame();this.renderContent(!0)},applyWidgetSpecificStyle:function(){h.$("#filterContent").css("background","white");h.$("#categoryRefineContent").parent().css("background","white");this.widgetName===gb.enums.WidgetNames.MG_HERO&&(this.skinDomElement.find(".widgetContentRow.noBorder").removeClass("noBorder"),
this.skinDomElement.find(".widgetContentRow:not(:has(*>*))").addClass("noBorder"))},reRenderDealViews:function(b,c){if(!(c<=b)){for(var d=gb.metadata.getAllDisplayableDealIDs(this.widgetID),f=(new Date).getTime(),h=c-b,k="goldbox:"+((gb.widgets[this.widgetID].widgetGroupID||gb.widgets[this.widgetID].widgetName)+gb.garbageCollector.gcScopeSufix)+":batchRerender",r=b;r<c;r++){var p=d[r],q=null;this.dealViews[p]&&this.dealViews[p][r]&&(q=this.dealViews[p][r]);var v=gb.garbageCollector.reRenderGCElement(this.widgetID,
p,r);v?(v.clock&&(v.clock=gb.utils.heroTimer(v.clock.dealDate,v.clock.viewElement,v.clock.spanID,gb.configManager.getWidgetViewConfig(this.widgetID).forceApplyIncartTimer)),this.dealViews[p]=this.dealViews[p]||{},this.dealViews[p][r]=v,gb.metricsManager.recordAction(this.widgetID,p,"GC_RENDER",r)):q&&0!==q.viewElement.children("a").length||(q||(q=new a({dealID:p,widgetView:this,position:r}),this.dealViews[p]=this.dealViews[p]||{},this.dealViews[p][r]=q),q.render())}ue.count(k,h);ue.count(k+":time",
(new Date).getTime()-f)}},_navigateToWidget:function(){var a=gb.controller.schedulingParams[this.widgetID].widgetAnchorName;a&&k.location.hash==="#"+a&&d.defer(function(){h.$("html, body").scrollTop(h.$("#"+a).offset().top)})},_renderFilterViews:function(){var a=this;a.isFilterEnabled()&&(a.widgetName!==gb.enums.WidgetNames.MG_HERO||d.isEmpty(a.filterViews))&&d.each(gb.controller.schedulingParams[a.widgetID].filterConfig,function(b){b=new f({},{filterConfig:b,widgetView:a});a.filterViews.push(b);
gb.configManager.getWidgetViewConfig(a.widgetID).showBottomSheetFilter||b.render()})},_getRefineHTML:function(){var a=this.isEventsWidget()?"filter":"refine",b=gb.viewComponentBuilder.getRefineTemplateData(this);return gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:a,data:b})},renderRefine:function(a){var b=this;b.isRefineRender=!0;var c=b._getRefineHTML();if(b.isEventsWidget()){var c=h.$("<div>").html(c),d=h.$("#"+
gb.enums.WidgetViewIDs.FILTERS,b.skinDomElement).html();h.$("#"+gb.enums.WidgetViewIDs.FILTERS,c).html(d);c=c.html()}b.skinDomElement.hide();a?h.$("#"+a).html(c):b.skinDomElement.html(c);b.skinDomElement.slideDown();b.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CANCEL).click(function(a){a.preventDefault();b.skinDomElement.slideUp(function(){b.skinDomElement.show();b.renderWireFrame();b.renderContent(!0)})})},renderPagination:function(){var a=gb.viewComponentBuilder.getPaginationTemplateData(this),
a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"pagination",data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PAGINATION_ROW).html(a);this._handlePageChange()},_handleFilterChange:d.once(function(){h.declarative("refine","click",function(a){a.$event.preventDefault();var b=a.data.widgetID,c=a.$target.closest("[data-status]").data("status");a=a.$target.closest("[data-category]").data("category");c?(gb.controller.trigger("WidgetStatusChange",
b,c),gb.widgets[b].renderRefine(gb.enums.WidgetViewIDs.FILTER_CONTENT),gb.widgets[b].enableInfiniteScroll()):a&&gb.controller.trigger("WidgetCategoryChange",b,a);(c||a)&&p.when("a-popover").execute(function(a){gb.widgets[b].isRefineRender=!1;(a=a.get(gb.enums.WidgetViewIDs.REFINE_POPOVER_NAME))&&a.hide()})})}),_handleRefreshClick:d.once(function(){h.declarative("refresh-widget","click",function(a){a.$event.preventDefault();gb.widgets[a.data.widgetID].refreshWidget()})}),_handlePageChange:d.once(function(){h.declarative("gbfilter-pagination",
"click",function(a){a.$event.preventDefault();var b=a.data.widgetID,c=parseInt(a.data.currentPage,10),d=parseInt(a.data.totalPages,10),f=a.$target.closest("[data-page]").data("page");f||(a=a.$target[0].href&&a.$target[0].href.split("#")[1],a===gb.enums.PaginationDummyURLs.PREV&&1<c?f=c-1:a===gb.enums.PaginationDummyURLs.NEXT&&c<d&&(f=c+1));f&&(gb.controller.widgetCurrentPage[b]=f,b&&!gb.widgets[b].isEventsWidget()&&(gb.controller.trigger("WidgetPageUpdate",b,!0),gb.controller.updateAppliedFilters(b)))})}),
_handleClearFilters:d.once(function(){h.declarative("clear-refine","click",function(a){a.$event.preventDefault();a=a.data.widgetID;gb.controller.widgetCurrentStatus[a]=gb.enums.StatusFilters.AVAILABLE;gb.controller.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;gb.controller.widgetCurrentPage[a]=1;gb.controller.trigger("WidgetPageUpdate",a,!0);gb.controller.updateAppliedFilters(a)})}),scrollToWidgetTop:function(){"function"===typeof k.scrollTo&&k.scrollTo(0,this.skinDomElement.offset().top)},
isEventsWidget:function(){return!!gb.controller.schedulingParams[this.widgetID].eventID},isFilterEnabled:function(){return!!this.widgetGroupID},_renderEllipsifiedTitle:function(){var a=this;gb.configManager.getWidgetViewConfig(this.widgetID).useCssEllipsification&&d.defer(function(){d.each(a.dealViews,function(a,b){d.each(a,function(a,b){a.renderTitle(!1)})})})},_publishWidgetLatencyMetrics:function(a){a&&gb.csm&&!gb.csm.publishedMetrics[a]&&(gb.csm.signalMarker("be",a),gb.csm.publishMetrics(a))},
_recordWidgetCF:function(a){a&&!this.isCFRecorded&&gb.csm&&!gb.csm.publishedMetrics[a]&&(gb.csm.signalMarker("cf",a),this.isCFRecorded=!0)},renderFilter:function(a){this.filterViews[0]._handleFilterChange();this.getInitialFilterList(a);this._handleBottomSheetFilterEvents()},getInitialFilterList:function(a){var b=a.isSortFilter;a=a.isCustomFilter;var c=this,n=d.keys(gb.filterController.models[this.widgetGroupID].availableFilterOptions),h=d.keys(c.filterViews[0]._staticFilterAttrToValues),n=d.union(n,
h,[gb.enums.BinningParams.REVIEW_RATING.key,gb.enums.BinningParams.SORT_ORDER.key]);this.filterJSONData={};d.each(gb.controller.schedulingParams[c.widgetID].filterConfig,function(a){var b=!1,e="";d.each(a.attr.split(","),function(a){!b&&d.contains(n,a)&&(b=!0);e||(e=gb.filterUtils.getLabelForSelectedAttribute(a,{widgetID:c.widgetID,widgetGroupID:c.widgetGroupID,totalPages:c.totalPages}))});b&&(c.filterJSONData[a.attr]={currentSelection:e,filterConfig:a})});var h=d.without(Object.keys(c.filterJSONData),
gb.enums.BinningParams.SORT_ORDER.key),k=gb.filterController.models[this.widgetGroupID].customFilter;b||1!==h.length?a?c.filterJSONData[k]&&(b=new f({},{filterConfig:c.filterJSONData[k].filterConfig,widgetView:c,disableBackButton:!0}),b.render()):(k&&delete c.filterJSONData[k],h=gb.viewComponentBuilder.getBottomSheetFilterContentExpanderData(c,{isSortFilter:b}),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"expander",
data:h}),h=gb.viewComponentBuilder.getBottomSheetFilterHeaderData(c,{title:b?gb.resources.getString("gb_sort_by").toUpperCase():gb.resources.getString("csld-refine").toUpperCase(),showClearOption:!b,enableBack:0}),b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"header",data:h}),h=gb.viewComponentBuilder.getBottomSheetFilterFooterData(),h=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,
templateName:"footer",data:h}),b={header:b,contents:a,footer:h},gb.controller.getBottomSheet().render(b)):(b=new f({},{filterConfig:c.filterJSONData[h[0]].filterConfig,widgetView:c}),b.render())},_handleBottomSheetFilterEvents:function(){var a=this;a.bottomSheetFilterEventsCache=a.bottomSheetFilterEventsCache||{};a.bottomSheetFilterEventsCache[a.widgetID]||(a.bottomSheetFilterEventsCache[a.widgetID]=d.once(function(){h.declarative("gbfilter-back-navigation-"+a.widgetID,"click",function(b){a.getInitialFilterList({isSortFilter:!1})});
h.declarative("gbfilter-expander-"+a.widgetID,"click",function(b){(new f({},{filterConfig:a.filterJSONData[b.data.attribute].filterConfig,widgetView:a})).render()})}));a.bottomSheetFilterEventsCache[a.widgetID].call()},refreshWidget:function(a){var b=this,c=gb.controller.schedulingParams[b.widgetID],d=null;b.isGDMFailing=!1;b.isRetryInProgress=!1;a&&this.viewPortManager&&(d=this.viewPortManager.lastScrollTop);c.fetchWatchedDeals&&(b.showLoading(),gb.metadata.refreshWatchedDeals(b.widgetID));c.watchedDealsWidget||
gb.utils.isWatchedDealsTab(b.widgetID)||(delete gb.metadata.sortedDealIDs[b.widgetID],a={},a=2,gb.configManager.getWidgetViewConfig(b.widgetID).fetchSinglePageDeals&&(a=1),a={dealsPerPage:gb.configManager.getWidgetViewConfig(b.widgetID).preFetchGDMDeals,getDealsSize:a*c.pageSize},b.showLoading(),d&&h.$(k).scrollTop("0px"),gb.service.fetchDealWithData(b.widgetID,a,function(){gb.filterController._updateWidgetGroup(b.widgetGroupID);d&&h.$(k).scrollTop(d)}))},renderMaxLimitDealTemplate:function(){if(0===
this.skinDomElement.find(".widgetMaxLimitDeal").size()){var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});this.skinDomElement.append(a);this.hideScrollContentLoader()}}})});p.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-deal-view").register("gb-supple-widget-view",function(h,k,f,a){var b=k._;return f.extend({totalCellsRendered:0,isLeftFilterRequired:!1,init:function(a){var d=["all",gb.enums.BinningParams.PAGE.key,
gb.enums.BinningParams.SORT_ORDER.key];this.isLeftFilterRequired=!b.isEmpty(b.reject(a.schedulingParams.filterConfig,function(a){return b.contains(d,a.attr)}));this._super(a)},renderWireFrame:function(){this.filterViews=[];gb.garbageCollector.clearDealViews(this.widgetID);this.totalCellsRendered=0;var a=gb.viewComponentBuilder.getSuppleWidgetViewTemplateData(this),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",
data:a});this.skinDomElement.html(a);var a=this.skinDomElement.find(gb.enums.WidgetViewSelectors.PADCENTER),b=gb.utils.isTablet(gb.clientName)?gb.enums.Constants.MIN_TAB_WIDTH:gb.enums.Constants.MIN_NAV_WIDTH;gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals||(b-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);var e=this.skinDomElement.width();!gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&this.isLeftFilterRequired&&(e-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);
e<b&&(b=e);a.css("min-width",b)},renderContent:function(b){var d=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS),e=gb.controller.schedulingParams[this.widgetID];b&&(this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).empty(),d.empty(),d.height("auto"),this.filterViews=[],gb.garbageCollector.clearDealViews(this.widgetID));var g=gb.viewComponentBuilder.getSuppleWidgetViewTemplateData(this,b);b=gb.metadata.getAllDisplayableDealIDs(this.widgetID).length;var d=gb.metadata.getSortedDealIDs(this.widgetID),
l=gb.enums.WidgetViewIDs.CONTENT,f=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:g}),g=gb.controller.widgetCurrentPage[this.widgetID],h=e.pageSize;this.skinDomElement.find("#"+l).html(f);this.totalPages=Math.ceil(b/h);l=this.getATFDealsCount(b,e.enforceLimitedDeals,gb.widgetHelper.allDealsFetched[this.widgetID]);f=0;e.enforceLimitedDeals?f=d.length:b&&(f=Math.min(h,b-(g-1)*h));this.totalCellsRendered=
0;this._renderFilterViews();for(var k=0,r=0,p=0;k<f;k++){var q=d[k];if(q){var v=this._isDoubleCell(q),t=v?2:1;p+t<=this.dealsPerRow||(r++,p=0);var A=new a({dealID:q,widgetView:this,position:k,isDoubleCell:v,row:r,column:p});p+t>=this.dealsPerRow?(p=0,r++):p+=t;this.dealViews[q]=this.dealViews[q]||{};this.dealViews[q][k]=A;A.render();this._publishLatencyMetrics(k,f,l,A);this._recordWidgetCF(e.featureScope);v=this._isDoubleCell(q);this.totalCellsRendered+=v?2:1;q=this.totalCellsRendered<=this.dealsPerRow;
t=!1;0===this.totalCellsRendered%this.dealsPerRow?t=!0:k+1===d.length&&(t=!e.showLaunchCell||!e.enforceLimitedDeals);(v=this.getDealViewCSS(v,q,t))&&A.viewElement.addClass(v);gb.utils.isTouchDevice()&&e.showShortCellView&&A.viewElement.removeClass("shortCellView").addClass("shortCellViewTablet")}}e.maxLimitDeals&&g*h>=e.maxLimitDeals&&this.renderMaxLimitDealTemplate();e.enforceLimitedDeals&&0<b&&this.renderLaunchCell();this._publishWidgetLatencyMetrics(e.featureScope);this._navigateToWidget();this._renderEllipsifiedTitle()},
getATFDealsCount:function(a,b,e){var g=this.dealsPerRow;b?e&&g>a&&(g=a):g>a&&(g=a);return g},getDealsPerRow:function(){var a=h.$("#"+this.domElementID).width();!gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&this.isLeftFilterRequired&&(a-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);a=gb.utils.getDealsPerRow(a,this.minDealViewWidth,gb.configManager.getWidgetViewConfig(this.widgetID).hasMargin,!1,!0);a=Math.min(a,8);return a=Math.max(2,a)},renderMaxLimitDealTemplate:function(){var a=
this.skinDomElement.find("#maxLimitCell"),b=!1;this.totalCellsRendered<=this.dealsPerRow&&(b=!0);a&&a.remove();a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});b=this.getDealViewCSS(!1,b,!0);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);a=this.skinDomElement.find("#maxLimitCell");a.addClass(b)},renderLaunchCell:function(){if(gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&
gb.controller.schedulingParams[this.widgetID].showLaunchCell&&gb.widgetHelper.allDealsFetched[this.widgetID]&&0!==b.keys(this.dealViews).length){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a&&a.remove();var d=!1;this.totalCellsRendered<=this.dealsPerRow&&(d=!0);a=gb.viewComponentBuilder.getLaunchCellTemplateData(this);a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"launchCell",data:a});
d=this.getDealViewCSS(!1,d,!0);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a.addClass(d)}},getDealViewCSS:function(a,b,e){gb.resources.getCustomerData("realm");var g="tallCellView";gb.controller.schedulingParams[this.widgetID].showShortCellView&&(g="shortCellView");g=g+" "+("gridColumn"+this.dealsPerRow);b&&gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&(g+=" firstRowDiv");e&&(g+=" rightMostDiv");
return a?g+" doubleCell":g+" singleCell"},_isDoubleCell:function(a){return gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&gb.controller.schedulingParams[this.widgetID].showDoubleCellDOTD&&(b.contains(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],a)||b.contains(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],a))},renderErrorMessage:function(){if(!gb.controller.popOverVisible){this.removeErrorMessage();var a=gb.viewComponentBuilder.getCartErrorDisplayData(),
a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetErrorAlert",data:a});this.skinDomElement.prepend(a);h.$("html,body").animate({scrollTop:h.$("#"+this.domElementID).offset().top},"slow")}},removeErrorMessage:function(){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CART_ERROR);0<a.length&&a.remove()},getMinDealWidth:function(){return gb.enums.Constants.MIN_PC_VIEW_WIDTH}})});p.when("A","GoldboxMobile3PAssets",
"gb-widget-view","gb-deal-view","gb-filter-item-view").register("gb-shoveler-widget-view",function(h,r,f,a,b){var c=r._;return f.extend({isLaunchCellPage:!1,Constants:{MIN_SHOVELER_VIEW_WIDTH:223,MIN_WIDGET_WIDTH:500,RIGHT_PADDING:33},init:function(a){this._super(a);this.displayableFilter=[gb.enums.BinNames.CATEGORIES]},renderWireFrame:function(){var a=this;gb.garbageCollector.clearDealViews(this.widgetID);p.when("a-popover").execute(function(b){(b=b.get(gb.enums.WidgetViewIDs.SHOVL_FILTER+"_"+a.widgetID))&&
b.hide()&&b.update({content:""})});this.skinDomElement.css("min-width",this.Constants.MIN_WIDGET_WIDTH);var b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this),c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:b});this.skinDomElement.html(c);this.renderStateHeader(b)},renderContent:function(){var b=gb.controller.schedulingParams[this.widgetID],c=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this);
this.isLaunchCellPage=gb.utils.isLaunchCellPage(this.widgetID);var g=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:c});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).html(g);this._renderShovlPagination(c);this._renderFilterViews();for(var g=c.totalDeals<this.dealsPerRow?c.totalDeals:this.dealsPerRow,l=0,f=0,h=gb.metadata.getSortedDealIDs(this.widgetID);l<c.lastDealIDPosition;){var k=
h[l];if(k){var r=new a({dealID:k,widgetView:this,position:l,row:1,column:f});this._recordWidgetCF(b.featureScope);this.dealViews[k]=this.dealViews[k]||{};this.dealViews[k][l]=r;r.render();this._publishLatencyMetrics(l,c.lastDealIDPosition,g,r);l++;f++}else l++}b.maxLimitDeals&&gb.controller.widgetCurrentPage[this.widgetID]*b.pageSize>=b.maxLimitDeals&&this.renderMaxLimitDealTemplate();0<c.totalDeals&&this.isLaunchCellPage?(this.renderLaunchCell(),this.renderShovlButtonsContent({prev:!1,next:!0},c)):
this.renderShovlButtonsContent(!1,c);this._publishWidgetLatencyMetrics(b.featureScope);this._renderEllipsifiedTitle()},getDealsPerRow:function(){var a=this.skinDomElement.width(),a=a-this.Constants.RIGHT_PADDING,a=gb.utils.getDealsPerRow(a,this.minDealViewWidth,gb.configManager.getWidgetViewConfig(this.widgetID).hasMargin,!1,!0),a=Math.min(a,12);return a=Math.max(2,a)},resizeWindow:function(){if(!this.isRefineRender){gb.controller.watchDealView&&(gb.controller.watchDealView.isWatchDealPopupRendered=
!1);var a=this.dealsPerRow;this.dealsPerRow=this.getDealsPerRow();if(a!==this.dealsPerRow){gb.widgetHelper&&gb.widgetHelper.callDataArray[this.widgetID]&&(gb.widgetHelper.callDataArray[this.widgetID][0].dealsPerPage=this.dealsPerRow);var b=gb.controller.schedulingParams[this.widgetID],a=gb.metadata.selectedDealsCount[this.widgetID],c=this.dealsPerRow||b.pageSize;b.pageSize=c;a=(b=b.widgetTabConfig[b.widgetCurrentTab])&&b.launchCellIndex?Math.ceil((a+1)/c):Math.ceil(a/c);c=gb.controller.widgetCurrentPage[this.widgetID];
c>a&&(c=a);gb.controller.widgetCurrentPage[this.widgetID]=c;gb.controller.trigger("WidgetResize",this.widgetID);gb.controller.watchDealView&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP)}}},renderErrorMessage:function(){if(!gb.controller.popOverVisible){this.removeErrorMessage();var a=gb.viewComponentBuilder.getCartErrorDisplayData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"widgetErrorAlert",data:a});this.skinDomElement.prepend(a);a=this.skinDomElement.position().top;k.scrollY>a&&h.$("html,body").animate({scrollTop:a},"slow")}},removeErrorMessage:function(){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CART_ERROR);0<a.length&&a.remove()},getMinDealWidth:function(){return this.Constants.MIN_SHOVELER_VIEW_WIDTH},renderShovlButtonsContent:function(a,b){var g=b;g||(g=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this));c.isObject(a)?
g.disableButton=a.prev:g.disableButton=a;var l=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"previousButton",data:g});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PREV_SHOVL_BUTTON).html(l);c.isObject(a)&&(g.disableButton=a.next);g=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"nextButton",data:g});this.skinDomElement.find("#"+
gb.enums.WidgetViewIDs.NEXT_SHOVL_BUTTON).html(g)},_renderShovlPagination:function(a){a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"pagination",data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.SHOVL_PAGINATION).html(a)},_renderFilterViews:function(){var a=this;c.each(gb.controller.schedulingParams[this.widgetID].filterConfig,function(e){c.contains(a.displayableFilter,e.attr)&&(e=new b({},{filterConfig:e,
widgetView:a}),e.render(),a.filterViews.push(e))})},renderStateHeader:function(a){var b=a;b||(b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this));var c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"stateHeader",data:b});a=gb.enums.WidgetViewIDs.SHOVL_STATE_HEADER;this.skinDomElement.find("#"+a).html(c);b.disableFilter||(b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"filterHeader",data:b}),this.skinDomElement.find("#"+a).append(b))},showLoading:function(){var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetLoading"});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).html(a)},renderMaxLimitDealTemplate:function(){var a=this.skinDomElement.find("#maxLimitCell");a&&a.remove();a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,
templateName:"maxLimitDeal"});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a)},renderLaunchCell:function(){if(gb.widgetHelper.allDealsFetched[this.widgetID]&&this.isLaunchCellPage){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a&&a.remove();a=gb.viewComponentBuilder.getShovelerLaunchCellTemplateData(this);a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"launchCell",data:a});
this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a)}}})});p.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-filter-item-view").register("gb-faceout-widget-view",function(h,k,f,a){var b=k._;return f.extend({init:function(a){this._super(a);this.marginOnEitherSide=45;this.tileWidthAsPercentage=0},renderContent:function(a){this._super(a);this._generateFilterViews();a=this._fetchWidgetConfigs();a.animateShoveling=!1;this._calculateTileWidth(a.tilesPerPage);this._renderFilterViews();
this.renderShovlButtonsContent(a)},_generateFilterViews:function(){var c=this;b.isEmpty(c.filterViews)&&b.each(gb.controller.schedulingParams[c.widgetID].filterConfig,function(b){b=new a({},{filterConfig:b,widgetView:c});c.filterViews.push(b)})},_renderFilterViews:function(){b.each(this.filterViews,function(a){a.render()})},resizeWindow:function(){this.renderContent(!1)},renderShovlButtonsContent:function(a){var b=this._fetchWidgetViewTemplateData();b.currentPage=a.currentPage;b.totalPages=Math.ceil(a.totalTiles/
a.tilesPerPage);b.disableButton=1>=b.currentPage;var e=this._fetchWidgetViewHtml("previousButton",b);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PREV_SHOVL_BUTTON).html(e);b.disableButton=b.currentPage>=b.totalPages;b=this._fetchWidgetViewHtml("nextButton",b);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.NEXT_SHOVL_BUTTON).html(b);this._shovelTo(a)},_fetchWidgetViewTemplateData:function(){var a={};a.widgetID=this.widgetID;a.widgetName=this.widgetName;a.widgetGroupID=this.widgetGroupID;
a.actionName=gb.enums.WidgetActions.Faceout.SHOVEL;return a},_fetchWidgetViewHtml:function(a,b){return gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:a,data:b})},_fetchWidgetConfigs:function(){var a=gb.configManager.getWidgetViewConfig(this.widgetID),b=gb.controller.widgetCurrentPage[this.widgetID],e=this.filterViews[0].filterConfig.faceoutConfig.length,g=Math.min(a.maxTilesPerPage,e);return{totalTiles:e,tilesPerPage:g,
currentPage:b,scrollAnimationSpeed:a.scrollAnimationSpeed}},_shovelTo:function(a){var b=(this.skinDomElement.width()-2*this.marginOnEitherSide)/a.tilesPerPage*(a.currentPage-1)*a.tilesPerPage,e=a.scrollAnimationSpeed;a.animateShoveling?h.$(".tiles").animate({scrollLeft:b},e):h.$(".tiles").scrollLeft(b)},_calculateTileWidth:function(a){this.tileWidthAsPercentage=100/a}})});p.when("A","gb-widget-view","gb-shoveler-widget-view","gb-supple-widget-view","gb-faceout-widget-view").register("gb-widget-factory",
function(h,k,f,a,b){return h.createClass({getWidgetView:function(c){switch(c.widgetName){case gb.enums.WidgetNames.PC_SUPPLE:return new a(c);case gb.enums.WidgetNames.PC_SHOVELER:return new f(c);case gb.enums.WidgetNames.PC_FACEOUT:return new b(c);default:return new k(c)}},isInstanceOfWidgetView:function(a){return a&&a instanceof k?!0:!1}})});p.when("A","GoldboxMobile3PAssets").register("gb-filter-item-view",function(h,k){var f=k._;return h.createClass({_staticFilterAttrToValues:{},init:function(a,
b){this.widgetView=b.widgetView;this.filterConfig=b.filterConfig;this.disableBackButton=b.disableBackButton;this.type=this.filterConfig.type;this.title=this.filterConfig.title;var c=this.filterConfig.attr.split(",");this.attributes=f.map(c,function(a){return h.$.trim(a)});c="#"+gb.utils.getFilterItemViewID(this.attributes,this.type);this.viewElement=this.widgetView.skinDomElement.find(c);this.viewElement.length?this.viewElement.empty():this.viewElement=this.widgetView.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS);
this._populateStaticFilterValues()},render:function(){this.filterOptions=this._getFilterOptionList(this.attributes,this.widgetView);if(gb.configManager.getWidgetViewConfig(this.widgetView.widgetID).showBottomSheetFilter){var a=gb.viewComponentBuilder.getBottomSheetFilterContentData(this),b=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"links",data:a}),a=gb.viewComponentBuilder.getBottomSheetFilterHeaderData(this,
{title:gb.resources.getString(this.filterConfig.title).toUpperCase(),showClearOption:0,enableBack:this.disableBackButton||1===f.without(gb.filterController.models[this.widgetView.widgetGroupID].attributesList,gb.enums.BinningParams.SORT_ORDER.key).length?0:1}),c=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"header",data:a}),a=gb.viewComponentBuilder.getBottomSheetFilterFooterData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,
templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"footer",data:a}),b={header:c,contents:b,footer:a};gb.controller.getBottomSheet().render(b)}else a=gb.viewComponentBuilder.getFilterViewTemplateData(this),a.elements=this.generateFilterViewComponent(a),this.viewSkin=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"filterItem",data:a}),this.viewElement.append(this.viewSkin);this._handleFilterChange()},
generateFilterViewComponent:function(a){var b={};b[this.type]=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:this.type,data:a});return b},_paginationDummyUrls:{PREV:"prev",NEXT:"next"},_getTypeCorrectedData:function(a){var b=parseInt(a,10);return!isNaN(b)&&b+""===a&&0<=b?b:f.isNumber(a)&&0>a?a.toString():a},_handleTitleChange:function(a){a.targetedWidget.title&&(a.targetedWidget.title=null,a.targetedWidget.clearTitle=
!0)},_handleFilterChange:f.once(function(){var a=this,b=function(b){var d=f.tail(arguments)[0],e=d.$target.closest("[data-widgetid]").data("widgetid");if(e){var g=gb.widgets[e].widgetGroupID,l=d.data.attribute,n=d.data.attributes;b.call(a,d,{widgetID:e,widgetGroupID:g,attribute:l,attributes:n,linkType:d.data.linkType,redirectURL:d.data.redirectURL,titleOnTargetedWidget:d.data.titleOnTargetedWidget,metrics:{widgetID:e,eventID:g,data:[g,l||n],context:gb.metrics.refTags.filter},isSelected:d.data.isSelected},
gb.filterController.models[g]);return!1}};h.declarative("gbfilter-checkbox","change",f.wrap(function(a,b,e){var g=a.data.value;a.$target.is(":checked")?e.addFilterValue(b.attribute,g,b.metrics):(b.metrics.context=gb.metrics.refTags.clearFilter,e.removeFilterValue(b.attribute,g,b.metrics))},b));h.declarative("gbfilter-dropdown","change",f.wrap(function(a,b,e){a=a.$target.val();e.setFilterValue(b.attribute,a,b.metrics)},b));h.declarative("gbfilter-link","click",f.wrap(function(b,d,e){if("clear"===d.linkType)if(this._handleTitleChange(e),
"true"===d.isSelected)gb.controller.getBottomSheet().close();else{var g=f.map(d.attributes.split(","),h.$.trim);f.each(g,function(a){e.removeFilterValue(a,q,d.metrics,!0)});e.triggerChangeEvent(d.metrics)}else{b.data.attribute===gb.enums.BinningParams.DEAL_TYPE.key?(e.removeFilterValue(gb.enums.BinningParams.PRIME_ACCESS_TYPE.key,q,q,!0),gb.resources.getFeature("appearly_apponly_access")&&e.removeFilterValue(gb.enums.BinningParams.ACCESS_TYPE.key,q,q,!0)):b.data.attribute===gb.enums.BinningParams.PRIME_ACCESS_TYPE.key?
(e.removeFilterValue(gb.enums.BinningParams.DEAL_TYPE.key,q,q,!0),gb.resources.getFeature("appearly_apponly_access")&&e.removeFilterValue(gb.enums.BinningParams.ACCESS_TYPE.key,q,q,!0)):b.data.attribute===gb.enums.BinningParams.ACCESS_TYPE.key&&(e.removeFilterValue(gb.enums.BinningParams.DEAL_TYPE.key,q,q,!0),e.removeFilterValue(gb.enums.BinningParams.PRIME_ACCESS_TYPE.key,q,q,!0));var g=b.$target,l=g.closest("[data-value]").data("value")||g.find("[data-value]").data("value");g.closest("[data-isselected]").data("isselected")||
g.find("[data-isselected]").data("isselected")?gb.controller.getBottomSheet().close():l&&(l=b.data.attribute===gb.enums.BinningParams.CATEGORIES.key?l.toString():a._getTypeCorrectedData(l),e.setFilterValue(d.attribute,l,d.metrics))}b.$event.preventDefault()},b));h.declarative(gb.enums.WidgetActions.Faceout.TILE_SELECTED,"click",f.wrap(function(a,b,e){a=a.$target.closest("[data-value]").data("value");b.redirectURL&&(e.redirectURL=b.redirectURL,gb.resources.deviceInfo.isApp||gb.clientName===gb.enums.MobileClients.AW)&&
(e.doPageRefresh=!0);b.titleOnTargetedWidget&&(e.targetedWidget.title=b.titleOnTargetedWidget,e.targetedWidget.clearTitle=!1);var g={disableNavigationToTop:!0};a?(a=a.toString(),e.removeFilterValue(b.attribute,q,b.metrics,!0),b.metrics.context=gb.metrics.refTags.filter,e.addFilterValue(b.attribute,a,b.metrics,!1,g)):e.removeFilterValue(b.attribute,q,b.metrics,!1,g)},b));h.declarative(gb.enums.WidgetActions.Faceout.SHOVEL,"click",f.wrap(function(a,b){if(a.data.buttonStatus!==gb.enums.ShovlConstants.DISABLED){var e=
parseInt(a.data.currentPage,10),e=a.data.actionType===gb.enums.ShovlConstants.SHOVL_NEXT?e+1:e-1,g=parseInt(a.data.totalPages,10);1<=e&&e<=g&&(gb.controller.widgetCurrentPage[b.widgetID]=e,e=gb.widgets[b.widgetID],g=e._fetchWidgetConfigs(),g.animateShoveling=!0,e.renderShovlButtonsContent(g))}},b));h.declarative(gb.enums.WidgetActions.Filter.CLEAR_ALL,"click",f.wrap(function(a,b,e){b.metrics.context=gb.metrics.refTags.clearFilter;this._handleTitleChange(e);e.removeAllFilterValues(null,null,b.metrics)},
b));h.declarative("gbfilter-pagination","click",f.wrap(function(b,d,e){var g=parseInt(b.data.currentPage,10),l=parseInt(b.data.totalPages,10),f=b.$target.closest("[data-page]").data("page");parseInt(f,10)||(f=q);b.$event.preventDefault();f||(b=b.$target[0].href&&b.$target[0].href.split("#")[1],b===a._paginationDummyUrls.PREV&&1<g?f=g-1:b===a._paginationDummyUrls.NEXT&&g<l&&(f=g+1));f&&(gb.controller.widgetCurrentPage[d.widgetID]=f,e.setFilterValue(d.attribute,f,d.metrics))},b))}),_getFilterOptionList:function(a,
b){var c=this,d=[],e=gb.filterController.models[b.widgetGroupID];if("all"===a[0]){a=f.keys(e.availableFilterOptions);a.push(gb.enums.BinningParams.PAGE.key);var g=gb.filterController.models[b.widgetGroupID].attributesList,l=f.keys(c._staticFilterAttrToValues),l=f.union(l,[gb.enums.BinningParams.REVIEW_RATING.key,gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key]);a=f.union(a,f.intersection(g,l))}f.each(a,function(a){var g;g=c._staticFilterAttrToValues[a]?c._getStaticBinningResponse(a):e.availableFilterOptions[a]||
{};a=gb.filterUtils.getFilterOptions(a,g,{widgetID:b.widgetID,widgetGroupID:b.widgetGroupID,totalPages:b.totalPages});Array.prototype.push.apply(d,a)});return d},_populateStaticFilterValues:function(){this._staticFilterAttrToValues[gb.enums.BinningParams.DEAL_STATE.key]=gb.enums.DealStates;this._staticFilterAttrToValues[gb.enums.BinningParams.DEAL_TYPE.key]=gb.enums.DealTypes;gb.resources.getFeature("appearly_apponly_access")&&(this._staticFilterAttrToValues[gb.enums.BinningParams.ACCESS_TYPE.key]=
gb.enums.DealAccessTypes);this._staticFilterAttrToValues[gb.enums.BinningParams.PRIME_ACCESS_TYPE.key]={PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",PRIME_ONLY_BD:"PRIME_ONLY_BD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD",PRIME_ONLY_LD:"PRIME_ONLY_LD"}},_getStaticBinningResponse:function(a){a=f.values(this._staticFilterAttrToValues[a]);return f.object(f.map(f.values(a),function(a){return[a,1]}))}})});p.when("A","GoldboxMobile3PAssets").register("gb-bottomsheet-view",function(h,r){var f=r._;return h.createClass({els:{},
elClasses:{},elHTMLs:{header:"",contents:"",footer:""},modalHeight:0,currentSheetHeightPercentage:0,minScrollableHeight:0,isModalTranslating:!1,maxScrollTopPosition:0,isIphone:!1,initialScrollPosition:0,scrollDirection:0,bodyScrollPosition:0,parentEle:null,Constants:{EL_LIST:"container background modal header contents footer".split(" "),CSS_CLASS_PREFIX:"bottomSheet",BASE_HTML:'<div class="bottomSheetContainer BOTTOM-SHEET" aria-hidden="false" aria-label="Bottom Sheet"><div class="bottomSheetBackground"></div><div class="bottomSheetModal"><div class="bottomSheetHeader"></div><div class="bottomSheetContents"></div><div class="bottomSheetFooter"></div></div></div>',
ANIMATE_TIMEOUT:20,SHEET_MAX_HEIGHT_RATIO:.5,PARTIAL_VISIBLE_ROW_HEIGHT:.6,SCROLL_TOP_BUFFER:5},_getElClass:function(a){if(f.contains(this.Constants.EL_LIST,a))return this.Constants.CSS_CLASS_PREFIX+a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()},init:function(){var a=this;f.each(this.Constants.EL_LIST,function(b){a.elClasses[b]=a._getElClass(b)})},render:function(a){var b=this;if(!f.isEmpty(a)){this.isIphone=gb.resources.deviceInfo.isIOS;var c=h.$(k).height(),d=h.$("body"),e=b.isBottomSheetDomPresent();
e||(b.bodyScrollPosition=h.$("body")[0].scrollTop,b.parentEle=h.$("#a-page"),b.parentEle.css({height:c+"px",overflow:"hidden"}),b.parentEle.addClass("parentElementProp"),b.parentEle[0].scrollTop=b.bodyScrollPosition);f.each(f.keys(this.elHTMLs),function(c){a[c]&&(b.elHTMLs[c]=a[c])});e||d.append(this.Constants.BASE_HTML);b=this;f.each(this.Constants.EL_LIST,function(a){b.els[a]=d.find("."+b.elClasses[a])});b=this;f.each(this.elHTMLs,function(a,c){b.els[c].html(a)});b.modalHeight=b.els.header.outerHeight()+
b.els.footer.height()+b.els.contents.height();this.setContainerProperties();this.registerEvents();e?(this.maxScrollTopPosition+this.minScrollableHeight<this.Constants.SHEET_MAX_HEIGHT_RATIO*c?this.els.container[0].scrollTop=this.maxScrollTopPosition:(c=this.els.contents.children().eq(0).children().eq(0).height(),this.els.container[0].scrollTop=(Math.floor((this.els.container[0].scrollTop+c)/c)+b.Constants.PARTIAL_VISIBLE_ROW_HEIGHT-1)*c),gb.accessibility.trigger("AccessibilityAction","focusListItem",
{bottomSheetObject:this})):this.animate();k.history&&"function"===typeof history.pushState&&(k.history.state&&k.history.state.bottom_sheet_open||k.history.pushState({bottom_sheet_open:1},"",""))}},registerEvents:function(){var a=this;a.isEventRegistered(this.els.background,"touchmove")||this.els.background.bind("touchmove",function(a){a.stopPropagation();a.preventDefault()});a.isEventRegistered(this.els.background,"click")||this.els.background.bind("click",function(b){a.isModalTranslating||b.target===
this&&a.close()});a.isEventRegistered(this.els.container,"scroll")||this.els.container.scroll(function(){a.scrollTransition()});a.isEventRegistered(this.els.modal,"touchstart")||this.els.modal.bind("touchstart",function(b){gb.resources.deviceInfo.isIOS&&(a.initialScrollPosition=b.originalEvent.touches[0].pageY);b.stopPropagation()});h.$(k).resize(function(){var b=h.$(k).height();a.setContainerProperties();a.els.background.css("max-height",b-a.minScrollableHeight);a.els.container[0].scrollTop=b*a.currentSheetHeightPercentage});
a.isEventRegistered(this.els.modal,"touchmove")||this.els.modal.bind("touchmove",function(b){b.stopPropagation();a.isModalTranslating&&b.preventDefault();a.isIphone&&(a.scrollDirection=b.originalEvent.touches[0].pageY===a.initialScrollPosition?0:b.originalEvent.touches[0].pageY<a.initialScrollPosition?1:-1,a.initialScrollPosition=b.originalEvent.touches[0].pageY)});this.isIphone&&!a.isEventRegistered(this.els.modal,"touchend")&&this.els.modal.bind("touchend",function(b){var c=0;-1===a.scrollDirection?
c=-a.els.container[0].scrollTop:1===a.scrollDirection&&(c=a.maxScrollTopPosition-a.els.container[0].scrollTop);0!==c&&(a.isModalTranslating=!0,a.els.modal.addClass("scrollTransition"),a.els.background.addClass("scrollTransition"),a.els.modal.css(a._getTranslateCss(-c+"px")),a.els.background.css(a._getTranslateCss(-c+"px")),a.els.modal.bind("transitionend webkitTransitionEnd",function(b){a.isModalTranslating=!1;a.scrollDirection=0;a.els.modal.removeClass("scrollTransition");a.els.background.removeClass("scrollTransition");
a.els.modal.css(a._getTranslateCss(0));a.els.background.css(a._getTranslateCss(0));a.els.container[0].scrollTop+=c;a.els.modal.unbind("transitionend webkitTransitionEnd")}))})},animate:function(){var a=h.$(k).height(),b=this.Constants.SHEET_MAX_HEIGHT_RATIO*a,c;this.modalHeight>b?(c=this.els.contents.children().eq(0).children().eq(0).height(),b=Math.ceil((b-this.els.header.outerHeight()-this.els.footer.height())/c)*c+c*this.Constants.PARTIAL_VISIBLE_ROW_HEIGHT+this.els.header.outerHeight()+this.els.footer.height(),
b>this.modalHeight&&(b=this.modalHeight),this.els.modal.css("height",b)):b=this.modalHeight;this.els.contents.css("padding-bottom",this.els.footer.height()+"px");this.currentSheetHeightPercentage=b/(a-this.minScrollableHeight);var d=this;setTimeout(function(){d.isModalTranslating=!0;d.els.modal.addClass("slideAnimateUp");d.els.background.addClass("slideAnimateUp");d.els.modal.css(d._getTranslateCss(-b+"px"));d.els.background.css(d._getTranslateCss(-b+"px"))},d.Constants.ANIMATE_TIMEOUT);this.els.modal.bind("transitionend webkitTransitionEnd",
function(c){d.isModalTranslating=!1;d.els.modal.removeClass("slideAnimateUp");d.els.background.removeClass("slideAnimateUp");d.els.modal.css(d._getTranslateCss(0));d.els.background.css(d._getTranslateCss(0));h.$("body").append(d.els.footer);d.els.modal.css("height","100%");d.els.container[0].scrollTop=b;c=d.els.container[0].scrollTop;d.els.background.css("max-height",a-d.minScrollableHeight);d.els.container[0].scrollTop=c-d.minScrollableHeight;d.els.modal.unbind("transitionend webkitTransitionEnd");
gb.accessibility.trigger("AccessibilityAction","focusListItem",{bottomSheetObject:d})})},scrollTransition:function(){var a=h.$(k).height(),b=this.els.container[0].scrollTop;this.currentSheetHeightPercentage=b/(a-this.minScrollableHeight);b>=parseInt(this.els.background.css("max-height"),10)-this.Constants.SCROLL_TOP_BUFFER&&(this.els.container[0].scrollTop=a,this.isIphone&&this.els.modal.unbind("touchstart touchmove touchend"),this.els.container.css({overflow:"hidden"}),this.els.contents.css({"overflow-y":"scroll"}),
a=k.matchMedia&&k.matchMedia("(orientation: portrait)").matches,gb.resources.deviceInfo.isIOS&&(/iPod/.exec(gb.resources.deviceInfo.userAgent)||a&&h.$(k).height()<gb.enums.Constants.LOWER_END_IOS_MIN_HEIGHT||!a&&h.$(k).width()<gb.enums.Constants.LOWER_END_IOS_MIN_HEIGHT)||this.els.contents.css({"-webkit-overflow-scrolling":"touch"}))},close:function(){var a=this;if(a.isBottomSheetDomPresent()){k.history.state&&k.history.state.bottom_sheet_open&&(gb.globalFlags.ignoreBottomSheet=!0,k.history.back());
this.els.modal.append(h.$("."+this.elClasses.footer));var b=a.els.container[0].scrollTop;this.els.background.css({"max-height":h.$(k).height()});a.els.container[0].scrollTop=b+a.minScrollableHeight;this.els.modal.bind("transitionend webkitTransitionEnd",function(b){a.isModalTranslating=!1;a.els.container[0].scrollTop=0;a.els.currentSheetHeightPercentage=0;a.els.background.unbind("click");a.isIphone&&a.els.modal.unbind("touchstart touchmove touchend");a.els.modal.unbind("transitionend webkitTransitionEnd");
a.removeContent()});setTimeout(function(){a.isModalTranslating=!0;a.parentEle.css({height:"",overflow:""});a.parentEle.removeClass("parentElementProp");h.$("body")[0].scrollTop=a.bodyScrollPosition;a.els.modal.addClass("slideAnimateDown");a.els.background.addClass("slideAnimateDown");a.els.modal.css(a._getTranslateCss(a.els.container[0].scrollTop+"px"));a.els.background.css(a._getTranslateCss(a.els.container[0].scrollTop+"px"))},20)}},removeContent:function(){this.els.container.remove()},_getTranslateCss:function(a){a=
"translate3d(0,"+a+", 0)";return{"-webkit-transform":a,"-o-transform":a,"-moz-transform":a,"-ms-transform":a,transform:a}},setContainerProperties:function(){var a=h.$(k).height();this.els.container.css({"max-height":a,overflow:"auto"});this.els.background.css("height",a);this.els.modal.css("max-height",a);this.els.contents.css({"max-height":a-this.els.header.outerHeight(),overflow:"hidden"});this.minScrollableHeight=this.els.footer.height()+this.els.header.outerHeight()+this.els.contents.children().eq(0).children().eq(0).height();
this.maxScrollTopPosition=this.els.contents.height()-this.els.contents.children().eq(0).children().eq(0).height()},isEventRegistered:function(a,b){var c=!1,d=h.$._data(a[0],"events");d!==q&&d[b]!==q&&(c=!0);return c},isBottomSheetDomPresent:function(){return this.elClasses&&this.elClasses.container?h.$("."+this.elClasses.container).length:!1}})});p.when("A","GoldboxMobile3PAssets").register("gb-watch-deal-view",function(h,r){return h.createClass({defaults:{isWatchDealPopupRendered:null,domain:null,
key:null,watchDealPopupHandler:null},init:function(){this.domain=gb.enums.WatchDealViewKeys.GOLDBOX_DOMAIN;this.key=gb.enums.WatchDealViewKeys.DISMISS_WATCHPOPUP_KEY;this.isWatchDealPopupRendered=!1;this._handleWatchUnwatchActions();h.on.afterLoad(function(){gb.controller.watchDealView&&!gb.controller.watchDealView.isWatchDealPopupRendered&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.SHOW_WATCH_POPUP)&&(gb.controller.watchDealView.isWatchDealPopupRendered=!0)})},
_handleWatchUnwatchActions:r._.once(function(){h.on("a:popover:dismiss:watch_preload",function(f){f=gb.controller.watchDealView;var a=k.dealNotifier;f.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP);gb.watchDealService.modifyPopupStatus({action:gb.enums.SembuActions.SET_COOKIE,type:gb.enums.DataTypes.BOOL,value:1,key:f.key,domain:f.domain});gb.resources.customerData.isWatchDealPopupMarked=!0;a&&a.watchDealNotifier&&a.watchDealNotifier.registerWatchDeals([])});p.when("A","a-popover",
"ready").execute(function(f,a){gb.controller.watchDealView.watchDealPopupHandler=a})}),changeWatchPopupState:function(f){if(gb.controller.watchDealView.watchDealPopupHandler){var a=gb.controller.watchDealView.watchDealPopupHandler.get(h.$("#"+gb.enums.WatchDealViewIDs.WATCH_POPOVER));if(a){switch(f){case gb.enums.WatchDealPopoverActions.SHOW_WATCH_POPUP:a.lock().show();break;case gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP:a.unlock().hide();break;case gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP:a.lock().show().updatePosition()}return!0}}return!1},
resetWatchDealVariables:function(){gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP)&&(gb.controller.watchDealView.isWatchDealPopupRendered=!1)},triggerMouseEventsOnWatchingDeal:function(f,a,b){"mouseenter"===b?(a.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+f).html(gb.resources.getString("gb_stop_watching_deal")),a.find("#"+gb.enums.WatchDealViewIDs.WATCHING_IMAGE+f).removeClass("watchingImage").addClass("stopWatchingImage"),a.find(".watchingText").removeClass("watchingText").addClass("stopWatchingText")):
"mouseleave"===b&&(a.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+f).html(gb.resources.getString("gb_watching_deal")),a.find("#"+gb.enums.WatchDealViewIDs.WATCHING_IMAGE+f).removeClass("stopWatchingImage").addClass("watchingImage"),a.find(".stopWatchingText").removeClass("stopWatchingText").addClass("watchingText"))},_isPopupTriggerRequired:function(f){return!(gb.resources.customerData.isWatchDealPopupMarked||gb.controller.watchDealView.isWatchDealPopupRendered)&&gb.controller.schedulingParams[f.widgetID].fetchWatchedDeals},
_isPopupTriggerRequiredForMiniDP:function(f){return!gb.resources.customerData.isWatchDealPopupMarked&&gb.controller.schedulingParams[f.widgetID].fetchWatchedDeals}})});p.when("A","GoldboxMobile3PAssets","gb-event-emitter").register("gb-metadata",function(h,r,f){var a=r._;return f.extend({sortedDealIDs:{},sortedGiveawayDealIDs:{},dealIDLocations:{},selectedDealsCount:{},binningInfo:{},dealsByType:{},dealsByState:{},dealsByAccessType:{},metadataResponse:{},watchedDeals:{},dealCategoryHash:{},init:function(){this._super();
this.registerConnections()},registerConnections:function(){this.on("ConsumeMetadataChange",this.updateMetadata);this.on("RefreshWatchedDealWidgets",this.updateWatchDealWidgets)},parseSortedDealIDs:function(b,c){var d=gb.controller.schedulingParams[b],e=d.prioritizedDealIDs;if(gb.controller.isPaginatedMetadataCall(b)){if(e.length){var g=this.dealsByState[gb.enums.DealStates.AVAILABLE];c.sortedDealIDs=a.intersection(c.sortedDealIDs,g)}}else e.length&&(g=c.dealsByState[gb.enums.DealStates.AVAILABLE],
e=a.intersection(e,g),e.length&&(c.sortedDealIDs=a.union(e,c.sortedDealIDs))),d.enforceLimitedDeals&&(c.sortedDealIDs=c.sortedDealIDs.slice(0,d.pageSize))},registerMetadata:function(b,c,d){"undefined"===typeof d&&(d=!0);this.metadataResponse[b]=c;var e=gb.controller.schedulingParams[b];e.enableDeDuping&&(c.sortedDealIDs=this.deDupeDeals(c.sortedDealIDs,b));if(gb.controller.isPaginatedMetadataCall(b)){this.sortedDealIDs[b]=c.sortedDealIDs||[];this.sortedGiveawayDealIDs[b]=c.sortedGiveawayDealIDs||
[];a.isEmpty(this.sortedGiveawayDealIDs[b])||gb.utils.mergeGiveawayWithGdmResponse(c,this.sortedGiveawayDealIDs[b],e,b);if(!e.enforceLimitedDeals){var g=c.selectedDealsCount?parseInt(c.selectedDealsCount,10):0,l=e.pageSize,f=0;1<e.page&&e.fetchSinglePage&&(f=(e.page-1)*l);this.sortedDealIDs[b]=gb.utils.getExtendedArray(g,this.sortedDealIDs[b],f)}c.binning&&(this.binningInfo[b]=c.binning);gb.controller.totalDealsToShow[b]=this.getAllDisplayableDealIDs(b).length}else this.registerSortedDealIDs(b,c),
this.registerDealCategoryHashMap(c),this.populateIsDigitalDeals();this.registerDealIDLocations(b);this.selectedDealsCount[b]=parseInt(c.selectedDealsCount,10)||0;gb.controller.trigger("WidgetPageUpdate",b,d)},registerSortedDealIDs:function(b,c){var d=this,e=gb.controller.widgetCurrentStatus[b],g=gb.controller.widgetCurrentCategory[b],l=c.dealsByState[e.toUpperCase()]||[];d.sortedDealIDs[b]={};d.sortedDealIDs[b][e]={};e===gb.enums.StatusFilters.AVAILABLE?(l=l.concat(c.dealsByState.UPCOMING||[]),d._isWidgetScheduledWithDOTD(b)&&
!gb.utils.isWidgetWithStatusFilter(gb.widgets[b].widgetName)&&(l=l.concat(c.dealsByState.SOLDOUT))):e===gb.enums.StatusFilters.MISSED&&(l=c.dealsByState[e.toUpperCase()]||[],l=l.concat(c.dealsByState.SOLDOUT));var f=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS;g!==gb.enums.CategoryFilters.ALL&&g!==f?l=a.intersection(l,c.dealsByCategory[g]):g===f&&(l=a.intersection(l,d.metadataResponse.dealsByAccessType[f]));d.sortedDealIDs[b][e][g]=a.intersection(c.sortedDealIDs,l);a.each(d.sortedDealIDs[b][e][g],
function(a,c){d.registerDealIDLocation(a,b,e,g,c)})},registerDealIDLocations:function(b){var c=this;gb.controller.isPaginatedMetadataCall(b)?a.each(c.sortedDealIDs[b],function(a,e){c.dealIDLocations[a]=c.dealIDLocations[a]||{};c.dealIDLocations[a][b]=e}):a.each(c.sortedDealIDs[b],function(d,e){a.each(d,function(d,l){a.each(d,function(a,d){c.registerDealIDLocation(a,b,e,l,d)})})})},registerDealCategoryHashMap:function(b){var c=this;a.each(b.dealsByCategory,function(b,e){a.each(b,function(b){c.dealCategoryHash[b]||
(c.dealCategoryHash[b]=[]);-1===a.indexOf(c.dealCategoryHash[b],e)&&c.dealCategoryHash[b].push(e)})})},populateIsDigitalDeals:function(){a.each(this.dealCategoryHash,function(a,c){gb.controller.getDealDAO(c).isDigital=gb.utils.hasDigitalCategory(a)})},registerWatchedDeals:function(b){var c=a.flatten(b);b[gb.enums.Constants.ALL]=c;this.watchedDeals=b;a.each(c,function(a){gb.controller.getDealDAO(a).isDealWatched=!0})},updateWatchedDeals:function(b){var c,d,e=this.watchedDeals;d=gb.controller.dealDAOs[b];
c=a.keys(gb.widgets);d.isDealWatched?(d=gb.enums.WatchedDealStateMap.UPCOMING,e.ALL=a.union(e.ALL,[b]),e[d]=e[d]||[],e[d]=a.union(e[d],[b])):(d=gb.enums.WatchedDealStateMap[d.dealState],e.ALL=a.without(e.ALL,b),e[d]=a.without(e[d],b));this.trigger("RefreshWatchedDealWidgets",c,b)},refreshWatchedDeals:function(b){var c=this,d=gb.metrics.generateRef(b,gb.metrics.refTags.getWatchedDeals,["ALL"]);gb.service.getWatchedDeals(function(b,d,l){gb.metadata.registerWatchedDeals(b);b=a.keys(gb.widgets);a.each(b,
function(a){var b=gb.controller.schedulingParams[a];if(b.watchedDealsWidget||gb.utils.isWatchedDealsTab(a))b=gb.utils.getWatchedDealWidgetData(b.dealStates),c.registerMetadata(a,b)})},function(){var a=gb.utils.getWatchedDealWidgetData(gb.controller.schedulingParams[b].dealStates);gb.metadata.registerMetadata(b,a,!0)},d)},updateWatchDealWidgets:function(b,c){var d=this,e=gb.controller.dealDAOs[c],g=gb.enums.WatchedDealStateMap[e.dealState],l=!1,f=gb.metadata.watchedDeals.ALL.length;if(0===f||1===f&&
e.isDealWatched)l=!0;a.each(b,function(b){var f=gb.controller.schedulingParams[b];if(f.watchedDealsWidget||gb.utils.isWatchedDealsTab(b)){var n=gb.utils.getWatchedDealStates(f.dealStates),f=d.getAllDisplayableDealIDs(b),h=a.indexOf(f,c);if((n=a.contains(n,g))||-1!==h){var r=!0;n&&e.isDealWatched&&-1===h?f.unshift(c):e.isDealWatched&&n||-1===h?r=!1:f.splice(h,1);if(r){var p={sortedDealIDs:f,selectedDealsCount:f.length,dealsByState:{}};p.dealsByState[gb.enums.DealStates.AVAILABLE]=f;gb.widgets[b].dealViews[c]&&
gb.metadata.watchedDeals.ALL&&gb.metadata.watchedDeals.ALL.length?(a.each(gb.widgets[b].dealViews[c],function(a){a.viewElement.slideUp(200)}),k.setTimeout(function(){d.registerMetadata(b,p)},200)):d.registerMetadata(b,p)}}else l&&gb.controller.trigger("WidgetPageUpdate",b,!0)}})},getSortedDealIDs:function(a,c){c||(c=gb.controller.widgetCurrentPage[a]||0);var d=gb.controller.schedulingParams[a],e=2;gb.configManager.getWidgetViewConfig(a).fetchSinglePageDeals&&(e=1);var g=d.pageSize||0,l=g*(c-1),e=
l+g*e;return(g=this.getAllDisplayableDealIDs(a))?d.enforceLimitedDeals?g:g.slice(l,e):[]},getAllDisplayableDealIDs:function(b){var c=[];if(gb.controller.isPaginatedMetadataCall(b)){var c=this.sortedDealIDs[b],d=this.dealsByType[gb.enums.DealTypes.DOTD]||[],e=this.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD]||[],g=gb.controller.schedulingParams[b];g.enforceLimitedDeals&&g.showDoubleCellDOTD&&(c=this._rearrangeDealIds(b,c,a.union(d,e)));return c||[]}d=gb.controller.widgetCurrentStatus[b];
e=gb.controller.widgetCurrentCategory[b];d&&e&&this.sortedDealIDs[b][d]&&this.sortedDealIDs[b][d][e]&&(c=this.sortedDealIDs[b][d][e]);return this._insertBlankDealIDs(b,c||[])},getMetadataCategories:function(a){var c=[];if(!gb.controller.isPaginatedMetadataCall(a)){var d=gb.controller.widgetCurrentStatus[a];this.metadataResponse[a]&&(this.registerFullMetadata(this.metadataResponse[a],a),this.metadataResponse[a]=null);for(var e=0;e<gb.resources.categories.length;e++){var g=gb.resources.categories[e].nodeId;
this.sortedDealIDs[a][d]&&this.sortedDealIDs[a][d][g]&&c.push(g)}}return c},getDealIDPosition:function(a,c){if(a){var d=this.dealIDLocations[a];if(gb.controller.isPaginatedMetadataCall(c))return d[c];var e=gb.controller.widgetCurrentStatus[c],g=gb.controller.widgetCurrentCategory[c];if(d&&d[c]&&d[c][e]&&null!==d[c][e][g]&&d[c][e][g]!==q)return d[c][e][g]}return-1},_insertBlankDealIDs:function(a,c){var d,e=gb.controller.widgetCurrentPage[a],g=gb.controller.schedulingParams[a].pageSize;gb.widgets[a]&&
gb.widgets[a].widgetGroupID&&this.selectedDealsCount[a]>c.length&&(d=gb.utils.getExtendedArray(this.selectedDealsCount[a],c,g*(e-1)));return d||c},updateMetadata:function(b,c,d,e){var g=gb.widgets[b],l=gb.controller.schedulingParams[b],f=e.metaParams;a.isEmpty(this.sortedGiveawayDealIDs[b])||f!==q&&(!f||f.isPageChange)||gb.utils.mergeGiveawayWithGdmResponse(c,this.sortedGiveawayDealIDs[b],l,b);f&&f.callDataArray?(gb.widgetHelper.callBins[b][f.callID]=c.sortedDealIDs||[],l.enableDeDuping&&(gb.widgetHelper.callBins[b][f.callID]=
this.deDupeDeals(gb.widgetHelper.callBins[b][f.callID],b)),this.sortedDealIDs[b]=gb.widgetHelper.buildSortedDealsArray(b,g.dealsPerRow),gb.widgetHelper.callID[b]++,gb.widgetHelper.fetchCallDataArrayDeals(b)):(l.enableDeDuping&&(c.sortedDealIDs=this.deDupeDeals(c.sortedDealIDs,b)),f&&f.isPageChange?(f=this.sortedDealIDs[b],e=e.dealsPerPage?e.dealsPerPage:l.pageSize,l=(c.page-1)*e,c=this.restrictDeals(b,c,e),this.sortedDealIDs[b]=gb.utils.getExtendedArray(c.selectedDealsCount,c.sortedDealIDs,l,f),c.binning=
this.getBinningInfo(b)):(c=this.restrictDeals(b,c),this.sortedDealIDs[b]=gb.utils.getExtendedArray(c.selectedDealsCount,c.sortedDealIDs)));this.selectedDealsCount[b]=this.sortedDealIDs[b].length;this.binningInfo[b]=c.binning;this.registerDealIDLocations(b);(g=g.widgetGroupID)&&gb.filterController.models[g].populateAvailableFilters(c.binning);"function"===typeof d&&d(b)},getDOTDCount:function(b){return a.intersection(a.union(this.dealsByType[gb.enums.DealTypes.DOTD]||[],this.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD]||
[]),b).length},getBinningInfo:function(a){return this.binningInfo[a]},isCurrentWindowFull:function(a,c,d){if(!(this.sortedDealIDs[a]&&this.sortedDealIDs[a]instanceof Array))return!1;c=(c-1)*d;a=this.sortedDealIDs[a].slice(c,c+d);for(d=0;d<a.length;)if(!a[d++])return!1;return!0},_rearrangeDealIds:function(b,c,d){d=a.intersection(c,d);var e=gb.widgets[b].dealsPerRow,g=0;0<d.length&&a.each(d,function(b){g+=1;b=a.indexOf(c,b);if(0===(b+g)%e&&b<c.length){var f=1;if(!(b+f>=c.length)){for(;a.contains(d,
c[b+f])&&!(f++,b+f>=c.length););b+f<c.length&&(f=c.splice(b+f,1),c.splice(b,0,f))}}});return c},registerFullMetadata:function(b,c){var d=gb.enums.StatusFilters;this.sortedDealIDs[c][d.AVAILABLE]={};this.sortedDealIDs[c][d.UPCOMING]={};this.sortedDealIDs[c][d.MISSED]={};var e=b.dealsByState.AVAILABLE||[],g=b.dealsByState.UPCOMING||[],l=b.dealsByState.EXPIRED||[],e=e.concat(g);this._isWidgetScheduledWithDOTD(c)&&!gb.utils.isWidgetWithStatusFilter(gb.widgets[c].widgetName)?e=e.concat(b.dealsByState.SOLDOUT):
l=l.concat(b.dealsByState.SOLDOUT);this.sortedDealIDs[c][d.MISSED][gb.enums.CategoryFilters.ALL]=a.intersection(b.sortedDealIDs,l);this.sortedDealIDs[c][d.UPCOMING][gb.enums.CategoryFilters.ALL]=a.intersection(b.sortedDealIDs,g);this.sortedDealIDs[c][d.AVAILABLE][gb.enums.CategoryFilters.ALL]=a.intersection(b.sortedDealIDs,e);this.registerCategories(b,c);this.registerDealIDLocations(c)},registerCategories:function(b,c){for(var d=gb.enums.StatusFilters,e=gb.enums.CategoryFilters,g=this.sortedDealIDs[c][d.AVAILABLE][e.ALL],
l=this.sortedDealIDs[c][d.UPCOMING][e.ALL],e=this.sortedDealIDs[c][d.MISSED][e.ALL],f=1;f<gb.resources.categories.length;f++){var h=gb.resources.categories[f].nodeId;b.dealsByCategory[h]&&(this.sortedDealIDs[c][d.AVAILABLE][h]=a.intersection(g,b.dealsByCategory[h]),this.sortedDealIDs[c][d.UPCOMING][h]=a.intersection(l,b.dealsByCategory[h]),this.sortedDealIDs[c][d.MISSED][h]=a.intersection(e,b.dealsByCategory[h]))}f=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS;if(h=b.dealsByAccessType[f])this.sortedDealIDs[c][d.AVAILABLE][f]=
a.intersection(g,h),this.sortedDealIDs[c][d.UPCOMING][f]=a.intersection(l,h),this.sortedDealIDs[c][d.MISSED][f]=a.intersection(e,h)},registerDealIDLocation:function(a,c,d,e,g){this.dealIDLocations[a]||(this.dealIDLocations[a]={});this.dealIDLocations[a][c]||(this.dealIDLocations[a][c]={});this.dealIDLocations[a][c][d]||(this.dealIDLocations[a][c][d]={});this.dealIDLocations[a][c][d][e]=g},_isWidgetScheduledWithDOTD:function(b){var c=!1;a.contains(gb.controller.schedulingParams[b].dealTypes,gb.enums.DealTypes.DOTD)&&
(c=!0);return c},deDupeDeals:function(b,c){var d=this;a.each(gb.widgets,function(e){if(e.widgetID!==c||gb.controller.schedulingParams[c].enforceLimitedDeals)b=a.difference(b,d.sortedDealIDs[e.widgetID])});return b},restrictDeals:function(a,c,d){var e=gb.controller.schedulingParams[a];a=c.page;var e=(e=e.widgetTabConfig[e.widgetCurrentTab])?e.launchCellIndex:0,g;d&&a&&(g=d*(a-1));e&&c.selectedDealsCount>e&&(c.selectedDealsCount=e,g&&e>g&&(e-=g),c.sortedDealIDs.splice(e));return c}})});p.when("A","GoldboxMobile3PAssets").register("gb-service",
function(h,r){var f=r._;return h.createClass({clientID:null,customerID:null,statusPollTimeoutValue:2E3,statusPollCache:[],getDealsTimeoutValue:500,getDealsCache:[],dealsWithDetails:{},maxDealIDsLength:12,getDealsMaxJitter:null,apis:{GDM:{name:"GetDealMetadata",maxRetries:3,baseRetryInterval:4E3,ajaxTimeout:6E4},GDS:{name:"GetDealStatus",maxRetries:0,baseRetryInterval:12E3,ajaxTimeout:6E4},GD:{name:"GetDeals",maxRetries:3,baseRetryInterval:4E3,ajaxTimeout:6E4},CD:{name:"ClaimDeal",maxRetries:2,baseRetryInterval:1E4,
ajaxTimeout:6E4},WD:{name:"WatchDeal",maxRetries:2,baseRetryInterval:1E4,ajaxTimeout:6E4},GWD:{name:"GetWatchedDeals",maxRetries:0,baseRetryInterval:0}},init:function(){this.marketplaceID=gb.resources.getCustomerData("marketplaceId");this.sessionID=gb.resources.getCustomerData("sessionId");this.customerID=gb.resources.getCustomerData("customerId");this.getDealsMaxJitter=gb.enums.Constants.GET_DEALS_MAX_JITTER;this.overrideAPIConfigsFromG2S2()},setClientID:function(a){this.clientID=this.clientID||
gb.enums.ClientIDPrefix+"_"+a},_ajaxWithRetries:function(a,b,c){var d=this,e=new Date,g=0,l=d.apis[a],f=b.retry,w=b.error;c.retry&&g++;delete b.error;delete b.retry;l.ajaxTimeout&&(b.timeout=l.ajaxTimeout);(function B(){b.url=gb.utils.setUrlParam(b.url,"nocache",(new Date).getTime());var a=b.success;b.success=function(l,f,n){if(l&&gb.utils.parseBool(l.retry))b.error();else{var h=0<g;c.latency=(new Date).getTime()-e.getTime();d._recordAPIMetrics(h,!0,c);a(l,f,n)}};b.error=function(a,h){var r=0<g;c.latency=
(new Date).getTime()-e.getTime();d._recordAPIMetrics(r,!1,c);b.url=gb.utils.setUrlParam(b.url,"retrying",1);"timeout"===h&&d._recordAPITimeoutMetrics(g);if(++g>l.maxRetries){var p="Request failing for "+c.apiName+".";r&&(p=p+" Retry number: "+g);w(Error(p+JSON.stringify(a)))}else r=d.getRetryInterval(g,l),"function"===typeof f&&f(),k.setTimeout(B,r)};h.$.ajax(b)})()},_buildAjaxRequestParams:function(a,b,c,d){a={success:c.success,error:c.error,retry:c.retry,url:a,type:"POST",dataType:"json"};c.beforeSend&&
(a.beforeSend=c.beforeSend);a.data=d?JSON.stringify(b):b;return a},getRetryInterval:function(a,b){return Math.pow(2,a-1)*(b.baseRetryInterval+gb.utils.getRandomNumber(-1E3,1E3))},callAPI:function(a,b,c,d){for(var e=[],g=0;g<b.length;g++)e.length===this.maxDealIDsLength&&(this[a](e,c,d),e=[]),e.push(b[g]);if(e.length)this[a](e,c,d)},getGetDealStatusRequestParam:function(a){a=a.sort();a=f.map(a,function(a){return{dealID:a}});a={requestMetadata:{marketplaceID:this.marketplaceID,clientID:this.clientID},
dealTargets:a,responseSize:"STATUS_ONLY",itemResponseSize:"DEFAULT_WITH_PREEMPTIVE_LEAKING"};this.customerID&&(a.requestMetadata.customerID=this.customerID);this.sessionID&&(a.requestMetadata.sessionID=this.sessionID);return a},GetDealStatusCall:function(a){if(a.length){var b=this,c=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GDS.name,d=this.getGetDealStatusRequestParam(a),e={apiName:this.apis.GDS.name},c=this._buildAjaxRequestParams(c,d,{success:function(b){var c=(new Date).getTime();f.each(a,function(a){var d=
gb.controller.getDealDAO(a);a=b.dealStatus[a];a.responseTimestamp=c;gb.translator.trigger("PopulateStatus",d,a)})},error:function(c){f.each(a,function(a){var c=gb.controller.dealDAOs[a],d=c.status.timeouts,e=c.status.cache.lastMsCacheTtl||b.apis.GDS.baseRetryInterval;e&&gb.watcher.dealsInView&&gb.watcher.dealsInView[c.dealID]&&(k.clearTimeout(d.cacheExpires),d.cacheExpires=k.setTimeout(function(){b.pollDealStatus(a)},e))})}},!0);this._ajaxWithRetries("GDS",c,e)}},getGetDealsRequestParam:function(a,
b){var c=!1,d=null,e=null;b&&(c=b.excludeCustomerID?b.excludeCustomerID:!1,b.widgetID&&(e=b.widgetID,d=gb.controller.schedulingParams[b.widgetID].eventID));a=a.sort();var g=f.map(a,function(a){return{dealID:a}}),g={requestMetadata:{marketplaceID:this.marketplaceID,clientID:this.clientID},dealTargets:g,responseSize:"ALL",itemResponseSize:"DEFAULT_WITH_PREEMPTIVE_LEAKING"};!c&&this.customerID&&(g.requestMetadata.customerID=this.customerID);this.sessionID&&(g.requestMetadata.sessionID=this.sessionID);
d&&(g.extendedAttributes=["hideAddToCart"]);e&&(g.widgetContext=this._getRequestParamsWidgetContext(e));return g},GetDealsCall:function(a,b,c){if(a.length){var d=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GD.name,e=this.getGetDealsRequestParam(a,b);b={apiName:this.apis.GD.name};d=this._buildAjaxRequestParams(d,e,{success:function(b){var d=(new Date).getTime();f.each(a,function(a){var c=gb.controller.getDealDAO(a);b.dealStatus[a].responseTimestamp=d;gb.translator.trigger("PopulateDealDAO",c,b.dealDetails[a],
b.dealStatus[a])});"function"===typeof c&&c(a)},error:function(a){throw a;}},!0);this._ajaxWithRetries("GD",d,b)}},getDealDetails:function(a){var b=this;f.contains(b.getDealsCache,a)||(b.getDealsCache.push(a),1===b.getDealsCache.length&&(a=Math.floor(Math.random()*b.getDealsMaxJitter*1E3),a+=b.getDealsTimeoutValue,k.setTimeout(function(){var a=[];f.each(b.getDealsCache,function(d){b.dealsWithDetails[d]||a.push(d)});b.getDealsCache=[];b.callAPI("GetDealsCall",a,{})},a)))},pollDealStatus:function(a){var b=
this,c=gb.controller.getDealDAO(a);c.dealType===gb.enums.DealTypes.EVENT||f.contains(b.statusPollCache,a)||gb.enums.DealStatesToFilterStates[c.dealState]===gb.enums.FilterStates.MISSED||(b.statusPollCache.push(a),1===b.statusPollCache.length&&k.setTimeout(function(){var a=new Date,e=[];f.each(b.statusPollCache,function(b){var l=c.status.dates.cacheExpires;0<=a.getTime()-l.getTime()&&e.push(b)});b.statusPollCache=[];b.callAPI("GetDealStatusCall",e)},b.statusPollTimeoutValue))},fetchDeals:function(a,
b,c){var d=this,e=new Date,g=[],l=[];f.each(a,function(a){a&&(d.dealsWithDetails[a]?gb.controller.getDealDAO(a).status.dates.cacheExpires.getTime()<=e.getTime()&&l.push(a):g.push(a))});"function"===typeof c&&c(f.difference(a,g));d.callAPI("GetDealsCall",g,{widgetID:b},c);d.callAPI("GetDealStatusCall",l)},claimDeal:function(a,b,c,d,e){e=gb.utils.setUrlParam("/gp/deal/ajax/claimDeal.html/ref="+e,"dealId",a.dealID);e=gb.utils.setUrlParam(e,"itemId",a.asin);a={apiName:this.apis.CD.name};b=this._buildAjaxRequestParams(e,
{},{success:b,error:c,retry:d},!0);this._ajaxWithRetries("CD",b,a)},watchDeal:function(a,b,c,d,e,g){var l=gb.enums.AJAXLinks.WATCH_DEAL+g;g={apiName:this.apis.WD.name};a={watchAction:b,dealId:a};gb.clientName!==gb.enums.MobileClients.PC&&gb.resources.customerData.isWatchedDealFirstRun&&(a.isWatchedDealFirstRun=!0);c=this._buildAjaxRequestParams(l,a,{success:c,error:d,retry:e,beforeSend:function(a){a.setRequestHeader("X-CSRFToken",gb.resources.customerData.csrfToken)}},!1);this._ajaxWithRetries("WD",
c,g)},getWatchedDeals:function(a,b,c){if(gb.service.customerID){var d={apiName:this.apis.GWD.name};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.GET_WATCHED+c,{},{success:a,error:function(){"function"===typeof b&&b();throw Error("Ajax call to fetch watched deals failed");}},!1);this._ajaxWithRetries("GWD",a,d)}else"function"===typeof b&&b()},fetchDealWithData:function(a,b,c){var d=this;b=gb.utils.validateFetchParam(a,b);b.dealsPerPage&&0<b.dealsPerPage?d.GetDealMetadataCall(a,b,function(e){b.priorityDeal&&
d.pushBuyBoxDealIDinGDMResponse(b.priorityDeal,e);var g=[],l=f.clone(e.sortedDealIDs);b.getDealsSize&&(l=l.slice(0,b.getDealsSize));d.fetchDeals(l,a,function(d){g=f.union(g,d);g.length===l.length&&gb.metadata.trigger("ConsumeMetadataChange",a,e,c,b)})}):c(a)},GetDealMetadataCall:function(a,b,c){var d=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GDM.name,e=this.getGetDealMetadataRequestParam(a,b),g={apiName:this.apis.GDM.name};e.version===gb.enums.Constants.PAGINATED_METADATA_VERSION&&(g.version=e.version);
b.isServersideGDMRetried&&(g.retry=!0);b=this._buildAjaxRequestParams(d,e,{success:function(b){gb.widgets[a].isGDMFailing=!1;gb.widgets[a].isRetryInProgress=!1;c(b)},error:function(b){gb.widgets[a].isGDMFailing=!0;gb.widgets[a].isRetryInProgress=!1;gb.widgets[a].showExcessiveTrafficMessage();throw b;},retry:function(){gb.widgets[a].isGDMFailing=!0;gb.widgets[a].isRetryInProgress=!0;gb.widgets[a].showExcessiveTrafficMessage()}},!0);this._ajaxWithRetries("GDM",b,g)},getGetDealMetadataRequestParam:function(a,
b){var c={requestMetadata:{clientID:this.clientID,marketplaceID:this.marketplaceID,sessionID:this.sessionID},queryProfile:{},sortOrder:gb.enums.SortOrders.BY_SCORE,version:gb.enums.Constants.PAGINATED_METADATA_VERSION,page:1,dealsPerPage:0};this.customerID&&(c.requestMetadata.customerID=this.customerID);var d=gb.controller.schedulingParams[a],e={enforcedCategories:"includedCategories",enforcedDealIDs:"includedDealIDs",enforcedMerchantIDs:"merchantIDs",expiredDealsDisplayDuration:"expiredDealLookBackHours",
exclusiveTargetArray:"exclusiveTargetValues",inclusiveTargetArray:"inclusiveTargetValues"};f.each("brands dealGroups dealStates dealTypes enforcedCategories excludedCategories enforcedDealIDs enforcedMerchantIDs excludedDealIDs excludedExtendedFilters excludedItemIDs exclusiveTargetArray expiredDealsDisplayDuration extendedFilters enforcedAccessTypes excludedAccessTypes includedAccessTypes includedCategories includedDealIDs inclusiveTargetTypes inclusiveTargetArray itemIDs merchantIDs includedBins eventID featuredOnly freeShippingEligibleOnly globalEligibleOnly maxPercentOff maxPrice minDuration minPercentOff minPrice minRating primeAccessType primeEligibleOnly fromTime toTime discountRanges priceRanges featuredDealsElevationSize".split(" "),
function(a){if("includedBins"!==a||!(d.eventID||b.metaParams&&b.metaParams.isPageChange)){var l=d[a];e[a]&&(a=e[a]);f.isObject(l)?f.isEmpty(l)||(l=gb.utils.removeNulls(l))&&(c.queryProfile[a]=l):l&&(c.queryProfile[a]=l)}});d.dealDisplay&&d.dealStatesDD&&(c.queryProfile.dealStates=d.dealStatesDD);d.expiringWithin&&0<d.expiringWithin&&(c.queryProfile.expiringWithin=d.expiringWithin);c.sortOrder=this._getRequestSortOrder(d.sortOrder,d.rankingStrategy);c.page=b.page;c.dealsPerPage=b.dealsPerPage;c.widgetContext=
this._getRequestParamsWidgetContext(a);c=gb.utils.sortRequestObj("",c);this._excludePrimeDOTDFromLDList(c);return c},_getRequestParamsWidgetContext:function(a){var b={},c=gb.controller.contentMetadata;f.isEmpty(c)||(c.pageType&&(b.pageType=c.pageType),c.subPageType&&(b.subPageType=c.subPageType),c.deviceType&&(b.deviceType=c.deviceType),c.originRef&&(b.refTag=c.originRef),c.originRID&&(b.refRID=c.originRID),c.browseNode&&(b.pageTypeID=c.browseNode));a=gb.metrics.widgetMetricsParams[a];f.isEmpty(a)||
(a.placementID&&(b.widgetID=a.placementID),a.slotName&&(b.slotName=a.slotName));return b},_excludePrimeDOTDFromLDList:function(a){a=a.queryProfile;if(a.dealTypes){var b=!1,c=a.dealTypes,d,e=0,g=c.length;a:for(;e<g;e++)if(d=c[e],d===gb.enums.DealTypes.LD)b=!0;else if(d===gb.enums.DealTypes.DOTD){b=!1;break a}b&&(a.excludedExtendedFilters||(a.excludedExtendedFilters={}),a.excludedExtendedFilters.MARKETING_ID?a.excludedExtendedFilters.MARKETING_ID.push("PRIME_ONLY_DOTD"):a.excludedExtendedFilters={MARKETING_ID:["PRIME_ONLY_DOTD"]})}},
_getRequestSortOrder:function(a,b){return f.contains(f.values(gb.enums.RankingStrategies),b)&&a===gb.enums.SortOrders.BY_SCORE?b:a},_generateAPIMetricName:function(a,b,c){var d="goldbox:";c.apiName&&(d+=c.apiName,c.version&&(d=d+":"+c.version),d=d+":"+(b?"success":"error")+":"+(a?"retry":"noretry"));d=d+":"+this.clientID;return d.toLowerCase()},_recordAPIMetrics:function(a,b,c){if(a=this._generateAPIMetricName(a,b,c))ue.count(a,(ue.count(a)||0)+1),c.latency&&ue.count(a+":time",c.latency)},pushBuyBoxDealIDinGDMResponse:function(a,
b){var c=b.sortedDealIDs;if(c&&c.length){var d=f.indexOf(c,a);0<=d&&(c.splice(d,1),b.selectedDealsCount--);c.unshift(a);b.selectedDealsCount++}else b.sortedDealIDs=[a],b.selectedDealsCount=1},overrideAPIConfigsFromG2S2:function(){var a=this,b=gb.resources.getAPIConfigs();f.isEmpty(b)||f.each(b,function(b){f.each(b,function(b,c){f.extend(a.apis[c],b)})})},_recordAPITimeoutMetrics:function(a){a="goldbox:ajaxTimeout:retry_"+a.toString()+":"+this.clientID;ue.count(a,(ue.count(a)||0)+1)}})});p.when("A").register("gb-mobile-notification-subscription-service",
function(h){return h.createClass({baseRetryInterval:2E4,continueRequests:!0,customerId:"",sessionId:null,timeout:3E5,init:function(h){this.sessionId=gb.resources.getCustomerData("sessionId");this.customerId=gb.resources.getCustomerData("customerId")},ajaxWithRetries:function(h){var f=this,a=new Date,b=0,c=h.retryInterval||this.baseRetryInterval||6E4;delete h.retryInterval;var d=h.error;delete h.error;var e=function(){f.continueRequests?(-1===h.url.indexOf("?")?h.url=h.url+"?nocache="+(new Date).getTime():
h.url=h.url+"&nocache="+(new Date).getTime(),h.error=function(g){g=c*(1+Math.pow(2,b++)*Math.random());g+(new Date).getTime()-a.getTime()>f.timeout?d(Error("timed out")):k.setTimeout(e,g)},k.P&&k.P.AUI_BUILD_DATE?p.when("jQuery").execute(function(a){a.ajax(h)}):jQuery.ajax(h)):d(Error("continueRequests is false: no more requests should be made."))};e()},call:function(h,f,a,b,c){h={success:a,error:b,url:h,type:"POST",data:JSON.stringify(f),dataType:"json"};c!==q&&(h.retryInterval=c);this.ajaxWithRetries(h)},
registerForNotifications:function(h,f,a){this.call("/gp/deal/ajax/registerForNotifications.html/ref=gb_mshop?customer="+this.customerId+"&sessionId="+this.sessionId+"&token="+h.pushToken+"&application="+h.appID+"&protocol="+h.protocol,{},f,a,this.baseRetryInterval)}})});p.when("A").register("gb-watch-deal-service",function(h){return h.createClass({modifyPopupStatus:function(k,f){h.post(gb.enums.AJAXLinks.UPDATE_EMBU,{success:f,error:function(){throw Error("get/set status of watchdeal popup failed");
},params:{action:k.action,key:k.key},dataType:"json"})},addWatchedDealOnLoginRedirect:function(h){if(gb.resources.deviceInfo.isApp)gb.resources.deviceInfo.isPhone?(h=encodeURIComponent(k.location.href.replace(/^http:/,"https:")),k.location.href=gb.utils.setUrlParam(gb.resources.urls.app_login_url,"openid.return_to",h)):(h=gb.utils.getWindowLocationOrigin(),k.location.href=gb.utils.setUrlParam(h,"app-action","login"));else{var f=gb.resources.getUrl("watching_login_redirect"),f=f.replace(/%257BmarketplaceID%257D/,
gb.resources.customerData.marketplaceId);k.location.href=f.replace(/%257BdealID%257D/,h)}}})});p.when("A","gb-mobile-notification-subscription-service").register("gb-notifications",function(h,r){return h.createClass({pushNotificationInfo:{},init:function(){this.mnssService=new r;this.getPushNotificationInfo()},subscribeNotifications:function(){this.getAppNotificationStatus()&&this.mnssService.registerForNotifications(this.pushNotificationInfo,function(){},function(){})},getPushNotificationInfo:function(f){var a=
this;p.when("mash").execute(function(b){k.amazon.mash.privateAPI&&k.amazon.mash.privateAPI.getPushNotificationInfo({successCallback:function(b){a.pushNotificationInfo=b;"function"===typeof f&&f()},failCallback:function(a){ue.count("goldboxDetailDeviceTokenUnavailable",(ue.count("goldboxDetailDeviceTokenUnavailable")||0)+1)}})})},invokePushNotificationInterstitial:function(f){var a=this;p.when("mash").execute(function(b){cordova.require("cordova/exec")(function(){gb.controller.getPushNotificationInfo(function(){a.subscribeNotifications();
f()})},function(){f()},"PushNotificationsIOS","invokePushNotificationInterstitial",[gb.resources.getString("gb-interstitial-title"),gb.resources.getString("gb-interstitial-subtitle"),"http://g-ec2.images-amazon.com/images/G/01/golbox/mshop/INTERSTITIAL_1X._V293550351_.png",["DEALS:waitlist"]])})},getAppNotificationStatus:function(){return"object"===typeof this.pushNotificationInfo&&!h.objectIsEmpty(this.pushNotificationInfo)}})});p.when("A","GoldboxMobile3PAssets").register("gb-watcher",function(h,
r){var f=r._;return h.createClass({viewPort:{},dealsInView:{},lowestDealIDWatchedIndex:{},changePage:function(a,b){var c=this;c.viewPort[a]=c.viewPort[a]||[];c.lowestDealIDWatchedIndex[a]=c.lowestDealIDWatchedIndex[a]||0;var d=f.compact(gb.metadata.getSortedDealIDs(a)),e=f.difference(c.viewPort[a],d),g=f.difference(d,c.viewPort[a]);c.viewPort[a]=d;d=f.last(d);d=gb.metadata.getDealIDPosition(d,a);d>c.lowestDealIDWatchedIndex[a]&&(c.lowestDealIDWatchedIndex[a]=d);f.each(e,function(b){c.dealsInView[b]&&
(c.dealsInView[b][a]=null,delete c.dealsInView[b][a],f.isEmpty(c.dealsInView[b])&&(c.dealsInView[b]=null,delete c.dealsInView[b]))});f.each(g,function(b){c.dealsInView[b]=c.dealsInView[b]||{};var d=gb.metadata.getDealIDPosition(b,a);-1!==d&&(c.dealsInView[b][a]=d)});c.unwireStatusRefresh(e);c.wireStatusRefresh(g);b()},wireStatusRefresh:function(a){var b=new Date;f.each(a,function(a){var d=gb.controller.getDealDAO(a);(a=d.status.dates.cacheExpires)&&d.dealType!==gb.enums.DealTypes.EVENT&&(a=a.getTime()-
b.getTime(),d.status.timeouts.cacheExpires=gb.utils.setSafeTimeout(function(){gb.service.pollDealStatus(d.dealID)},0>a?1:a))})},unwireStatusRefresh:function(a){f.each(a,function(a){a=gb.controller.getDealDAO(a);a.status.timeouts.cacheExpires&&(k.clearTimeout(a.status.timeouts.cacheExpires),a.status.timeouts.cacheExpires=null)})}})});p.when("A","GoldboxMobile3PAssets").register("gb-garbage-collector",function(h,r){var f=r._;return h.createClass({gcScopeSufix:"_GC",init:function(){this.garbageCollectedDealView=
{}},clearDealViews:function(a,b){!a||f.isEmpty(gb.widgets)||f.isEmpty(gb.widgets[a])||f.isEmpty(gb.widgets[a].dealViews)||(b===q&&(b=f.keys(gb.widgets[a].dealViews),gb.widgets[a].nextPositionToRender=0),f.each(b,function(b){gb.widgets[a].dealViews[b]&&(f.each(gb.widgets[a].dealViews[b],function(d,e){d.clock&&(k.clearTimeout(d.clock.timeout),d.clock=null);gb.widgets[a].dealViews[b][e]=null;delete gb.widgets[a].dealViews[b][e]}),delete gb.widgets[a].dealViews[b])}))},deepCleanDealViews:function(a,b){if(a&&
!f.isEmpty(gb.widgets)&&!f.isEmpty(gb.widgets[a])&&!f.isEmpty(gb.widgets[a].dealViews)&&b&&!f.isEmpty(b)){var c=[],d=gb.widgets[a],e;this.garbageCollectedDealView[a]||(this.garbageCollectedDealView[a]={});var g=this,l;f.each(b,function(b){d.dealViews[b]&&(c.push(b),g.garbageCollectedDealView[a][b]||(g.garbageCollectedDealView[a][b]={}),f.each(d.dealViews[b],function(c,d){(l=gb.utils.removeImage(c.viewElement))&&!g.garbageCollectedDealView[a][b][d]&&(e={imageContent:l.imageContent,imageContainer:l.imageContainer,
dealObject:c},g.garbageCollectedDealView[a][b][d]=e)}))});this.clearDealViews(a,c)}},clearViewPort:function(a){!a||f.isEmpty(gb.widgets)||f.isEmpty(gb.widgets[a])||null===gb.widgets[a].viewPortManager||(gb.subnavController&&gb.widgets[a].viewPortManager.clearHeaderInSubnav(),gb.widgets[a].viewPortManager.detachScroll(),gb.widgets[a].viewPortManager=null)},reRenderGCElement:function(a,b,c){var d,e="goldbox:"+((gb.widgets[a].widgetGroupID||gb.widgets[a].widgetName)+this.gcScopeSufix)+":imageRerender",
g=function(){ue.count(e,(ue.count(e)||0)+1);ue.count(e+":time",(new Date).getTime()-d)};if(a&&b&&!f.isNaN(parseInt(c,10))){var l=this.garbageCollectedDealView[a];if(l&&l[b]&&l[b][c])return d=(new Date).getTime(),gb.utils.addImage(l[b][c].imageContainer,l[b][c].imageContent,g),g=l[b][c].dealObject,delete l[b][c],f.isEmpty(l[b])&&delete l[b],f.isEmpty(l)&&delete this.garbageCollectedDealView[a],g}}})});p.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-deal-dao","gb-enums","gb-config-manager",
"goldboxResources","gb-watcher","gb-filter-controller","gb-garbage-collector","gb-metadata","gb-widget-factory","gb-service","gb-watch-deal-service","gb-notifications","gb-base-utils","gb-link-generator","gb-metrics","gb-share-manager","gb-metrics-manager","gb-utilities","gb-widget-clientside-helper","gb-template-manager","gb-dcs-translator","gb-bottomsheet-view","gb-view-component-builder","gb-watch-deal-view","gb-prime-utils","gb-accessibility","gb-badge-utils","gb-filter-utils").register("gb-controller",
function(h,r,f,a,b,c,d,e,g,l,n,w,K,B,x,y,v,t,A,E,D,m,u,F,G,H,L,I,J,C,M){var z=r._;return f.extend({nextWidgetID:100,schedulingParams:{},dealDAOs:{},totalDealsToShow:{},totalDisplayableDealsCount:{},widgetCurrentPage:{},widgetCurrentCategory:{},widgetCurrentStatus:{},widgetFilters:{},widgetName:{},pageOrientation:null,clientName:null,useHtmlRefineButton:!1,buyingDeals:{},bottomSheet:null,originRID:null,popOverVisible:!1,watchDealView:null,contentMetadata:{pageType:null,subPageType:null,originRef:null,
originRID:null,deviceType:null},init:function(a){this._super(a);gb.widgets={};this.contentMetadata.pageType=a.contentMetadata.pageType;this.contentMetadata.subPageType=a.contentMetadata.subPageType;this.contentMetadata.originRef=a.contentMetadata.refTag;this.contentMetadata.originRID=a.contentMetadata.originRID;this.contentMetadata.deviceType=a.contentMetadata.deviceType;this.instantiateFramework();this._handleActions();this.registerConnections();p.when("A","jQuery").execute(function(a,b){b(k).unload(function(){var a=
!1,a=z.any(gb.widgets,function(a){return a.isEventsWidget()});a||(a=gb.utils.setUrlParam(k.location.href,"nocache",(new Date).getTime()),gb.utils.pushAddressInBrowserHistory(a));gb.metricsManager.reportImpression()})});h.$(k).bind("popstate",function(a){var b=gb.controller.bottomSheet;b?h.$("."+b.elClasses.container).length&&!gb.globalFlags.ignoreBottomSheet&&b.close():z.isEmpty(a.originalEvent.state)||location.reload();gb.globalFlags.ignoreBottomSheet=!1})},instantiateFramework:function(){gb.globalFlags=
{};gb.enums=b;gb.resources=d;gb.baseUtils=y;gb.utils=D;gb.primeUtils=I;gb.badgeUtils=C;gb.metrics=gb.metrics||new t;gb.configManager=new c;gb.templateManager=new u;gb.metadata=new n;gb.service=new K;gb.translator=new F;gb.viewComponentBuilder=new H;gb.watcher=new e;gb.garbageCollector=new l;gb.metricsManager=new E;gb.widgetViewFactory=new w;gb.notifications=new x;gb.filterController=new g;gb.accessibility=new J;gb.filterUtils=M;p.register("GBEventManager",function(){return new f})},registerConnections:function(){this.on("WidgetPageUpdate",
this.updatePage);this.on("WidgetPageScroll",this.updateDealsInWidgetPage);this.on("WidgetResize",this.updateDealsInWidgetPage);this.on("WidgetCategoryChange",this.changeCategory);this.on("WidgetStatusChange",this.changeStatus);this.on("AllWidgetsLoaded",this._postAllWidgetsLoaded)},registerWidget:function(a,b){z.isEmpty(gb.metadata.watchedDeals)&&a.watchedDeals&&gb.metadata.registerWatchedDeals(a.watchedDeals);var c=null;isNaN(parseInt(a.schedulingParams.watchedDealsTab,10))||(c=parseInt(a.schedulingParams.watchedDealsTab,
10));if(a.schedulingParams.watchedDealsWidget||null!==c&&c===a.schedulingParams.widgetCurrentTab)a.dcsServerResponse=gb.utils.getWatchedDealWidgetData(a.schedulingParams.dealStates);var d=a.dcsServerResponse||{};d.sortedDealIDs=d.sortedDealIDs||[];d.dealsByCategory=d.dealsByCategory||{};d.dealsByAccessType=d.dealsByAccessType||{};d.dealsByState=d.dealsByState||{};d.binning=d.binning||{};a.dcsServerResponse=d;c=(this.nextWidgetID++).toString();gb.service.setClientID(gb.clientName||"");if(a.schedulingParams.maxJitter){var e=
parseInt(a.schedulingParams.maxJitter,10);e&&e>gb.enums.Constants.GET_DEALS_MAX_JITTER&&e>gb.service.getDealsMaxJitter&&(gb.service.getDealsMaxJitter=e)}gb.configManager.registerConfigs(a);a.templates&&gb.templateManager.registerTemplates(a.widgetName,a.templates);d.selectedDealsCount=isNaN(parseInt(d.selectedDealsCount,10))?0:parseInt(d.selectedDealsCount,10);this.totalDealsToShow[c]=d.selectedDealsCount;this.totalDisplayableDealsCount[c]=d.selectedDealsCount;this.widgetName[c]=a.widgetName;this.registerSchedulingParams(c,
a.schedulingParams,a.widgetViewConfig.dcsMetadataVersion);e=this.schedulingParams[c];a.schedulingParams=e;a.widgetID=c;e.fetchWatchedDeals&&(gb.controller.getWatchDealService(),gb.clientName===gb.enums.MobileClients.PC&&gb.controller.getWatchDealView());this.widgetFilters[c]=e.filterConfig||[];var g=gb.filterController.getWidgetGroupID(a);gb.widgets[c]=gb.widgetViewFactory.getWidgetView({widgetID:c,widgetGroupID:g,widgetName:a.widgetName,domElementID:a.domElementID,schedulingParams:e});gb.widgets[c].deprecateNoDealMsg=
b.gdmServiceLazyLoad;g&&gb.controller.isPaginatedMetadataCall(c)&&z.isEmpty(e.includedBins)&&(e.includedBins=gb.utils.getIncludedBins(e.filterConfig));gb.filterController.registerFilters(a,c,g);gb.metrics.registerWidgetMetricParams(c,a.domElementID);gb.translator.trigger("PopulateMetadata",c,d);gb.metadata.parseSortedDealIDs(c,d);gb.configManager.getWidgetViewConfig(c).callDataBuilder&&(gb.widgetHelper=gb.widgetHelper||new m,gb.widgetHelper.registerWidgetData(c,d));this.setInitialFilters(c);gb.metadata.registerMetadata(c,
d);gb.widgetHelper&&gb.widgetHelper.callDataArray[c]&&gb.widgetHelper.fetchCallDataArrayDeals(c);b.gdmServiceLazyLoad&&(delete gb.widgets[c].deprecateNoDealMsg,e.watchedDealsWidget?gb.controller.trigger("WidgetPageUpdate",c,!0):(b.isGDMFailing?(gb.widgets[c].isGDMFailing=!0,gb.widgets[c].isRetryInProgress=!0,gb.widgets[c].showExcessiveTrafficMessage()):gb.widgets[c].showLoading(),d={page:1,dealsPerPage:gb.configManager.getWidgetViewConfig(c).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[c].pageSize,
priorityDeal:b.prioritizedBuyboxDealID,isLazyLoadPageCall:!0,isServersideGDMRetried:b.isGDMFailing},this.fetchPage(d,c,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)})));gb.resources.getServerClientClkDifference()&&gb.utils.recordSkewedClockdifferences()},registerSchedulingParams:function(a,b,c){var d={adSlots:[],allowWidgetRefresh:!1,brands:[],customFilter:null,customRestrictionsApply:null,campaignSchedulingParams:{},dealDisplay:{},dealGroups:{},dealStates:[],dealTypes:[],disableMiniDP:!1,
disableRestrictionsApply:!1,disableSortFilter:!1,disableStatusFilter:!1,disableWidgetHeader:!1,discountRanges:[],displayFeaturedDeals:!1,enablePagination:!1,enableCategoryRefine:!0,enableDeDuping:!1,enableFilter:!1,enableHidingWidgetHeader:!1,enforcedAccessTypes:[],excludedAccessTypes:[],enforcedCategories:[],enforcedDealIDs:[],enforcedMerchantIDs:[],enforceLimitedDeals:!1,eventID:null,excludedCategories:[],excludedDealIDs:[],excludedExtendedFilters:{},exclusiveTargetKeys:[],exclusiveTargetValues:[],
exclusiveTargetArray:[],expiringWithin:0,expiredDealsDisplayDuration:0,extendedFilters:{},filterConfig:[],featureScope:null,featuredDealsElevationSize:null,fetchSinglePage:!1,fetchWatchedDeals:!1,fromTime:null,freeShippingEligibleOnly:!1,globalEligibleOnly:!1,giveawaySlots:[],includedAccessTypes:[],includedBins:[],inclusiveTargetKeys:[],inclusiveTargetValues:[],inclusiveTargetArray:[],isCritical:!1,maxJitter:2,maxLimitDeals:null,minRating:null,noDealsFilterMessage:null,noDealsMessage:null,page:1,
pageSize:4,priceRanges:[],primeAccessType:null,primeEligibleOnly:!1,prioritizedDealIDs:[],rankingStrategy:null,redirectLink:null,redirectPageTitle:null,redirectText:null,rowsOfDeals:1,refreshWidgets:null,seeAllText:null,shovelerEndText:null,widgetTabConfig:{},widgetCurrentTab:0,showDoubleCellDOTD:!1,showLaunchCell:!0,showHelpLink:!1,showShortCellView:!1,sortOrder:gb.enums.SortOrders.BY_SCORE,sortOptionsOverride:[],subnavPage:null,subnavPageSlot:null,subTitle:null,title:null,titleRedirectLink:null,
titleRedirectText:null,titleWithS:null,toTime:null,watchedDealsWidget:!1,watchedDealsTab:null,widgetAnchorName:null,widgetGroupID:null};z.each(d,function(a,c){null!==b[c]&&b[c]!==q&&(d[c]=b[c])});isNaN(parseInt(d.pageSize,10))||(d.pageSize=parseInt(d.pageSize,10));isNaN(parseInt(d.featuredDealsElevationSize,10))||(d.featuredDealsElevationSize=parseInt(d.featuredDealsElevationSize,10));isNaN(parseInt(d.expiredDealsDisplayDuration,10))||(d.expiredDealsDisplayDuration=parseInt(d.expiredDealsDisplayDuration,
10));isNaN(parseInt(d.subnavPage,10))||(d.subnavPage=parseInt(d.subnavPage,10));isNaN(parseInt(d.subnavPageSlot,10))||(d.subnavPageSlot=parseInt(d.subnavPageSlot,10));d.widgetTabConfig&&z.each(d.widgetTabConfig,function(a,b){isNaN(parseInt(a.launchCellIndex,10))&&(a.launchCellIndex=0)});isNaN(parseInt(d.watchedDealsTab,10))||(d.watchedDealsTab=parseInt(d.watchedDealsTab,10));isNaN(parseInt(d.widgetCurrentTab,10))||(d.widgetCurrentTab=parseInt(d.widgetCurrentTab,10));z.isEmpty(d.adSlots)||d.adSlots.sort(function(a,
b){return a.rowNumber<b.rowNumber?-1:a.rowNumber>b.rowNumber?1:0});var e=k.amazon&&k.amazon.mash?!0:!1;d.sortOptionsOverride.length&&!z.contains(d.sortOptionsOverride,d.sortOrder)&&(d.sortOrder=d.sortOptionsOverride[0]);isNaN(parseInt(d.maxLimitDeals,10))||(d.maxLimitDeals=parseInt(d.maxLimitDeals,10));d.enforceLimitedDeals?(null===d.redirectLink&&(d.redirectLink=(new v(gb.clientName)).generateRedirectLink(d,c)),this.widgetName[a]===gb.enums.WidgetNames.TAB_HERO&&null===d.redirectText&&(d.redirectText=
1===d.dealTypes.length&&d.dealTypes[0]===gb.enums.DealTypes.LD?gb.resources.getString("gb_tabhero_ld_redirect_text"):gb.resources.getString("gb_tabhero_bd_redirect_text")),d.redirectLink&&null===d.redirectPageTitle&&(d.redirectPageTitle=d.title),gb.resources.deviceInfo.isApp&&d.redirectLink&&d.redirectPageTitle&&e&&(d.redirectLink=gb.utils.setUrlParam(d.redirectLink,"app-title",encodeURIComponent(d.redirectPageTitle))),d.redirectLink=gb.utils.enforceUTFEncodingInUrl(d.redirectLink)):gb.controller.widgetName[a]===
gb.enums.WidgetNames.HERO&&(d.redirectLink=null,d.redirectText=null,d.redirectPageTitle=null);this.schedulingParams[a]=d},getDealDAO:function(b){this.dealDAOs[b]=this.dealDAOs[b]||new a(b);return this.dealDAOs[b]},updatePage:function(a,b){gb.watcher.lowestDealIDWatchedIndex[a]&&delete gb.watcher.lowestDealIDWatchedIndex[a];var c=gb.widgets[a];b&&(gb.garbageCollector.clearViewPort(a),c.renderWireFrame());z.isEmpty(gb.controller.schedulingParams[a].adSlots)||(c.nextAdSlotToRenderIndex=0);gb.controller.updateDealsInWidgetPage(a)},
updateDealsInWidgetPage:function(a,b){function c(){var b=gb.widgets[a];gb.watcher.changePage(a,function(){b.nextPositionToRender<gb.watcher.lowestDealIDWatchedIndex[a]+1&&b.renderContent();gb.service.fetchDeals(gb.watcher.viewPort[a],a)})}var d=b||this.widgetCurrentPage[a];this.isPaginatedMetadataCall(a)&&!gb.metadata.isCurrentWindowFull(a,d,this.schedulingParams[a].pageSize)?(d={page:d,dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[a].pageSize},
this.fetchPage(d,a,!0,c)):c()},changeCategory:function(a,b){this.widgetCurrentPage[a]=1;this.widgetCurrentCategory[a]=b;gb.controller.trigger("WidgetPageUpdate",a,!0);this.updateAppliedFilters(a)},changeStatus:function(a,b){this.widgetCurrentPage[a]=1;this.widgetCurrentStatus[a]=b;this.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;gb.controller.trigger("WidgetPageUpdate",a,!0);this.updateAppliedFilters(a)},refreshDealView:function(a,b){gb.controller.buyingDeals[a]||z.each(gb.watcher.dealsInView[a],
function(c,d){var e=gb.widgets[d].dealViews[a];e&&z.each(e,function(a){a.render()});gb.controller.refreshMiniDetailPageView(a,b)})},refreshDealStatusText:function(a,b){z.each(gb.watcher.dealsInView[a],function(c,d){var e=gb.widgets[d].dealViews[a];e&&z.each(e,function(a){a.updateStatusMessage(b)})})},refreshWatchDealStatus:function(a,b){z.each(gb.watcher.dealsInView[a],function(c,d){var e=gb.widgets[d].dealViews[a];e&&z.each(e,function(a){a.updateWatchDealStatusMessage(b)})})},refreshMiniDetailPageView:function(a,
b){gb.controller.buyingDeals[a]||z.each(gb.watcher.dealsInView[a],function(c,d){var e=gb.widgets[d].dealViews[a];p.when("A","a-modal").execute(function(c,d){z.each(e,function(c){var e=d.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+a);c&&e&&e.isActive()&&c.renderMiniDetailPage(b)})})})},fetchPage:function(a,b,c,d){var e={page:a.page,dealsPerPage:a.dealsPerPage,getDealsSize:a.getDealsSize,priorityDeal:a.priorityDeal,isLazyLoadPageCall:a.isLazyLoadPageCall,isServersideGDMRetried:a.isServersideGDMRetried,
metaParams:{isPageChange:!a.isLazyLoadPageCall}},g=gb.widgets[b],l=!1;!c||g.viewPortManager&&!a.isLazyLoadPageCall||(l=!0);gb.service.fetchDealWithData(b,e,function(){d&&d(b,l)})},getLoginURL:function(a,b){if(gb.resources.deviceInfo.isApp){if(gb.resources.deviceInfo.isPhone){var c=encodeURIComponent(k.location.href.replace(/^http:/,"https:"));return gb.utils.setUrlParam(gb.resources.urls.app_login_url,"openid.return_to",c)}c=gb.utils.getWindowLocationOrigin();return gb.utils.setUrlParam(c,"app-action",
"login")}if(gb.clientName===gb.enums.MobileClients.AW)return q;c=gb.resources.urls.login_url;c=c.replace(/%257BdealID%257D/,a);c=c.replace(/%257Basin%257D/,b);return c=c.replace(/%257BmarketplaceID%257D/,gb.resources.customerData.marketplaceId)},_updateNavCartQty:function(a){k.navbar&&"function"===typeof k.navbar.setCartCount&&k.navbar.setCartCount(a);p.when("mash").execute(function(b){b.cart.didUpdate({newCartQuantity:parseInt(a,10)})})},_showErrorOnAjaxFail:function(a){var b=this.dealDAOs[a];delete this.buyingDeals[a];
b.checkingDealStatus=!1;this.refreshDealView(a);p.when("mash").execute(function(a){a.showAlert({message:gb.resources.getString("gb_problem_adding_item_to_cart"),buttonTitles:[gb.resources.getString("gb_ok")],successCallback:h.$.noop})})},processActionableClick:function(a){var b=this,c=a.dealID,d=b.dealDAOs[c],e=a.dealType,g=gb.utils.getWindowLocationOrigin(),l=a.asin,f=gb.metrics.generateRef(a.widgetID,a.action||gb.metrics.refTags.addToCart,[c]),n=gb.widgets[a.widgetID].widgetGroupID,m=gb.widgets[a.widgetID];
"function"===typeof m.removeErrorMessage&&m.removeErrorMessage();if(!b.buyingDeals[c])if(e!==gb.enums.DealTypes.LD||gb.service.customerID)if(b.buyingDeals[c]=!0,e===gb.enums.DealTypes.EVENT)e=gb.metrics.addMetricsParams(gb.enums.AJAXLinks.ADD_TO_CART,a.widgetID,gb.metrics.refTags.addToCart,[c,n]),h.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a.success&&(d.isAddedToCart=!0,d.addActionMessage=d.postActionMessage=
gb.resources.getString("gb_item_added_to_cart"),b._updateNavCartQty(a.itemsInCart));b.refreshDealView(c)},error:function(){delete b.buyingDeals[c];d.checkingDealStatus=!1;d.postActionMessage=gb.resources.getString("gb-cart-error");b.refreshDealView(c)}});else if(d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&e===gb.enums.DealTypes.LD)gb.service.claimDeal(a,function(e){delete b.buyingDeals[c];if(e){var g=gb.translator.translateClaimDealStatus(d,a.asin,e);d.inCartAsin=a.asin;gb.translator.trigger("PopulateStatus",
d,g,b._registerDealWithNotifier);b.redemptionResponseHandler(d,a.asin,e.currentCartQuantity)}else d.checkingDealStatus=!1,b.refreshDealView(c)},function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;(a=gb.resources.getString("csld-all_retries_failed"))?(b.refreshDealStatusText(c,a),k.setTimeout(function(){b.refreshDealView(c)},3E3)):b.refreshDealView(c)},function(){var a=gb.resources.getString("csld-retrying_deal_status");a&&b.refreshDealStatusText(c,a)},f);else if(d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD)gb.service.claimDeal(a,
function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a&&(a.errorCode===gb.enums.Constants.NON_RETRYABLE_QUANTITY_RESTRICTION_VIOLATION_ERROR?(d.postActionMessage=gb.resources.getString("gb-podotd-quantity-restriction-violated-msg"),d.isOfferingRestrictionViolated=!0):d.postActionMessage=gb.resources.getString("gb-added-to-cart"),b._updateNavCartQty(a.currentCartQuantity));b.refreshDealView(c)},function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;(a=gb.resources.getString("csld-all_retries_failed"))?
(b.refreshDealStatusText(c,a),k.setTimeout(function(){b.refreshDealView(c)},3E3)):b.refreshDealView(c)},function(){var a=gb.resources.getString("csld-retrying_deal_status");a&&b.refreshDealStatusText(c,a)},f);else if(gb.resources.deviceInfo.doesAppHaveURLInterception){var e=gb.enums.AJAXLinks.ADD_TO_CART,w=gb.enums.MiscLinks.CART_URL;h.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a.success?(d.isAddedToCart=
!0,d.addActionMessage=gb.resources.getString("gb_item_added_to_cart"),amazon.mash.cart.didUpdate({newCartQuantity:parseInt(a.itemsInCart,10)}),gb.resources.deviceInfo.isIPad&&(k.location.href=decodeURIComponent(w)),b.refreshDealView(c),gb.resources.deviceInfo.isAndroid&&amazon.mash.showAlert({message:gb.resources.getString("gb_item_added_to_cart"),buttonTitles:[gb.resources.getString("gb_continue_shopping"),gb.resources.getString("gb_go_to_cart")],successCallback:function(a){1===a&&(k.location.href=
decodeURIComponent(w))}})):b._showErrorOnAjaxFail(c)},error:function(){b._showErrorOnAjaxFail(c)}})}else gb.resources.deviceInfo.isApp?(g=gb.utils.setUrlParam(g,"app-action","add-to-cart"),g=gb.utils.setUrlParam(g,"ref",f),g=gb.utils.setUrlParam(g,"asin",a.asin),g=gb.utils.setUrlParam(g,"offer-id",a.offerID),g=gb.utils.setUrlParam(g,"clickstream-tag","Deal"),k.location.href=decodeURIComponent(g),delete b.buyingDeals[c],d.checkingDealStatus=!1,b.refreshDealView(c)):(e=gb.metrics.addMetricsParams(gb.enums.AJAXLinks.ADD_TO_CART,
a.widgetID,gb.metrics.refTags.addToCart,[c,n]),h.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(e){if(e){delete b.buyingDeals[c];d.checkingDealStatus=!1;if(e.success)d.postActionMessage=gb.resources.getString("gb-added-to-cart"),b._updateNavCartQty(e.itemsInCart);else{d.cartError=!0;var g=gb.widgets[a.widgetID],l;e.cartItem&&e.cartItem.statusList&&(l=e.cartItem.statusList);!z.isEmpty(l)&&gb.utils.isOfferingRestrictionViolated(l)?(d.postActionMessage=gb.resources.getString("gb-quantity-restriction-violated",
{quantityLimit:e.cartItem.quantityRestriction}),d.isOfferingRestrictionViolated=!0):"function"===typeof g.renderErrorMessage&&g.renderErrorMessage()}b.refreshDealView(c)}},error:function(){delete b.buyingDeals[c];d.checkingDealStatus=!1;d.cartError=!0;var e=gb.widgets[a.widgetID];"function"===typeof e.renderErrorMessage&&e.renderErrorMessage();b.refreshDealView(c)}}));else g=b.getLoginURL(c,l),k.location.href=g,d.checkingDealStatus=!1,b.refreshDealView(c)},redemptionResponseHandler:function(a,b,c){var d=
a.customerState;a.detail.itemType===gb.enums.ItemTypes.VARIATION&&(b=a.getAsinDAO(b))&&(d=b.status.customerState);d===gb.enums.CustomerStates.INCART?(this._updateNavCartQty(c),p.when("jQuery").execute(function(b){b("#"+gb.enums.ChangeoverID.AddedToCart+a.dealID).show()})):d===gb.enums.CustomerStates.INWAITLIST&&(p.when("jQuery").execute(function(b){b("#"+gb.enums.ChangeoverID.Waitlisted+a.dealID).show()}),"object"!==typeof gb.controller.pushNotificationInfo||z.isEmpty(gb.controller.pushNotificationInfo)||
gb.notifications.subscribeNotifications())},_registerDealWithNotifier:function(a){k.dealNotifier&&(a.legacyDeal=new GBDealNotifier.Model.Deal(a.dealID),a.legacyDeal._loadStatusFromDealDAO(a),dealNotifier.registerDeal(a.inCartAsin,a.legacyDeal))},watchDeal:function(a,b){var c=this;gb.utils.getWindowLocationOrigin();var d=c.dealDAOs[b],e=h.$("#"+gb.enums.ChangeoverID.Subnav),g;if(!0!==d.processWatchAction)if(gb.service.customerID){d.processWatchAction=!0;c.refreshDealView(b);var l=gb.enums.WatchDealActions.ADD,
f=gb.metrics.refTags.watchDeal;c.dealDAOs[b].isDealWatched&&(l=gb.enums.WatchDealActions.REMOVE,f=gb.metrics.refTags.unWatchDeal);f=gb.metrics.generateRef(a,f,[b]);gb.service.watchDeal(b,l,function(f,n,h){gb.resources.customerData.csrfToken=h.getResponseHeader("X-CSRFToken");d.processWatchAction=!1;c.closeBottomSheet();l===gb.enums.WatchDealActions.ADD?(d.isDealWatched=!0,g=gb.resources.getString("gb_watching_deal")):(d.isDealWatched=!1,g=gb.resources.getString("gb_stopped_watching"));c.refreshDealView(b);
gb.metadata.updateWatchedDeals(b);0<e.length&&(e.find("strong").text(g),e.show());f=gb.resources.getFeature("mobile_redesign");if(gb.resources.deviceInfo.isApp&&4!==f)if(gb.resources.deviceInfo.isAppVersionHigher)d.isDealWatched&&(gb.notifications.subscribeNotifications(),gb.resources.customerData.isWatchedDealFirstRun&&c.renderWatchDealFirstrun(a));else if(l===gb.enums.WatchDealActions.ADD){var m=gb.utils.getAppStoreURL();m&&p.when("mash").execute(function(a){a.showAlert({message:gb.resources.getString("gb-reminders-msg-old-app"),
buttonTitles:[gb.resources.getString("gb-go-to-app-store"),gb.resources.getString("gb_continue_shopping")],successCallback:function(b){0===b&&a.canLaunchIntentURL({url:m,successCallback:function(b){b&&a.launchIntentURL({url:m})}})}})})}},function(a){(a=gb.resources.getString("csld-all_retries_failed"))?(c.refreshWatchDealStatus(b,a),d.processWatchAction=!1,k.setTimeout(function(){c.refreshDealView(b)},3E3)):c.refreshDealView(b)},function(){var a=gb.resources.getString("gb_watch_this_deal_failed_retrying");
a&&c.refreshWatchDealStatus(b,a)},f)}else gb.watchDealService.addWatchedDealOnLoginRedirect(b),d.processWatchAction=!1,c.refreshDealView(b)},addItemToWishList:function(a){var b=this,c=a.dealID,d=a.asin;gb.resources.customerData.customerId?h.post("/gp/mobile/deals/ajax/addToWishList.html?asin="+d,{success:function(a){if(a.isAddedToWishList)b.dealDAOs[c].addActionMessage=gb.resources.getString("gb_added_to_wishlist"),b.dealDAOs[c].isAddedToWishList=!0;else if(a.isDuplicateAdd)b.dealDAOs[c].addActionMessage=
gb.resources.getString("gb_already_in_wishlist"),b.dealDAOs[c].isAddedToWishList=!0;else if(a.isAuthError){b.addToWishListOnLoginRedirect(d);return}b.dealDAOs[c].addingToWishList=!1;b.dealDAOs[c].defaultRegistryID=a.defaultRegistryID;b.refreshDealView(c)},error:function(){k.location.href="/gp/registry/wishlist"}}):b.addToWishListOnLoginRedirect(d)},addToWishListOnLoginRedirect:function(a){var b=gb.resources.getUrl("wishlist_login_redirect");k.location.href=b.replace(/%257BdealID%257D/,a)},updateAppliedFilters:function(a){this.schedulingParams[a].enablePagination&&
(gb.utils.updateFiltersInAddressBar(a,this.widgetCurrentPage[a],this.widgetCurrentCategory[a],this.widgetCurrentStatus[a]),gb.widgets[a].scrollToWidgetTop())},setPreviouslyAppliedFilters:function(a,b){var c=gb.utils.getHashOfAppliedFilters(b);this.widgetCurrentPage[a]=parseInt(c[gb.enums.CustomerAppliedFilters.PAGE],10);this.widgetCurrentCategory[a]=c[gb.enums.CustomerAppliedFilters.CATEGORY];this.widgetCurrentStatus[a]=c[gb.enums.CustomerAppliedFilters.STATUS]},isPaginatedMetadataCall:function(a){if(gb.configManager.getWidgetViewConfig(a).dcsMetadataVersion===
gb.enums.Constants.PAGINATED_METADATA_VERSION||gb.controller.schedulingParams[a].eventID)return!0},setInitialFilters:function(a){this.widgetCurrentPage[a]=this.schedulingParams[a].page;this.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;this.widgetCurrentStatus[a]=gb.enums.StatusFilters.AVAILABLE;if(this.schedulingParams[a].enablePagination){var b=gb.utils.getParamValueFromUrl(k.location.href,gb.enums.BrowserHistory.STATE_KEY+a);b&&this.setPreviouslyAppliedFilters(a,b)}},getShareManager:function(){gb.shareManager||
(gb.shareManager=new A);return gb.shareManager},getBottomSheet:function(){null===this.bottomSheet&&(this.bottomSheet=new G);this.removeWatchDealFirstrun();return this.bottomSheet},closeBottomSheet:function(){this.bottomSheet&&this.bottomSheet.close()},getWatchDealView:function(){this.watchDealView||(this.watchDealView=new L);return this.watchDealView},getWatchDealService:function(){gb.watchDealService||(gb.watchDealService=new B);return gb.watchDealService},renderWatchDealFirstrun:function(a){var b=
h.$;if(gb.resources.customerData.isWatchedDealFirstRun&&(gb.resources.customerData.isWatchedDealFirstRun=!1,gb.resources.deviceInfo.isPhone&&gb.subnavController&&gb.subnavController.subnavContainer.length)){var c=function(){var c=gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"bottomPopover",data:{message:gb.resources.getString("gb_m_watch_deal_firstrun")}}),d=b(c);gb.subnavController.subnavContainer.after(d);d.slideDown(gb.enums.WatchDealConstants.ANIMATE_DURATION);
c=function(a){d.slideUp(gb.enums.WatchDealConstants.ANIMATE_DURATION,function(){h.$(this).remove()})};h.declarative("gbdeal-close-infobox","click",c);d.bind("gbdeal-close-infobox",c)};gb.resources.deviceInfo.isApp&&gb.resources.deviceInfo.isIPhone&&gb.resources.deviceInfo.isIOSInterstitialSupported?gb.notifications.invokePushNotificationInterstitial(c):c()}},removeWatchDealFirstrun:function(a){a=h.$(".bottomPopover-infobox");0<a.length&&a.trigger("gbdeal-close-infobox")},_handleActions:z.once(function(){var a=
this;h.declarative("gb-bottomSheet-close","click",function(b){a.closeBottomSheet()})}),updatePrimeSignUpURL:function(){var a=h.$(location),b=a.attr("href"),a=a.attr("origin"),b=k.escape(k.btoa(b.replace(a,""))),a=gb.resources.getUrl("prime_signup_redirect"),a=a.replace(a.match(gb.enums.Constants.REDIRECT_URL_REGEX)[1],b),c=gb.resources.getUrl("exclusive_access_prime_signup_redirect"),c=c.replace(c.match(gb.enums.Constants.REDIRECT_URL_REGEX)[1],b),d=gb.resources.getUrl("exclusive_dotd_prime_signup_redirect"),
d=d.replace(d.match(gb.enums.Constants.REDIRECT_URL_REGEX)[1],b);gb.resources.registerUrls({prime_signup_redirect:a,exclusive_access_prime_signup_redirect:c,exclusive_dotd_prime_signup_redirect:d})},_postAllWidgetsLoaded:function(){gb.filterController.trigger("allWidgetsLoaded")}})});p.when("A","GoldboxMobile3PAssets","gb-enums","gb-metrics","gb-subnav-metrics","gb-utilities","gb-resources").register("gb-subnav-controller",function(h,r,f,a,b,c,d){var e=r._;gb.resources=d;return h.createClass({currentPageNumber:0,
isStopPanSwipeDecided:!1,isSubnavPresent:!0,lastScrollTop:{},origin:0,stopPanSwipe:!1,subnavHiddenHeight:0,subnavPosition:0,subnavUnderlineLeftValue:0,subnavWidth:0,totalPages:0,totalWidth:0,scrollLeftPosition:0,positioning:"top",SubnavIDs:{ScrollerPages:"#subnavScrollerPages",SubnavPage:"#gbSubnavPage",ScreenPage:"#subnavAllPages",SubnavWidgetHolder:"#gbSubnavWidgetHeaderHolder",SubnavContainer:"#subnavContainer",SubnavHeading:"#subnavHeading",SubnavHeightDiv:"#subnavContainerHeightDiv",SubnavLink:"#gbSubnavLink",
SubnavRefresher:"#subnavPageRefresher",SubnavScroller:"#subnavScroller",SubnavUnderline:"#subnavLinkUnderline",SubnavScreenPage:"#subnavScreenPage",SubnavContainer_NoHash:"subnavContainer",SubnavHeightDiv_NoHash:"subnavContainerHeightDiv",SubnavLink_NoHash:"gbSubnavLink",SubnavPages:".gbSubnavPages",SubnavTab:"#gbSubnavTab"},SubnavClasses:{LinkActive:"subnavLinkActive"},RefTags:{subnavTab:"s",tab:"tab"},Constants:{LEFT:"left",RIGHT:"right",TOP:"top",MIDDLE:"middle",SUBNAV_SELECT:"subnavSelectedPage",
SWIPE_ANIMATION_TIME:300,MIN_REDIRECT_DATA:15,SMALL_SPACING:9,REFRESH_DISTANCE:150},widgetsOnSubnavPage:{},init:function(a){var c=this;c.initializeFramework();e.each(a,function(a,b){c[b]=a});this.registerPage();this.subnavContainer=h.$(this.SubnavIDs.SubnavContainer);this.subnavHeading=h.$(this.SubnavIDs.SubnavHeading);this.subnavRefresher=h.$(this.SubnavIDs.SubnavRefresher);this.subnavScroller=h.$(this.SubnavIDs.SubnavScroller);this.subnavScrollerPages=h.$(this.SubnavIDs.ScrollerPages);this.screenPage=
h.$(this.SubnavIDs.ScreenPage);this.subnavPages=h.$(this.SubnavIDs.SubnavPages);this.subnavUnderline=h.$(this.SubnavIDs.SubnavUnderline);this.subnavScreenPage=h.$(this.SubnavIDs.SubnavScreenPage);a={domElementID:this.domElementID,widgetName:this.widgetName};this.metrics=new b(a);h.$(k).resize(e.bind(c.resetSubnavWidth,c));h.declarative("gbsubnav-linkclick","click",function(a){a=parseInt(a.data.newPageNumber,10);gb.subnavController.subnavLinkClick(a)});this.resetSubnavWidth()},initializeFramework:function(){gb.utils=
c;gb.enums=f;gb.metrics=gb.metrics||new a},registerPage:function(){var a=this,b="gbSubnavPage"+this.currentPageNumber;p.now(b).execute(function(c){c===q?p.register(b,function(){return!0}):(c=a._getDealsInSubnavpage(a.currentPageNumber),gb.watcher&&gb.watcher.wireStatusRefresh(c))})},resetSubnavWidth:function(){this.subnavWidth=this.subnavContainer.width();this.origin=this.subnavContainer.position().left;this.subnavScroller.scrollLeft(0);for(var a=0;a<this.totalPages;a++)this.linkLeft[a]=document.getElementById(this.SubnavIDs.SubnavLink_NoHash+
a).getBoundingClientRect().left-this.origin,this.linkRight[a]=document.getElementById(this.SubnavIDs.SubnavLink_NoHash+a).getBoundingClientRect().right-this.origin;this.scrollLeftPosition=this.currentPageNumber*this.subnavScreenPage.width();this.moveSubnavPages(-this.scrollLeftPosition,0);this.animateSubnav(this.currentPageNumber,0);this.subnavUnderline.css(gb.utils.getCSStransitionTime(0));this.subnavUnderline.css(gb.utils.getCSStransformDistance(this.linkLeft[this.currentPageNumber],gb.enums.Constants.X_DIRECTION));
this.subnavUnderline.width(this.linkRight[this.currentPageNumber]-this.linkLeft[this.currentPageNumber])},handlePageScroll:function(){var a=h.$(k).scrollTop(),b=this.lastScrollTop[this.currentPageNumber]||0;this.lastScrollTop[this.currentPageNumber]=a;this.positioning===this.Constants.TOP&&(a<b&&!this.isSubnavPresent?this.subnavSlideDown():a>b&&this.isSubnavPresent&&this.subnavSlideUp())},subnavSlideUp:function(){gb.utils.isElementInViewPort(this.SubnavIDs.SubnavHeightDiv_NoHash+this.currentPageNumber)===
gb.enums.ViewPortPresence.ABSENT&&this.subnavSlideCompletelyUp()},subnavSlideDown:function(){gb.utils.isElementInViewPort(this.SubnavIDs.SubnavHeightDiv_NoHash+this.currentPageNumber)!==gb.enums.ViewPortPresence.ABSENT&&this.subnavSlideCompletelyDown()},subnavSlideCompletelyDown:function(){gb.resources.deviceInfo.isCSS3Supported&&this.subnavContainer.css(gb.utils.getCSStransformDistance(0,gb.enums.Constants.Y_DIRECTION));this.subnavHiddenHeight=0;this.isSubnavPresent=!0},subnavSlideCompletelyUp:function(){this.isSubnavPresent=
!1;this.subnavHiddenHeight=-(this.subnavHeading.length?this.subnavHeading.height():0)-this.Constants.SMALL_SPACING;gb.resources.deviceInfo.isCSS3Supported&&this.subnavContainer.css(gb.utils.getCSStransformDistance(this.subnavHiddenHeight,gb.enums.Constants.Y_DIRECTION))},swipeStart:function(a){this.subnavPages.removeClass("pageScroll");this.touchDeltaY=this.touchDeltaX=0;this.touchStartX=a.originalEvent.touches[0].pageX;this.touchStartY=a.originalEvent.touches[0].pageY},swipePage:function(a){this.stopPanSwipe||
(this.subnavPages.addClass("pageScroll"),this.touchDeltaX=a.originalEvent.touches[0].pageX-this.touchStartX,this.touchDeltaY=a.originalEvent.touches[0].pageY-this.touchStartY,!this.isStopPanSwipeDecided&&Math.abs(this.touchDeltaX)<=Math.abs(this.touchDeltaY)?this.stopPanSwipe=!0:(this.isStopPanSwipeDecided=!0,this.touchStartX>this.Constants.MIN_REDIRECT_DATA?(a.preventDefault(),a=0>this.touchDeltaX?this.currentPageNumber+1:this.currentPageNumber-1,0>a||a===this.totalPages||(this.moveSubnavPages(this.touchDeltaX-
this.scrollLeftPosition,0),a=this.linkLeft[this.currentPageNumber]-(this.linkRight[this.currentPageNumber]-this.linkLeft[this.currentPageNumber])*this.touchDeltaX/this.subnavWidth,this.subnavUnderline.css(gb.utils.getCSStransitionTime(0)),this.subnavUnderline.css(gb.utils.getCSStransformDistance(a,gb.enums.Constants.X_DIRECTION)))):this.stopPanSwipe=!0))},swipeEnd:function(a){this.subnavPages.removeClass("pageScroll");this.isStopPanSwipeDecided=!1;this.stopPanSwipe?this.stopPanSwipe=!1:(this.stopPanSwipe=
!1,a=0>this.touchDeltaX?this.currentPageNumber+1:this.currentPageNumber-1,0>a||a===this.totalPages||(this.subnavUnderlineLeftValue-=this.touchDeltaX/this.subnavWidth,Math.abs(this.touchDeltaX)>=this.subnavWidth/4?(this.changeSelectedLink(a),this.changeSubnavTab(a,this.currentPageNumber),this.currentPageNumber=a,this.addSubnavPageToURL(a,this.metrics.refTags.swipe)):this.changeSubnavTab(this.currentPageNumber,a)))},moveSubnavPages:function(a,b){this.screenPage.css(gb.utils.getCSStransitionTime(b));
this.screenPage.css(gb.utils.getCSStransformDistance(a,gb.enums.Constants.X_DIRECTION))},animateSubnav:function(a,b){this.subnavScroller.animate({scrollLeft:(this.linkRight[a]+this.linkLeft[a]-this.subnavWidth)/2},b,"linear")},getSubnavPage:function(a){return h.$(gb.subnavController.SubnavIDs.SubnavPage+a)},pageChangeCallback:function(){this.registerPage();for(var a=0;a<this.totalPages;a++){var b=this.getSubnavPage(a);a!==gb.subnavController.currentPageNumber?b.css({height:gb.subnavController.minPageHeight+
"px","overflow-y":"hidden"}):b.css({height:"auto","overflow-y":"auto"})}a=this.lastScrollTop[this.currentPageNumber]||0;h.$(k).scrollTop(a);this.subnavUnderline.width(this.linkRight[this.currentPageNumber]-this.linkLeft[this.currentPageNumber]);gb.subnavController.positioning===this.Constants.TOP&&(gb.utils.isElementInViewPort(this.SubnavIDs.SubnavHeightDiv_NoHash+this.currentPageNumber)===gb.enums.ViewPortPresence.ABSENT?this.subnavSlideCompletelyUp():this.subnavSlideCompletelyDown());gb.controller&&
gb.controller.removeWatchDealFirstrun&&gb.controller.removeWatchDealFirstrun();if(this.widgetsOnSubnavPage[this.currentPageNumber]){var a=this.widgetsOnSubnavPage[this.currentPageNumber],c;for(c in a)a[c]&&(b=parseInt(this.tabRefreshElapseTime,10))&&a[c].pageRefresher.refreshOnElaspeTime(b)}},subnavLinkClick:function(a){a!==this.currentPageNumber&&(this.changeSelectedLink(a),this.changeSubnavTab(a,this.currentPageNumber),this.currentPageNumber=a,this.addSubnavPageToURL(a,this.metrics.refTags.tab))},
changeSubnavTab:function(a,b){var c=this,d=Math.abs(a-this.subnavUnderlineLeftValue)*c.Constants.SWIPE_ANIMATION_TIME,e=this.linkLeft[a];this.subnavUnderline.css(gb.utils.getCSStransitionTime(d));this.subnavUnderline.css(gb.utils.getCSStransformDistance(e,gb.enums.Constants.X_DIRECTION));h.$(gb.subnavController.SubnavIDs.SubnavWidgetHolder+c.currentPageNumber).hide();h.$(gb.subnavController.SubnavIDs.SubnavWidgetHolder+a).show();this.subnavUnderlineLeftValue=a;this.scrollLeftPosition=a*c.subnavScreenPage.width();
this.moveSubnavPages(-this.scrollLeftPosition,d);gb.utils.setSafeTimeout(function(){c.pageChangeCallback()},d);3<this.totalPages&&this.animateSubnav(a,d);d=this._getDealsInSubnavpage(b);gb.watcher&&gb.watcher.unwireStatusRefresh(d)},changeSelectedLink:function(a){h.$(this.SubnavIDs.SubnavLink+this.currentPageNumber).removeClass(gb.subnavController.SubnavClasses.LinkActive);h.$(this.SubnavIDs.SubnavLink+a).addClass(gb.subnavController.SubnavClasses.LinkActive);gb.accessibility&&gb.accessibility.trigger("AccessibilityAction",
"subnavChange",{subnavObject:this,newPageNumber:a})},addSubnavPageToURL:function(a,b){var c=k.location.href,c=gb.utils.setUrlParam(c,this.Constants.SUBNAV_SELECT,a),c=this.metrics.addMetricsParams(c,this.widgetName,b,[this.RefTags.tab,a]);gb.utils.updateAddressBarUrl(c);gb.controller&&gb.controller.updatePrimeSignUpURL()},_isSwipeSupported:function(){var a=!0,b=gb.resources.getDeviceInfo(),c;switch(b.operatingSystem){case "Android":try{c=/[^.]*/.exec(b.operatingSystemVersion)[0]}catch(d){break}5>
parseInt(c,10)&&(a=!1);break;case "iOS":if(/iPod/.exec(b.userAgent)){a=!1;break}500>h.$(k).height()&&(a=!1)}return a},_getDealsInSubnavpage:function(a){var b=[];(a=this.widgetsOnSubnavPage[a])&&e.each(a,function(a){b=e.union(b,Object.keys(a.dealViews))});return b},refreshPage:function(){var a=this.getSubnavPage(this.currentPageNumber);this.subnavRefresher.css({top:"0px"});a.bind("touchmove",this.touchmove);a.bind("touchend",this.touchend);a.bind("touchcancel",this.touchend)},moveRefresher:function(a){gb.subnavController.RefresherY=
a.originalEvent.touches[0].pageY-this.touchStartY;0>=gb.subnavController.RefresherY||!this.showRefresher&&Math.abs(a.originalEvent.touches[0].pageX-this.touchStartX)>gb.subnavController.RefresherY?this.unbindTouchEvents():(this.showRefresher=!0,a.preventDefault(),this.subnavRefresher.css({display:"block",top:(gb.subnavController.RefresherY<this.Constants.REFRESH_DISTANCE?gb.subnavController.RefresherY:this.Constants.REFRESH_DISTANCE)+"px"}))},unbindTouchEvents:function(){this.subnavRefresher.css("display",
"none");gb.subnavController.RefresherY=0;this.showRefresher=!1;var a=this.getSubnavPage(this.currentPageNumber);a.unbind("touchmove",this.touchmove);a.unbind("touchend",this.touchend);a.unbind("touchcancel",this.touchend)},hideRefresher:function(a){gb.subnavController.RefresherY>=this.Constants.REFRESH_DISTANCE&&(a.preventDefault(),a=k.location.href,a=this.metrics.addMetricsParams(a,this.widgetName,this.metrics.refTags.subnavTabRefresh,[this.RefTags.tab,this.currentPageNumber]),gb.utils.updateAddressBarUrl(a),
gb.subnavController.widgetsOnSubnavPage[this.currentPageNumber]&&e.each(gb.subnavController.widgetsOnSubnavPage[this.currentPageNumber],function(a){a.refreshWidget();a.pageRefresher.reinitilaizelIdleTimeRefresh()}));this.unbindTouchEvents()},touchmove:function(a){gb.subnavController.moveRefresher(a)},touchend:function(a){gb.subnavController.hideRefresher(a)},isWidgetExistinCurrentPageRefreshList:function(a){if(this.widgetsOnSubnavPage[this.currentPageNumber]){var b=this.widgetsOnSubnavPage[this.currentPageNumber],
c;for(c in b)if(b[c].widgetID===a.widgetID)return!0}return!1}})});p.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-filter-model-factory","gb-filter-metrics").register("gb-filter-controller",function(h,r,f,a,b){var c=r._;return f.extend({filterMetrics:null,filterModelFactory:null,models:{},widgetGroups:{},init:function(){this._super();this.filterMetrics=new b;this.filterModelFactory=new a;this.on("gbfilter:change",this.onFilterChange);this.on("gbfilter:mergeFilters",this.onFilterMerge);this.on("allWidgetsLoaded",
this._postAllWidgetsLoaded)},registerFilters:function(a,b,c){c&&(this.models[c]||(this.models[c]=this.filterModelFactory.getFilterModel(b,c)),this.models[c].mergeFilters({schedulingParams:a.schedulingParams,dcsServerResponse:a.dcsServerResponse}),this.widgetGroups[c]=this.widgetGroups[c]||[],this.widgetGroups[c].push(gb.widgets[b]))},getWidgetGroupID:function(a){var b=null,g=a.schedulingParams,l=a.widgetName;a=a.widgetID;g.eventID?b=g.eventID:!gb.controller.isPaginatedMetadataCall(a)||c.isEmpty(g.filterConfig)||
g.enforceLimitedDeals||(b=g.widgetGroupID?g.widgetGroupID:l);return b},onFilterChange:function(a,b,g){var l=b.widgetID,f=gb.widgets[l],h=f.isEventsWidget(),r=a.getSelectedFilters(h),p=c.clone(r),q=b.data[1]===gb.enums.BinningParams.PAGE.key,y=gb.controller.schedulingParams[l];q&&1<r[gb.enums.BinningParams.PAGE.key]&&(p.dealsPerPage=y.pageSize);var p=this._toURL(p),v=a.widgetGroupID,t=a.redirectURL||k.location.href,t=gb.utils.setUrlParam(t,"gb_f_"+v,p);a.targetedWidget.title?(p=a.targetedWidget.title,
gb.controller.schedulingParams[l].title=p,p=gb.utils.encodeSpaces(p),p=encodeURIComponent(p),t=gb.utils.setUrlParam(t,"gb_ttl_"+v,p)):a.targetedWidget.clearTitle&&(t=gb.utils.clearUrlParam(t,"gb_ttl_"+v),gb.controller.schedulingParams[l].title=a.targetedWidget.savedTitle);t=this.filterMetrics.appendFilterMetricParams(t,l,b.context,b.data);t=gb.utils.enforceUTFEncodingInUrl(t);a.doPageRefresh?(f.widgetName===gb.enums.WidgetNames.HERO&&(f.renderWireFrame(),f.renderContent(!0)),this.models[v].doPageRefresh=
!1,t=gb.utils.setUrlHash(t,a.widgetGroupAnchor),k.location.href=t):(a=gb.configManager.getWidgetViewConfig(f.widgetID).disableNavigationToTop,!a&&g&&(a=g.disableNavigationToTop),a||(g=f.skinDomElement.position().top,k.scrollTo(0,g)),gb.configManager.getWidgetViewConfig(f.widgetID).showBottomSheetFilter&&gb.controller.closeBottomSheet(),gb.utils.updateAddressBarUrl(t,gb.configManager.getWidgetViewConfig(f.widgetID).pushFilteredURL,r),f.showLoading(),q?this._handlePageChange(l,v):gb.utils.isWatchedDealsTab(l)?
(this._overrideSchedulingParamsFromFilters(r,l,h),gb.metadata.refreshWatchedDeals(l)):(y.fetchSinglePage=!1,gb.widgetHelper&&gb.widgetHelper.callDataArray[l]&&(y.pageSize=gb.widgetHelper.callDataArray[l][0].dealsPerPage),this._overrideSchedulingParamsFromFilters(r,l,h),delete gb.metadata.sortedDealIDs[l],h={dealsPerPage:gb.configManager.getWidgetViewConfig(l).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[l].pageSize},gb.service.fetchDealWithData(l,h,function(a){gb.filterController._updateWidgetGroup(f.widgetGroupID)})));
gb.controller.updatePrimeSignUpURL()},_handlePageChange:function(a,b){var c=gb.controller.widgetCurrentPage[a],l=gb.controller.schedulingParams[a],f=gb.widgets[a];if(gb.metadata.isCurrentWindowFull(a,c,l.pageSize))gb.filterController._updateWidgetGroup(b);else if(l.fetchSinglePage)gb.controller.fetchPage({page:c},a,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)});else{var h={page:c,dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:l.pageSize};if(f.isLaunchCellPage&&
l.pageSize){var k=l.widgetTabConfig[l.widgetCurrentTab],k=(k?k.launchCellIndex:0)%l.pageSize;h.getDealsSize>k&&(h.getDealsSize=k+1)}gb.controller.fetchPage(h,a,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)})}f=c<f.totalPages&&!gb.metadata.isCurrentWindowFull(a,c+1,l.pageSize);h=1<c&&!gb.metadata.isCurrentWindowFull(a,c-1,l.pageSize);l.fetchSinglePage?(f&&gb.controller.fetchPage({page:c+1},a),h&&gb.controller.fetchPage({page:c-1},a)):h||(c=(c-2)*l.pageSize,l=gb.metadata.sortedDealIDs[a].slice(c,
c+l.pageSize),l.length&&gb.service.fetchDeals(l,a))},onFilterMerge:function(a){c.each(this.widgetGroups[a.widgetGroupID],function(a){a.renderContent(!0)})},_updateWidgetGroup:function(a){c.each(this.widgetGroups[a],function(a){gb.controller.trigger("WidgetPageUpdate",a.widgetID,!0)})},_overrideSchedulingParamsFromFilters:function(a,b,g){var l=this.models[gb.widgets[b].widgetGroupID],f=gb.controller.schedulingParams[b];c.each(l.attributesList,function(b){var e=null,h=gb.enums.BinningKeyToDCSQueryParamMap[b];
if(g)h&&!c.contains(gb.enums.excludeBinningParamsForEvents,b)?f[h]=a[h]:f.extendedFilters[b]=a[b];else{l.filterConfigValuesHash[b]&&!c.contains(l.attributesWithDisabledValues,b)&&(e=l.filterConfigValuesHash[b]);if(b===gb.enums.BinningParams.DISCOUNT.key)h=gb.enums.DCSQueryParams.DISCOUNT_RANGE;else if(b===gb.enums.BinningParams.PRICE.key)h=gb.enums.DCSQueryParams.PRICE_RANGE;else if(b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY)f.extendedFilters[gb.enums.IncludedDealTargetsSupported.MARKETING_ID]=
a[gb.enums.IncludedDealTargetsSupported.MARKETING_ID];h&&(f[h]=a[h]||e)}})},_isDefaultValue:function(a,b){return a===gb.enums.DCSQueryParams.PAGE&&1===b||a===gb.enums.DCSQueryParams.SORT_ORDER&&b===gb.enums.SortOrders.BY_RELEVANCE||!b&&(a===gb.enums.DCSQueryParams.GLOBAL_ELIGIBLE_ONLY||a===gb.enums.DCSQueryParams.PRIME_ELIGIBLE_ONLY)},_toURL:function(a){var b=this;a=c.map(a,function(a,d){var f;a&&d===gb.enums.BinningParams.NEW_RELEASES.key&&(a="Y");if(b._isDefaultValue(d,a))return null;if(c.isArray(a)){if(c.isEmpty(a))return null;
f=c.map(a,encodeURIComponent).join(",")}else f=a;return d+":"+encodeURIComponent(encodeURIComponent(f))});return c.compact(a).join(",")},_postAllWidgetsLoaded:function(){var a=this;c.each(c.keys(this.models),function(b){b=a.models[b];b.setupWidgetFilterConnections();b.saveTargetedWidgetInfo()})}})});p.when("A","GoldboxMobile3PAssets").register("gb-page-refresher",function(h,r){var f,a=h.createClass({init:function(a){var c=null,d=(new Date).getTime(),e=function(a){if(c!==a.type&&null!==c&&"focus"===
a.type)return!0;c=a.type;return!1},g=function(){var c=Math.floor(((new Date).getTime()-d)/1E3);return a&&c>a?!0:!1};(function(){if(a&&(h.$(k).bind("blur focus",function(a){e(a)&&g()&&gb.utils.reloadPage(k.location,gb.widgetViewFactory)}),gb.resources.deviceInfo.isApp)){var c={pause:"blur",resume:"focus"};h.$(document).bind("pause resume",function(a){e({type:c[a.type]})&&g()&&gb.utils.reloadPage(k.location,gb.widgetViewFactory)})}})()}});return h.createClass({init:function(a,c){var d=null,e=(new Date).getTime(),
g=function(a){f();e=(new Date).getTime();gb.utils.reloadPage(a,gb.widgetViewFactory);n()},f=function(){null!==d&&(k.clearInterval(d),d=null)},n=function(){null===d&&a&&a&&(d=k.setInterval(function(){g(gb.widgets[c])},1E3*a))};this.refreshOnElaspeTime=function(a){a&&Math.floor(((new Date).getTime()-e)/1E3)>a&&g(gb.widgets[c])};this.reinitilaizelIdleTimeRefresh=function(){f();n()};n()},initializeVisibilityHandler:function(b){!f&&b&&(f=new a(b));return f}})});p.when("A","gb-event-emitter").register("gb-accessibility",
function(h,k){var f={"GB-TAB-SUPPLE":{AVAILABLE:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"}},
UPCOMING:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"}},EXPIRED:{imageHolder:{selector:".dealImage img",
idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealEndText",idSufix:"_Timer"}},SOLDOUT:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",
idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealSoldText",idSufix:"_Timer"}},COMINGSOON:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealTimer:{selector:".dealComingText",
idSufix:"_Timer"}}},"GB-TAB-HERO":{AVAILABLE:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"}},UPCOMING:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},
dealTitle:{selector:".titleContainer",idSufix:"_title"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"},watchDeal:{selector:".watchBtnContainer",idSufix:"_WatchDeal"}},EXPIRED:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealTimer:{selector:".dealClaimInfo",idSufix:"_Timer"},dealStatus:{selector:".dealViewStatus",
idSufix:"_Status"}},SOLDOUT:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"}},COMINGSOON:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTitle:{selector:".titleContainer",idSufix:"_title"}}}};return k.extend({init:function(){this._super();this.on("AccessibilityAction",
this.actionHandler)},generateDealViewAccessibilityFlow:function(a,b){var c=a.widgetView.widgetName,d=a.deal.dealState,e=gb.utils.getDealViewID(a.widgetView.widgetID,a.position),g,l=[];f[c]&&(g=f[c][d]);if(g){var n=h.$(b),k;for(k in g)g[g]&&(d=g[k],c=n.find(d.selector),c.length&&(c.attr("id",e+d.idSufix),l.push(e+d.idSufix)));if(l.length)return n.attr("aria-flowto",l.join(" ")),h.$("<div/>").append(n).html()}return b},actionHandler:function(a,b){if(a)switch(a){case "subnavChange":this.subnavChange(b.subnavObject,
b.newPageNumber);break;case "updateHeroTimer":this.updateHeroTimer(b.viewElement,b.spanID,b.timerInfo);break;case "updateRefineView":this.updateTabHeroRefineView(b.filterEl);break;case "focusListItem":this.focusBottomSheetItem(b.bottomSheetObject)}},subnavChange:function(a,b){h.$(a.SubnavIDs.SubnavTab+a.currentPageNumber).attr("aria-selected","false");h.$(a.SubnavIDs.SubnavPage+a.currentPageNumber).attr("aria-hidden","true");h.$(a.SubnavIDs.SubnavTab+b).attr("aria-selected","true");h.$(a.SubnavIDs.SubnavPage+
b).attr("aria-hidden","false")},updateHeroTimer:function(a,b,c){c=gb.resources.getString("gb_expand_time",{hours:c.hours,minutes:c.minutes,seconds:c.seconds});h.$(a).find("#"+b).attr("aria-label",c);h.$(a).find("#"+b).attr("role","heading")},updateTabHeroRefineView:function(a){a.find("#statusFilter").bind("click",function(a){"block"!==h.$("#availabilityExpander").css("display")&&h.$("#availabilityContent").find("[role='listitem']").eq(0).focus()});a.find("#departmentFilter").bind("click",function(a){"block"!==
h.$("#categoryRefineExpander").css("display")&&h.$("#categoryRefineContent").find("[role='listitem']").eq(0).focus()})},focusBottomSheetItem:function(a){a.els.contents.find("[role='listitem']").eq(0).focus()}})});p.when("A","jQuery","load").execute(function(h,r){r(k).resize(function(){function f(a){if(r(a).length){var b=r(k).width(),c=r(".gbox-short-ad").width(),d=Math.floor(b/c),b=r(a+" .scheduled-ad").length,e=b*c;b>d&&(e=d*c);r(a).css("width",e);var g=!1;r(a+" .scheduled-ad").each(function(a){a>=
d?r(this).hide():(r(this).show(),g=!0)});a=r(a).parent();g?1===a.children().length&&a.append("<hr style='border-top:1px solid #DDDDDD;margin-top:10px;width:95%'>"):1<a.children().length&&a.children().last().remove()}}f("#gbox-ad-row-1\\.0");f("#gbox-ad-row-2\\.0")});r(k).resize()});k.P&&k.P.AUI_BUILD_DATE&&(k.gb=k.gb||{},p.when("jQuery").execute(function(h){gb.$=h;p.declare("GoldboxMobile3PAssets",{_:_.noConflict()})}))})})(function(){var p=window.AmazonUIPageJS||window.P,k=p._namespace||p.attributeErrors;
return k?k("GoldboxMobileAssets"):p}(),window);